# ğŸš€ Ø®Ø·Ø© Ø§Ù„ØªÙ†ÙÙŠØ° - Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1: Ø¥ÙƒÙ…Ø§Ù„ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†

**ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:** 2025-11-21
**Ø§Ù„Ù‡Ø¯Ù:** Ø¥ÙƒÙ…Ø§Ù„ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ø¹ Ø§Ù„ØªÙƒØ§Ù…Ù„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ

---

## ğŸ“‹ ØªØ¹Ù„ÙŠÙ…Ø§Øª Ù„Ù€ Claude Code

Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø±Ø§Ø­Ù„ Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ø¥ÙƒÙ…Ø§Ù„ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ†.

**ÙƒÙŠÙÙŠØ© Ø§Ù„ØªÙ†ÙÙŠØ°:**
1. Ù‚Ù… Ø¨ØªÙ†ÙÙŠØ° ÙƒÙ„ Ù…Ø±Ø­Ù„Ø© Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨
2. Ù„Ø§ ØªÙ†ØªÙ‚Ù„ Ù„Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
3. Ø¨Ø¹Ø¯ ÙƒÙ„ Ù…Ø±Ø­Ù„Ø©ØŒ Ù‚Ù… Ø¨Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù…Ù„ ÙƒÙ„ Ø´ÙŠØ¡
4. Ø¹Ù„Ù‘Ù… Ø¹Ù„Ù‰ âœ… Ø¹Ù†Ø¯ Ø¥ØªÙ…Ø§Ù… ÙƒÙ„ Ø®Ø·ÙˆØ©

**Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ§Øª:**
- ğŸ”´ **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1A:** Ø¹Ø§Ø¬Ù„ Ø¬Ø¯Ø§Ù‹ - ÙŠØ¬Ø¨ Ø¥ØªÙ…Ø§Ù…Ù‡ Ø£ÙˆÙ„Ø§Ù‹
- ğŸŸ¡ **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1B:** Ù…Ù‡Ù… - Ø¨Ø¹Ø¯ 1A
- ğŸŸ¢ **Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1C:** ØªØ­Ø³ÙŠÙ†Ø§Øª - Ø§Ø®ØªÙŠØ§Ø±ÙŠ

---

# ğŸ”´ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1A: Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ø¬Ù„Ø©

## Ø§Ù„Ù…Ù‡Ù…Ø© 1: Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø© ÙÙŠ ItemStock

**Ø§Ù„Ù…Ù„Ù:** `apps/inventory/models.py`
**Ø§Ù„Ù…ÙˆÙ‚Ø¹:** ItemStock class (Ø§Ù„Ø³Ø·Ø± ~1653)
**Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:** 2-3 Ø³Ø§Ø¹Ø§Øª

### Ø§Ù„Ø®Ø·ÙˆØ§Øª:

#### 1.1 Ø§ÙØªØ­ Ø§Ù„Ù…Ù„Ù ÙˆØ§Ù‚Ø±Ø£ ItemStock Model
```bash
# Ø§Ù‚Ø±Ø£ Ø§Ù„Ù…Ù„Ù
apps/inventory/models.py
# Ø§Ø¨Ø­Ø« Ø¹Ù† class ItemStock
```

#### 1.2 Ø£Ø¶Ù Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„ØªØ§Ù„ÙŠØ© Ø¨Ø¹Ø¯ Ø­Ù‚Ù„ `last_movement_date`:

```python
    # Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠ
    opening_balance = models.DecimalField(
        _('Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠ'),
        max_digits=12,
        decimal_places=3,
        default=0,
        help_text=_('Ø§Ù„Ø±ØµÙŠØ¯ Ø¹Ù†Ø¯ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ©')
    )

    opening_value = models.DecimalField(
        _('Ù‚ÙŠÙ…Ø© Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠ'),
        max_digits=15,
        decimal_places=3,
        default=0
    )

    # Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¢Ø®Ø± Ø¹Ù…Ù„ÙŠØ© Ø´Ø±Ø§Ø¡
    last_purchase_price = models.DecimalField(
        _('Ø¢Ø®Ø± Ø³Ø¹Ø± Ø´Ø±Ø§Ø¡ Ù„Ù„ÙˆØ­Ø¯Ø©'),
        max_digits=12,
        decimal_places=3,
        null=True,
        blank=True,
        help_text=_('Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø© ÙÙŠ Ø¢Ø®Ø± Ø¹Ù…Ù„ÙŠØ© Ø´Ø±Ø§Ø¡')
    )

    last_purchase_total = models.DecimalField(
        _('Ø¢Ø®Ø± Ø³Ø¹Ø± Ø´Ø±Ø§Ø¡ Ø¥Ø¬Ù…Ø§Ù„ÙŠ'),
        max_digits=15,
        decimal_places=3,
        null=True,
        blank=True,
        help_text=_('Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØªÙƒÙ„ÙØ© Ø¢Ø®Ø± Ø¹Ù…Ù„ÙŠØ© Ø´Ø±Ø§Ø¡')
    )

    last_purchase_date = models.DateField(
        _('ØªØ§Ø±ÙŠØ® Ø¢Ø®Ø± Ø´Ø±Ø§Ø¡'),
        null=True,
        blank=True
    )

    last_supplier = models.ForeignKey(
        'core.BusinessPartner',
        on_delete=models.SET_NULL,
        null=True,
        blank=True,
        verbose_name=_('Ø¢Ø®Ø± Ù…ÙˆØ±Ø¯'),
        related_name='last_supplied_stocks',
        limit_choices_to={'partner_type__in': ['supplier', 'both']}
    )

    # Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
    min_level = models.DecimalField(
        _('Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø®Ø²ÙˆÙ†'),
        max_digits=12,
        decimal_places=3,
        null=True,
        blank=True,
        help_text=_('Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ø§ Ø§Ù„Ø­Ø¯ ÙŠØªÙ… Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡')
    )

    max_level = models.DecimalField(
        _('Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù„Ù„Ù…Ø®Ø²ÙˆÙ†'),
        max_digits=12,
        decimal_places=3,
        null=True,
        blank=True,
        help_text=_('Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ Ù„Ù„ØªØ®Ø²ÙŠÙ†')
    )

    reorder_point = models.DecimalField(
        _('Ù†Ù‚Ø·Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø·Ù„Ø¨'),
        max_digits=12,
        decimal_places=3,
        null=True,
        blank=True,
        help_text=_('Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù†Ù‚Ø·Ø© ÙŠØªÙ… Ø·Ù„Ø¨ Ø§Ù„Ù…Ø²ÙŠØ¯')
    )

    # Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªØ®Ø²ÙŠÙ†
    storage_location = models.CharField(
        _('Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªØ®Ø²ÙŠÙ†'),
        max_length=100,
        blank=True,
        help_text=_('Ø§Ù„Ø±Ù Ø£Ùˆ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹')
    )
```

#### 1.3 Ø£Ø¶Ù method Ø¬Ø¯ÙŠØ¯ ÙÙŠ ItemStock Ù„ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¢Ø®Ø± Ø´Ø±Ø§Ø¡:

```python
    def update_last_purchase(self, price, total, date, supplier=None):
        """
        ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¢Ø®Ø± Ø¹Ù…Ù„ÙŠØ© Ø´Ø±Ø§Ø¡

        Args:
            price: Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©
            total: Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
            date: ØªØ§Ø±ÙŠØ® Ø§Ù„Ø´Ø±Ø§Ø¡
            supplier: Ø§Ù„Ù…ÙˆØ±Ø¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
        """
        self.last_purchase_price = price
        self.last_purchase_total = total
        self.last_purchase_date = date
        if supplier:
            self.last_supplier = supplier
        self.save(update_fields=[
            'last_purchase_price',
            'last_purchase_total',
            'last_purchase_date',
            'last_supplier'
        ])

    def check_reorder_needed(self):
        """
        Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø§Ø¬Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø·Ù„Ø¨

        Returns:
            bool: True Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ÙƒÙ…ÙŠØ© Ø£Ù‚Ù„ Ù…Ù† Ù†Ù‚Ø·Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø·Ù„Ø¨
        """
        if self.reorder_point:
            return self.quantity <= self.reorder_point
        return False

    def is_below_min_level(self):
        """
        Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø±ØµÙŠØ¯ Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰

        Returns:
            bool: True Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ÙƒÙ…ÙŠØ© Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰
        """
        if self.min_level:
            return self.quantity < self.min_level
        return False

    def is_above_max_level(self):
        """
        Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ø±ØµÙŠØ¯ Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰

        Returns:
            bool: True Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ÙƒÙ…ÙŠØ© Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰
        """
        if self.max_level:
            return self.quantity > self.max_level
        return False
```

#### 1.4 Ù‚Ù… Ø¨Ø¹Ù…Ù„ Migration:

```bash
# ÙÙŠ Ø§Ù„Ù€ terminal
python manage.py makemigrations inventory -n add_itemstock_fields
python manage.py migrate inventory
```

### âœ… Checklist:
- [ ] ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
- [ ] ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù€ methods Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
- [ ] ØªÙ… Ø¹Ù…Ù„ makemigrations Ø¨Ù†Ø¬Ø§Ø­
- [ ] ØªÙ… Ø¹Ù…Ù„ migrate Ø¨Ù†Ø¬Ø§Ø­
- [ ] Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯

---

## Ø§Ù„Ù…Ù‡Ù…Ø© 2: ØªØ­Ø¯ÙŠØ« StockIn.post() Ù„ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¢Ø®Ø± Ø´Ø±Ø§Ø¡

**Ø§Ù„Ù…Ù„Ù:** `apps/inventory/models.py`
**Ø§Ù„Ù…ÙˆÙ‚Ø¹:** StockIn.post() method (Ø§Ù„Ø³Ø·Ø± ~163)
**Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:** 30 Ø¯Ù‚ÙŠÙ‚Ø©

### Ø§Ù„Ø®Ø·ÙˆØ§Øª:

#### 2.1 Ø§Ø¨Ø­Ø« Ø¹Ù† method `StockIn.post()`

#### 2.2 Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ø¹Ø¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù€ stock (Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø·Ø± ~207):

```python
            # ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¢Ø®Ø± Ø´Ø±Ø§Ø¡
            stock.update_last_purchase(
                price=line.unit_cost,
                total=line.total_cost,
                date=self.date,
                supplier=self.supplier if hasattr(self, 'supplier') else None
            )
```

### âœ… Checklist:
- [ ] ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„ØµØ­ÙŠØ­
- [ ] Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ syntax

---

## Ø§Ù„Ù…Ù‡Ù…Ø© 3: Ø¥Ø¶Ø§ÙØ© Helper Methods ÙÙŠ ItemVariant

**Ø§Ù„Ù…Ù„Ù:** `apps/core/models/item_models.py`
**Ø§Ù„Ù…ÙˆÙ‚Ø¹:** ItemVariant class (Ø§Ù„Ø³Ø·Ø± ~328)
**Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:** 1 Ø³Ø§Ø¹Ø©

### Ø§Ù„Ø®Ø·ÙˆØ§Øª:

#### 3.1 Ø§ÙØªØ­ Ø§Ù„Ù…Ù„Ù ÙˆØ§Ù‚Ø±Ø£ ItemVariant Model

#### 3.2 Ø£Ø¶Ù Ù‡Ø°Ù‡ Ø§Ù„Ù€ methods Ø¨Ø¹Ø¯ method `get_full_name()`:

```python
    def get_attribute_values_dict(self):
        """
        Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø®ØµØ§Ø¦Øµ Ø§Ù„Ù…ØªØºÙŠØ± ÙƒÙ€ dictionary

        Returns:
            dict: {attribute_name: value}
        """
        attributes = self.variant_attribute_values.select_related('attribute', 'value')
        return {
            av.attribute.name: av.value.value
            for av in attributes
        }

    def get_stock_across_warehouses(self, company=None):
        """
        Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø±ØµÙŠØ¯ ÙÙŠ ÙƒÙ„ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª

        Args:
            company: Ø§Ù„Ø´Ø±ÙƒØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)

        Returns:
            QuerySet: Ø£Ø±ØµØ¯Ø© Ø§Ù„Ù…Ø§Ø¯Ø© ÙÙŠ ÙƒÙ„ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª
        """
        from apps.inventory.models import ItemStock

        filters = {
            'item': self.item,
            'item_variant': self
        }

        if company:
            filters['company'] = company
        elif self.company:
            filters['company'] = self.company

        return ItemStock.objects.filter(**filters).select_related('warehouse')

    def get_total_stock(self, company=None):
        """
        Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±ØµÙŠØ¯ Ø¹Ø¨Ø± ÙƒÙ„ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª

        Args:
            company: Ø§Ù„Ø´Ø±ÙƒØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)

        Returns:
            dict: {
                'total_quantity': Decimal,
                'total_reserved': Decimal,
                'total_available': Decimal,
                'total_value': Decimal,
                'warehouses_count': int
            }
        """
        from apps.inventory.models import ItemStock

        return ItemStock.get_total_stock(
            item=self.item,
            item_variant=self,
            company=company or self.company
        )

    def get_average_cost(self, company=None):
        """
        Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙƒÙ„ÙØ© Ø¹Ø¨Ø± ÙƒÙ„ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª

        Args:
            company: Ø§Ù„Ø´Ø±ÙƒØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)

        Returns:
            Decimal: Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ù…ÙˆØ²ÙˆÙ†
        """
        stocks = self.get_stock_across_warehouses(company)

        total_value = sum(s.total_value for s in stocks)
        total_quantity = sum(s.quantity for s in stocks)

        if total_quantity > 0:
            return total_value / total_quantity

        # Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ Ø±ØµÙŠØ¯ØŒ Ø£Ø±Ø¬Ø¹ cost_price Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
        return self.cost_price or 0

    def get_total_available(self, company=None):
        """
        Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø© (ØºÙŠØ± Ø§Ù„Ù…Ø­Ø¬ÙˆØ²Ø©)

        Args:
            company: Ø§Ù„Ø´Ø±ÙƒØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)

        Returns:
            Decimal: Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©
        """
        stocks = self.get_stock_across_warehouses(company)
        return sum(s.get_available_quantity() for s in stocks)

    def check_stock_availability(self, quantity, warehouse=None, company=None):
        """
        Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙØ± ÙƒÙ…ÙŠØ© Ù…Ø¹ÙŠÙ†Ø©

        Args:
            quantity: Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
            warehouse: Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ - Ø¥Ø°Ø§ Ù„Ù… ÙŠØ­Ø¯Ø¯ØŒ ÙŠØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª)
            company: Ø§Ù„Ø´Ø±ÙƒØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)

        Returns:
            dict: {
                'available': bool,
                'quantity_available': Decimal,
                'shortage': Decimal
            }
        """
        from apps.inventory.models import ItemStock
        from decimal import Decimal

        if warehouse:
            # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ø³ØªÙˆØ¯Ø¹ Ù…Ø­Ø¯Ø¯
            try:
                stock = ItemStock.objects.get(
                    item=self.item,
                    item_variant=self,
                    warehouse=warehouse,
                    company=company or self.company
                )
                available = stock.get_available_quantity()
            except ItemStock.DoesNotExist:
                available = Decimal('0')
        else:
            # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª
            available = self.get_total_available(company)

        return {
            'available': available >= quantity,
            'quantity_available': available,
            'shortage': max(quantity - available, Decimal('0'))
        }
```

### âœ… Checklist:
- [ ] ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€ methods
- [ ] Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ syntax
- [ ] Ø§Ù„ÙƒÙˆØ¯ Ù…Ù†Ø¸Ù… ÙˆÙ…Ø±ØªØ¨

---

## Ø§Ù„Ù…Ù‡Ù…Ø© 4: Ø¥Ù†Ø´Ø§Ø¡ Django Signals Ù„Ù„Ø±Ø¨Ø· Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ

**Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:** 4-5 Ø³Ø§Ø¹Ø§Øª

### 4.1 Ø¥Ù†Ø´Ø§Ø¡ Signals Ù„Ù„Ù€ Purchases Module

**Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯:** `apps/purchases/signals.py`

#### Ø§Ù„Ø®Ø·ÙˆØ§Øª:

##### 4.1.1 Ø£Ù†Ø´Ø¦ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯:

```python
# apps/purchases/signals.py
"""
Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
ØªØ±Ø¨Ø· ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª Ø¨Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
"""

from django.db.models.signals import post_save, post_delete
from django.dispatch import receiver
from django.db import transaction
from django.core.exceptions import ValidationError
from .models import PurchaseInvoice, PurchaseInvoiceLine
import logging

logger = logging.getLogger(__name__)


@receiver(post_save, sender=PurchaseInvoice)
def create_stock_in_on_purchase_post(sender, instance, created, **kwargs):
    """
    Ø¥Ù†Ø´Ø§Ø¡ Ø³Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ø¹ØªÙ…Ø§Ø¯ ÙØ§ØªÙˆØ±Ø© Ø´Ø±Ø§Ø¡

    ÙŠØªÙ… Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯:
    - Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø© (is_posted = True)
    - Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù„Ù‡Ø§ Ø³Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø³Ø¨Ù‚Ø§Ù‹
    """
    # ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ø¹ØªÙ…Ø¯Ø© ÙˆÙ„Ù… ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø³Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ù„Ù‡Ø§
    if not instance.is_posted:
        return

    # ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø³Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø±ØªØ¨Ø·
    from apps.inventory.models import StockIn

    existing_stock_in = StockIn.objects.filter(
        purchase_invoice=instance,
        company=instance.company
    ).first()

    if existing_stock_in:
        logger.info(f"StockIn already exists for PurchaseInvoice {instance.number}")
        return

    # Ø¥Ù†Ø´Ø§Ø¡ Ø³Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ø¯ÙŠØ¯
    try:
        with transaction.atomic():
            stock_in = StockIn.objects.create(
                company=instance.company,
                branch=getattr(instance, 'branch', None),
                date=instance.invoice_date,
                warehouse=instance.warehouse if hasattr(instance, 'warehouse') else instance.branch.default_warehouse,
                source_type='purchase',
                supplier=instance.supplier if hasattr(instance, 'supplier') else None,
                purchase_invoice=instance,
                reference=instance.number,
                notes=f'Ø³Ù†Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„ÙØ§ØªÙˆØ±Ø© Ø´Ø±Ø§Ø¡ {instance.number}',
                created_by=instance.created_by
            )

            # Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø·ÙˆØ± Ø§Ù„Ø³Ù†Ø¯ Ù…Ù† Ø³Ø·ÙˆØ± Ø§Ù„ÙØ§ØªÙˆØ±Ø©
            from apps.inventory.models import StockDocumentLine

            for line in instance.lines.all():
                # ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„ØµÙ†Ù Ù„Ù‡ Ù…Ø®Ø²ÙˆÙ† (ÙŠÙ…ÙƒÙ† ØªØ®Ø·ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª)
                if not line.item:
                    continue

                StockDocumentLine.objects.create(
                    stock_in=stock_in,
                    item=line.item,
                    item_variant=line.item_variant if hasattr(line, 'item_variant') else None,
                    quantity=line.quantity,
                    unit_cost=line.unit_price,  # Ø£Ùˆ line.unit_cost Ø­Ø³Ø¨ Ø§Ù„Ù€ model
                    notes=line.description or ''
                )

            # ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ø³Ù†Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            stock_in.post(user=instance.created_by)

            logger.info(f"StockIn {stock_in.number} created and posted for PurchaseInvoice {instance.number}")

    except Exception as e:
        logger.error(f"Error creating StockIn for PurchaseInvoice {instance.number}: {str(e)}")
        # Ù„Ø§ Ù†Ø±ÙØ¹ exception Ù„Ø¹Ø¯Ù… Ù…Ù†Ø¹ Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø©


@receiver(post_delete, sender=PurchaseInvoice)
def delete_stock_in_on_purchase_delete(sender, instance, **kwargs):
    """
    Ø­Ø°Ù Ø³Ù†Ø¯ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†Ø¯ Ø­Ø°Ù ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø´Ø±Ø§Ø¡
    """
    from apps.inventory.models import StockIn

    try:
        stock_ins = StockIn.objects.filter(
            purchase_invoice=instance,
            company=instance.company
        )

        for stock_in in stock_ins:
            # Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ±Ø­ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹
            if stock_in.is_posted:
                stock_in.unpost()

            # Ø«Ù… Ø§Ù„Ø­Ø°Ù
            stock_in.delete()
            logger.info(f"StockIn {stock_in.number} deleted with PurchaseInvoice {instance.number}")

    except Exception as e:
        logger.error(f"Error deleting StockIn for PurchaseInvoice {instance.number}: {str(e)}")
```

##### 4.1.2 Ù‚Ù… Ø¨ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù€ Signals ÙÙŠ AppConfig:

**Ø§Ù„Ù…Ù„Ù:** `apps/purchases/apps.py`

Ø£Ø¶Ù:

```python
class PurchasesConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'apps.purchases'
    verbose_name = 'Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª'

    def ready(self):
        """ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª Ø¹Ù†Ø¯ ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚"""
        import apps.purchases.signals  # noqa
```

### âœ… Checklist:
- [ ] ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù signals.py ÙÙŠ purchases
- [ ] ØªÙ… Ø¥Ø¶Ø§ÙØ© signal Ù„Ù€ post_save
- [ ] ØªÙ… Ø¥Ø¶Ø§ÙØ© signal Ù„Ù€ post_delete
- [ ] ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù€ signals ÙÙŠ apps.py
- [ ] Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ syntax

---

### 4.2 Ø¥Ù†Ø´Ø§Ø¡ Signals Ù„Ù„Ù€ Sales Module

**Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯:** `apps/sales/signals.py`

#### Ø§Ù„Ø®Ø·ÙˆØ§Øª:

##### 4.2.1 Ø£Ù†Ø´Ø¦ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯:

```python
# apps/sales/signals.py
"""
Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
ØªØ±Ø¨Ø· ÙÙˆØ§ØªÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø¨Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
"""

from django.db.models.signals import post_save, post_delete
from django.dispatch import receiver
from django.db import transaction
from django.core.exceptions import ValidationError
from .models import SalesInvoice, SalesInvoiceLine
import logging

logger = logging.getLogger(__name__)


@receiver(post_save, sender=SalesInvoice)
def create_stock_out_on_sales_post(sender, instance, created, **kwargs):
    """
    Ø¥Ù†Ø´Ø§Ø¡ Ø³Ù†Ø¯ Ø¥Ø®Ø±Ø§Ø¬ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ø¹ØªÙ…Ø§Ø¯ ÙØ§ØªÙˆØ±Ø© Ø¨ÙŠØ¹

    ÙŠØªÙ… Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯:
    - Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø© (is_posted = True)
    - Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù„Ù‡Ø§ Ø³Ù†Ø¯ Ø¥Ø®Ø±Ø§Ø¬ Ù…Ø³Ø¨Ù‚Ø§Ù‹
    """
    # ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ø¹ØªÙ…Ø¯Ø©
    if not instance.is_posted:
        return

    # ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø³Ù†Ø¯ Ø¥Ø®Ø±Ø§Ø¬ Ù…Ø±ØªØ¨Ø·
    from apps.inventory.models import StockOut

    existing_stock_out = StockOut.objects.filter(
        sales_invoice=instance,
        company=instance.company
    ).first()

    if existing_stock_out:
        logger.info(f"StockOut already exists for SalesInvoice {instance.number}")
        return

    # Ø¥Ù†Ø´Ø§Ø¡ Ø³Ù†Ø¯ Ø¥Ø®Ø±Ø§Ø¬ Ø¬Ø¯ÙŠØ¯
    try:
        with transaction.atomic():
            stock_out = StockOut.objects.create(
                company=instance.company,
                branch=getattr(instance, 'branch', None),
                date=instance.invoice_date,
                warehouse=instance.warehouse if hasattr(instance, 'warehouse') else instance.branch.default_warehouse,
                destination_type='sales',
                customer=instance.customer if hasattr(instance, 'customer') else None,
                sales_invoice=instance,
                reference=instance.number,
                notes=f'Ø³Ù†Ø¯ Ø¥Ø®Ø±Ø§Ø¬ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„ÙØ§ØªÙˆØ±Ø© Ø¨ÙŠØ¹ {instance.number}',
                created_by=instance.created_by
            )

            # Ø¥Ù†Ø´Ø§Ø¡ Ø³Ø·ÙˆØ± Ø§Ù„Ø³Ù†Ø¯ Ù…Ù† Ø³Ø·ÙˆØ± Ø§Ù„ÙØ§ØªÙˆØ±Ø©
            from apps.inventory.models import StockDocumentLine

            for line in instance.lines.all():
                # ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„ØµÙ†Ù Ù„Ù‡ Ù…Ø®Ø²ÙˆÙ† (ÙŠÙ…ÙƒÙ† ØªØ®Ø·ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª)
                if not line.item:
                    continue

                StockDocumentLine.objects.create(
                    stock_out=stock_out,
                    item=line.item,
                    item_variant=line.item_variant if hasattr(line, 'item_variant') else None,
                    quantity=line.quantity,
                    unit_cost=0,  # Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ù…Ù† Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙƒÙ„ÙØ© Ø¹Ù†Ø¯ Ø§Ù„ØªØ±Ø­ÙŠÙ„
                    notes=line.description or ''
                )

            # ØªØ±Ø­ÙŠÙ„ Ø§Ù„Ø³Ù†Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
            # Ù‡Ù†Ø§ Ø³ÙŠØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªÙˆÙØ± Ø§Ù„ÙƒÙ…ÙŠØ© ÙˆØ±ÙØ¹ exception Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ØªÙˆÙØ±Ø©
            stock_out.post(user=instance.created_by)

            logger.info(f"StockOut {stock_out.number} created and posted for SalesInvoice {instance.number}")

    except ValidationError as ve:
        # Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙ…ÙŠØ© - ÙŠØ¬Ø¨ Ø¥Ø¨Ù„Ø§Øº Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        logger.error(f"Validation error creating StockOut for SalesInvoice {instance.number}: {str(ve)}")
        # ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ù†Ø§
        raise  # Ø¥Ø¹Ø§Ø¯Ø© Ø±ÙØ¹ Ø§Ù„Ø®Ø·Ø£ Ù„Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ©

    except Exception as e:
        logger.error(f"Error creating StockOut for SalesInvoice {instance.number}: {str(e)}")
        # Ù„Ø§ Ù†Ø±ÙØ¹ exception Ù„Ø¹Ø¯Ù… Ù…Ù†Ø¹ Ø­ÙØ¸ Ø§Ù„ÙØ§ØªÙˆØ±Ø© ÙÙŠ Ø­Ø§Ù„Ø§Øª Ø£Ø®Ø±Ù‰


@receiver(post_delete, sender=SalesInvoice)
def delete_stock_out_on_sales_delete(sender, instance, **kwargs):
    """
    Ø­Ø°Ù Ø³Ù†Ø¯ Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬ Ø¹Ù†Ø¯ Ø­Ø°Ù ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø¨ÙŠØ¹
    """
    from apps.inventory.models import StockOut

    try:
        stock_outs = StockOut.objects.filter(
            sales_invoice=instance,
            company=instance.company
        )

        for stock_out in stock_outs:
            # Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ±Ø­ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹
            if stock_out.is_posted:
                stock_out.unpost()

            # Ø«Ù… Ø§Ù„Ø­Ø°Ù
            stock_out.delete()
            logger.info(f"StockOut {stock_out.number} deleted with SalesInvoice {instance.number}")

    except Exception as e:
        logger.error(f"Error deleting StockOut for SalesInvoice {instance.number}: {str(e)}")
```

##### 4.2.2 Ù‚Ù… Ø¨ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù€ Signals ÙÙŠ AppConfig:

**Ø§Ù„Ù…Ù„Ù:** `apps/sales/apps.py`

Ø£Ø¶Ù:

```python
class SalesConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'apps.sales'
    verbose_name = 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª'

    def ready(self):
        """ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª Ø¹Ù†Ø¯ ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚"""
        import apps.sales.signals  # noqa
```

### âœ… Checklist:
- [ ] ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù signals.py ÙÙŠ sales
- [ ] ØªÙ… Ø¥Ø¶Ø§ÙØ© signal Ù„Ù€ post_save
- [ ] ØªÙ… Ø¥Ø¶Ø§ÙØ© signal Ù„Ù€ post_delete
- [ ] ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù€ signals ÙÙŠ apps.py
- [ ] Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ syntax

---

### 4.3 ØªØ­Ø³ÙŠÙ† Inventory Signals

**Ø§Ù„Ù…Ù„Ù:** `apps/inventory/signals.py` (Ù…ÙˆØ¬ÙˆØ¯)

#### Ø§Ù„Ø®Ø·ÙˆØ§Øª:

##### 4.3.1 Ø§Ù‚Ø±Ø£ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ¹Ø¯Ù‘Ù„Ù‡:

```python
# apps/inventory/signals.py
"""
Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
"""
from django.db.models.signals import post_save, pre_delete
from django.dispatch import receiver
from .models import ItemStock
import logging

logger = logging.getLogger(__name__)


@receiver(post_save, sender=ItemStock)
def check_low_stock_alert(sender, instance, created, **kwargs):
    """
    Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡
    """
    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰
    if instance.is_below_min_level():
        logger.warning(
            f"Low stock alert: {instance.item.name} "
            f"(Variant: {instance.item_variant.code if instance.item_variant else 'N/A'}) "
            f"in warehouse {instance.warehouse.name}. "
            f"Current: {instance.quantity}, Min: {instance.min_level}"
        )
        # ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ù‡Ù†Ø§
        # Ù…Ù† Ø®Ù„Ø§Ù„ notification system Ø£Ùˆ email

    # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†Ù‚Ø·Ø© Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø·Ù„Ø¨
    if instance.check_reorder_needed():
        logger.info(
            f"Reorder point reached: {instance.item.name} "
            f"(Variant: {instance.item_variant.code if instance.item_variant else 'N/A'}) "
            f"in warehouse {instance.warehouse.name}. "
            f"Current: {instance.quantity}, Reorder Point: {instance.reorder_point}"
        )
        # ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù‡Ù†Ø§


@receiver(post_save, sender=ItemStock)
def delete_empty_stock(sender, instance, **kwargs):
    """
    Ø­Ø°Ù Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø§Ø¯Ø© Ø¥Ø°Ø§ Ø£ØµØ¨Ø­ ØµÙØ± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)

    Ù…Ù„Ø§Ø­Ø¸Ø©: Ù…Ø¹Ø·Ù„ Ø­Ø§Ù„ÙŠØ§Ù‹ Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠ
    ÙŠÙ…ÙƒÙ† ØªÙØ¹ÙŠÙ„Ù‡ Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©
    """
    # if instance.quantity == 0 and instance.reserved_quantity == 0:
    #     instance.delete()
    #     logger.info(f"Deleted empty stock for {instance.item.name} in {instance.warehouse.name}")
    pass


@receiver(pre_delete, sender=ItemStock)
def prevent_delete_if_has_balance(sender, instance, **kwargs):
    """
    Ù…Ù†Ø¹ Ø­Ø°Ù Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø§Ø¯Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ù‡ Ø±ØµÙŠØ¯
    """
    from django.core.exceptions import ValidationError

    if instance.quantity != 0:
        raise ValidationError(
            f'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø±ØµÙŠØ¯ Ø§Ù„Ù…Ø§Ø¯Ø© {instance.item.name} '
            f'ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ {instance.warehouse.name} Ù„Ø£Ù† Ø§Ù„Ø±ØµÙŠØ¯ = {instance.quantity}'
        )
```

### âœ… Checklist:
- [ ] ØªÙ… ØªØ­Ø¯ÙŠØ« inventory signals
- [ ] ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† low stock
- [ ] ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø¹ Ø§Ù„Ø­Ø°Ù Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ø±ØµÙŠØ¯
- [ ] Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ syntax

---

## Ø§Ù„Ù…Ù‡Ù…Ø© 5: Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ StockMovement.balance_before

**Ø§Ù„Ù…Ù„Ù:** `apps/inventory/models.py`
**Ø§Ù„Ù…ÙˆÙ‚Ø¹:** StockMovement class (Ø§Ù„Ø³Ø·Ø± ~1311)
**Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:** 30 Ø¯Ù‚ÙŠÙ‚Ø©

### Ø§Ù„Ø®Ø·ÙˆØ§Øª:

#### 5.1 Ø£Ø¶Ù Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù‚Ø¨Ù„ `balance_quantity`:

```python
    # Ø§Ù„Ø±ØµÙŠØ¯ Ù‚Ø¨Ù„ ÙˆØ¨Ø¹Ø¯ Ø§Ù„Ø­Ø±ÙƒØ©
    balance_before = models.DecimalField(
        _('Ø±ØµÙŠØ¯ Ø§Ù„ÙƒÙ…ÙŠØ© Ù‚Ø¨Ù„ Ø§Ù„Ø­Ø±ÙƒØ©'),
        max_digits=12,
        decimal_places=3,
        default=0,
        help_text=_('Ø§Ù„Ø±ØµÙŠØ¯ Ù‚Ø¨Ù„ ØªØ·Ø¨ÙŠÙ‚ Ù‡Ø°Ù‡ Ø§Ù„Ø­Ø±ÙƒØ©')
    )

    balance_quantity = models.DecimalField(
        _('Ø±ØµÙŠØ¯ Ø§Ù„ÙƒÙ…ÙŠØ©'),
        max_digits=12,
        decimal_places=3
    )
```

#### 5.2 Ø¹Ø¯Ù‘Ù„ ÙƒÙˆØ¯ Ø¥Ù†Ø´Ø§Ø¡ StockMovement ÙÙŠ StockIn.post():

Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø°ÙŠ ÙŠÙ†Ø´Ø¦ StockMovement (~209) ÙˆØ¹Ø¯Ù‘Ù„Ù‡:

```python
            # Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø§Ø¯Ø©
            StockMovement.objects.create(
                company=self.company,
                branch=getattr(self, 'branch', None),
                date=timezone.now(),
                movement_type='in',
                item=line.item,
                item_variant=line.item_variant,
                warehouse=self.warehouse,
                quantity=line.quantity,
                unit_cost=line.unit_cost,
                total_cost=line.total_cost,
                balance_before=old_quantity,  # Ø¥Ø¶Ø§ÙØ©
                balance_quantity=stock.quantity,
                balance_value=stock.total_value,
                reference_type='stock_in',
                reference_id=self.pk,
                reference_number=self.number,
                created_by=user or self.created_by
            )
```

#### 5.3 Ø¹Ø¯Ù‘Ù„ ÙƒÙˆØ¯ Ø¥Ù†Ø´Ø§Ø¡ StockMovement ÙÙŠ StockOut.post():

Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø³Ø·Ø± Ø§Ù„Ø°ÙŠ ÙŠÙ†Ø´Ø¦ StockMovement (~561) ÙˆØ¹Ø¯Ù‘Ù„Ù‡:

```python
            # Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø±ÙƒØ© Ø§Ù„Ù…Ø§Ø¯Ø©
            StockMovement.objects.create(
                company=self.company,
                branch=getattr(self, 'branch', None),
                date=timezone.now(),
                movement_type='out',
                item=line.item,
                item_variant=line.item_variant,
                warehouse=self.warehouse,
                quantity=-line.quantity,
                unit_cost=line.unit_cost,
                total_cost=-line.total_cost,
                balance_before=old_quantity,  # Ø¥Ø¶Ø§ÙØ©
                balance_quantity=stock.quantity,
                balance_value=stock.total_value,
                reference_type='stock_out',
                reference_id=self.pk,
                reference_number=self.number,
                created_by=user or self.created_by
            )
```

#### 5.4 Ø¹Ø¯Ù‘Ù„ ÙƒÙˆØ¯ StockTransfer Ø£ÙŠØ¶Ø§Ù‹ (Ø³Ø·Ø± ~1034 Ùˆ ~1110):

**ÙÙŠ send() method:**
```python
            StockMovement.objects.create(
                # ...
                balance_before=old_quantity,  # Ø¥Ø¶Ø§ÙØ©
                balance_quantity=source_stock.quantity,
                # ...
            )
```

**ÙÙŠ receive() method:**
```python
            StockMovement.objects.create(
                # ...
                balance_before=old_quantity,  # Ø¥Ø¶Ø§ÙØ©
                balance_quantity=dest_stock.quantity,
                # ...
            )
```

#### 5.5 Ù‚Ù… Ø¨Ø¹Ù…Ù„ Migration:

```bash
python manage.py makemigrations inventory -n add_balance_before
python manage.py migrate inventory
```

### âœ… Checklist:
- [ ] ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ balance_before
- [ ] ØªÙ… ØªØ­Ø¯ÙŠØ« StockIn.post()
- [ ] ØªÙ… ØªØ­Ø¯ÙŠØ« StockOut.post()
- [ ] ØªÙ… ØªØ­Ø¯ÙŠØ« StockTransfer methods
- [ ] ØªÙ… Ø¹Ù…Ù„ migration Ø¨Ù†Ø¬Ø§Ø­
- [ ] Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡

---

## Ø§Ù„Ù…Ù‡Ù…Ø© 6: Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙƒØ§Ù…Ù„ Ø§Ù„ÙƒØ§Ù…Ù„

**Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:** 2 Ø³Ø§Ø¹Ø©

### Ø§Ù„Ø®Ø·ÙˆØ§Øª:

#### 6.1 Ø§Ø®ØªØ¨Ø± Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¯ÙˆÙŠØ§Ù‹:

```bash
# Ø´ØºÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ±
python manage.py runserver
```

##### 6.1.1 Ø§Ø®ØªØ¨Ø§Ø± Ø¯ÙˆØ±Ø© Ø§Ù„Ø´Ø±Ø§Ø¡:
1. Ø§ÙØªØ­ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
2. Ø£Ù†Ø´Ø¦ ÙØ§ØªÙˆØ±Ø© Ø´Ø±Ø§Ø¡ Ø¬Ø¯ÙŠØ¯Ø©
3. Ø£Ø¶Ù Ø£ØµÙ†Ø§Ù
4. Ø§Ø¹ØªÙ…Ø¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
5. **ØªØ­Ù‚Ù‚:** Ù‡Ù„ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ StockIn ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ØŸ
6. **ØªØ­Ù‚Ù‚:** Ù‡Ù„ ØªÙ… ØªØ­Ø¯ÙŠØ« ItemStockØŸ
7. **ØªØ­Ù‚Ù‚:** Ù‡Ù„ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ StockMovementØŸ
8. **ØªØ­Ù‚Ù‚:** Ù‡Ù„ ØªÙ… ØªØ­Ø¯ÙŠØ« last_purchase_* fieldsØŸ

##### 6.1.2 Ø§Ø®ØªØ¨Ø§Ø± Ø¯ÙˆØ±Ø© Ø§Ù„Ø¨ÙŠØ¹:
1. Ø§ÙØªØ­ Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
2. Ø£Ù†Ø´Ø¦ ÙØ§ØªÙˆØ±Ø© Ø¨ÙŠØ¹ Ø¬Ø¯ÙŠØ¯Ø©
3. Ø£Ø¶Ù Ø£ØµÙ†Ø§Ù (Ù…ØªÙˆÙØ±Ø© ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†)
4. Ø§Ø¹ØªÙ…Ø¯ Ø§Ù„ÙØ§ØªÙˆØ±Ø©
5. **ØªØ­Ù‚Ù‚:** Ù‡Ù„ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ StockOut ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ØŸ
6. **ØªØ­Ù‚Ù‚:** Ù‡Ù„ ØªÙ… ØªØ­Ø¯ÙŠØ« ItemStock (Ù†Ù‚Øµ Ø§Ù„ÙƒÙ…ÙŠØ©)ØŸ
7. **ØªØ­Ù‚Ù‚:** Ù‡Ù„ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ StockMovementØŸ
8. **ØªØ­Ù‚Ù‚:** Ù‡Ù„ Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙƒÙ„ÙØ© Ø«Ø§Ø¨ØªØŸ

##### 6.1.3 Ø§Ø®ØªØ¨Ø§Ø± Ù…Ù†Ø¹ Ø§Ù„Ø¨ÙŠØ¹ Ø¹Ù†Ø¯ Ø¹Ø¯Ù… ØªÙˆÙØ± Ø§Ù„ÙƒÙ…ÙŠØ©:
1. Ø­Ø§ÙˆÙ„ Ø¨ÙŠØ¹ ÙƒÙ…ÙŠØ© Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ù…ØªØ§Ø­
2. **ØªØ­Ù‚Ù‚:** Ù‡Ù„ ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©ØŸ
3. **ØªØ­Ù‚Ù‚:** Ù‡Ù„ Ø¸Ù‡Ø±Øª Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£ ÙˆØ§Ø¶Ø­Ø©ØŸ

##### 6.1.4 Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø§Ù„ÙƒØ§Ù…Ù„:
```
Ø´Ø±Ø§Ø¡ 100 Ù‚Ø·Ø¹Ø© Ø¨Ø³Ø¹Ø± 10 Ø¯ÙŠÙ†Ø§Ø±
â†’ Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙƒÙ„ÙØ© = 10

Ø´Ø±Ø§Ø¡ 50 Ù‚Ø·Ø¹Ø© Ø¨Ø³Ø¹Ø± 12 Ø¯ÙŠÙ†Ø§Ø±
â†’ Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙƒÙ„ÙØ© = (100Ã—10 + 50Ã—12) / 150 = 10.67

Ø¨ÙŠØ¹ 80 Ù‚Ø·Ø¹Ø©
â†’ Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙƒÙ„ÙØ© ÙŠØ¨Ù‚Ù‰ 10.67
â†’ Ø§Ù„Ø±ØµÙŠØ¯ = 70
â†’ Ø§Ù„Ù‚ÙŠÙ…Ø© = 70 Ã— 10.67 = 746.67
```

#### 6.2 ØªØ­Ù‚Ù‚ Ù…Ù† Logs:

```bash
# Ø§ÙØªØ­ Ù…Ù„Ù django.log
tail -f django.log
```

Ø§Ø¨Ø­Ø« Ø¹Ù† Ø±Ø³Ø§Ø¦Ù„:
- "StockIn created and posted for PurchaseInvoice"
- "StockOut created and posted for SalesInvoice"
- "Low stock alert"
- Ø£ÙŠ Ø£Ø®Ø·Ø§Ø¡

### âœ… Checklist:
- [ ] Ø¯ÙˆØ±Ø© Ø§Ù„Ø´Ø±Ø§Ø¡ ØªØ¹Ù…Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
- [ ] Ø¯ÙˆØ±Ø© Ø§Ù„Ø¨ÙŠØ¹ ØªØ¹Ù…Ù„ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
- [ ] Ù…Ù†Ø¹ Ø§Ù„Ø¨ÙŠØ¹ Ø¹Ù†Ø¯ Ù†ÙØ§Ø¯ Ø§Ù„ÙƒÙ…ÙŠØ© ÙŠØ¹Ù…Ù„
- [ ] Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙƒÙ„ÙØ© ØµØ­ÙŠØ­
- [ ] Ø§Ù„Ù€ Signals ØªØ¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
- [ ] last_purchase fields ØªØªØ­Ø¯Ø«
- [ ] balance_before ÙŠÙØ­ÙØ¸ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
- [ ] Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ù„Ù€ logs

---

## ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1A

Ø¹Ù†Ø¯ Ø¥ØªÙ…Ø§Ù… ÙƒÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… Ø£Ø¹Ù„Ø§Ù‡ØŒ Ø³ØªÙƒÙˆÙ† Ù‚Ø¯ Ø£ÙƒÙ…Ù„Øª:

âœ… **Ù…Ø§ ØªÙ… Ø¥Ù†Ø¬Ø§Ø²Ù‡:**
1. Ø¥Ø¶Ø§ÙØ© 9 Ø­Ù‚ÙˆÙ„ Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ ItemStock
2. Ø¥Ø¶Ø§ÙØ© 7 methods Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ ItemStock
3. Ø¥Ø¶Ø§ÙØ© 7 methods Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ ItemVariant
4. Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø¸Ø§Ù… Signals ÙƒØ§Ù…Ù„ Ù„Ù„Ø±Ø¨Ø· Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
5. ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù€ StockMovement Ù„Ø­ÙØ¸ balance_before
6. Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙƒØ§Ù…Ù„ Ø§Ù„ÙƒØ§Ù…Ù„

âœ… **Ø§Ù„Ù†ØªÙŠØ¬Ø©:**
- Ù†Ø¸Ø§Ù… Ù…Ø®Ø²ÙˆÙ† Ù…ØªÙƒØ§Ù…Ù„ 100%
- Ø±Ø¨Ø· ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¨ÙŠÙ† Ø§Ù„ÙÙˆØ§ØªÙŠØ± ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ†
- ØªØªØ¨Ø¹ Ø¯Ù‚ÙŠÙ‚ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø±ÙƒØ§Øª
- Ø­Ø³Ø§Ø¨ ØµØ­ÙŠØ­ Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙƒÙ„ÙØ©

---

# ğŸŸ¡ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1B: Ø§Ù„ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø©

## Ø§Ù„Ù…Ù‡Ù…Ø© 7: ØªØ­Ø³ÙŠÙ† Indexes Ù„Ù„Ø£Ø¯Ø§Ø¡

**Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:** 1 Ø³Ø§Ø¹Ø©

### Ø§Ù„Ø®Ø·ÙˆØ§Øª:

#### 7.1 ÙÙŠ Item Model:

**Ø§Ù„Ù…Ù„Ù:** `apps/core/models/item_models.py`

Ø£Ø¶Ù ÙÙŠ class Meta (Ø¨Ø¹Ø¯ ordering):

```python
    class Meta:
        verbose_name = _('Ù…Ø§Ø¯Ø©')
        verbose_name_plural = _('Ø§Ù„Ù…ÙˆØ§Ø¯')
        ordering = ['name']
        unique_together = [['code', 'company'], ['barcode', 'company']]
        indexes = [
            models.Index(fields=['category', 'is_active']),
            models.Index(fields=['category', 'company']),
            models.Index(fields=['is_active', 'company']),
            models.Index(fields=['barcode']),
        ]
```

#### 7.2 ÙÙŠ ItemVariant Model:

Ø£Ø¶Ù ÙÙŠ class Meta:

```python
    class Meta:
        verbose_name = _('Ù…ØªØºÙŠØ± Ø§Ù„Ù…Ø§Ø¯Ø©')
        verbose_name_plural = _('Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù…ÙˆØ§Ø¯')
        ordering = ['item', 'code']
        unique_together = [['item', 'code']]
        indexes = [
            models.Index(fields=['item', 'is_active']),
            models.Index(fields=['barcode']),
        ]
```

#### 7.3 ÙÙŠ StockMovement Model:

Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ù€ indexes Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©:

```python
    class Meta:
        # ...
        indexes = [
            models.Index(fields=['item', 'warehouse', '-date']),
            models.Index(fields=['reference_type', 'reference_id']),
            models.Index(fields=['warehouse', 'movement_type', '-date']),
            models.Index(fields=['company', '-date']),
        ]
```

#### 7.4 Ù‚Ù… Ø¨Ø¹Ù…Ù„ Migration:

```bash
python manage.py makemigrations core inventory -n improve_indexes
python manage.py migrate
```

### âœ… Checklist:
- [ ] ØªÙ… Ø¥Ø¶Ø§ÙØ© indexes ÙÙŠ Item
- [ ] ØªÙ… Ø¥Ø¶Ø§ÙØ© indexes ÙÙŠ ItemVariant
- [ ] ØªÙ… ØªØ­Ø³ÙŠÙ† indexes ÙÙŠ StockMovement
- [ ] ØªÙ… Ø¹Ù…Ù„ migration Ø¨Ù†Ø¬Ø§Ø­

---

## Ø§Ù„Ù…Ù‡Ù…Ø© 8: Ø¥Ø¶Ø§ÙØ© Validations Ù…ØªÙ‚Ø¯Ù…Ø©

**Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:** 2 Ø³Ø§Ø¹Ø©

### 8.1 Ù…Ù†Ø¹ Ø­Ø°Ù Item Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ù‡ Ø±ØµÙŠØ¯

**Ø§Ù„Ù…Ù„Ù:** `apps/core/models/item_models.py`

Ø£Ø¶Ù ÙÙŠ Item class:

```python
    def delete(self, *args, **kwargs):
        """Ù…Ù†Ø¹ Ø§Ù„Ø­Ø°Ù Ø¥Ø°Ø§ ÙƒØ§Ù† Ù„Ù„Ù…Ø§Ø¯Ø© Ø±ØµÙŠØ¯ ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†"""
        from apps.inventory.models import ItemStock
        from django.core.exceptions import ValidationError

        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø±ØµÙŠØ¯
        stock_exists = ItemStock.objects.filter(
            item=self,
            quantity__gt=0
        ).exists()

        if stock_exists:
            raise ValidationError(
                f'Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø­Ø°Ù Ø§Ù„Ù…Ø§Ø¯Ø© "{self.name}" Ù„Ø£Ù† Ù„Ù‡Ø§ Ø±ØµÙŠØ¯ ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†. '
                'ÙŠØ±Ø¬Ù‰ Ø¥ÙØ±Ø§Øº Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø£ÙˆÙ„Ø§Ù‹ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… "Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¥Ù†ØªØ§Ø¬".'
            )

        super().delete(*args, **kwargs)
```

### 8.2 Ù…Ù†Ø¹ ØªØ¹Ø·ÙŠÙ„ Warehouse Ø¥Ø°Ø§ ÙƒØ§Ù† ÙÙŠÙ‡ Ø±ØµÙŠØ¯

**Ø§Ù„Ù…Ù„Ù:** `apps/core/models/company_models.py`

Ø£Ø¶Ù ÙÙŠ Warehouse class:

```python
    def save(self, *args, **kwargs):
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        if self.is_main:
            Warehouse.objects.filter(company=self.company, is_main=True).exclude(pk=self.pk).update(is_main=False)

        # Ù…Ù†Ø¹ Ø§Ù„ØªØ¹Ø·ÙŠÙ„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø±ØµÙŠØ¯
        if not self.is_active and self.pk:  # ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„Ù‰ Ù…Ø³ØªÙˆØ¯Ø¹ Ù…ÙˆØ¬ÙˆØ¯
            from apps.inventory.models import ItemStock
            from django.core.exceptions import ValidationError

            stock_exists = ItemStock.objects.filter(
                warehouse=self,
                quantity__gt=0
            ).exists()

            if stock_exists:
                raise ValidationError(
                    f'Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ "{self.name}" Ù„Ø£Ù† Ø¨Ù‡ Ø£Ø±ØµØ¯Ø©. '
                    'ÙŠØ±Ø¬Ù‰ Ù†Ù‚Ù„ Ø£Ùˆ Ø¥ÙØ±Ø§Øº Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø£ÙˆÙ„Ø§Ù‹.'
                )

        super().save(*args, **kwargs)
```

### 8.3 Ù…Ù†Ø¹ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø³Ø§Ù„Ø¨ (Ø­Ø³Ø¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª warehouse)

**Ø§Ù„Ù…Ù„Ù:** `apps/inventory/models.py`

Ø¹Ø¯Ù‘Ù„ ÙÙŠ StockOut.post() method (Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ø·Ø± ~537):

```python
            # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø©
            available_quantity = stock.quantity - stock.reserved_quantity

            # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø³Ø§Ù„Ø¨
            if not self.warehouse.allow_negative_stock:
                if available_quantity < line.quantity:
                    raise ValidationError(
                        f'Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø© Ù…Ù† {line.item.name} ({available_quantity}) '
                        f'Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ({line.quantity}). '
                        f'Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ "{self.warehouse.name}" Ù„Ø§ ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø³Ø§Ù„Ø¨.'
                    )
            else:
                # ØªØ­Ø°ÙŠØ± ÙÙ‚Ø·
                if available_quantity < line.quantity:
                    logger.warning(
                        f'Negative stock will occur for {line.item.name} '
                        f'in warehouse {self.warehouse.name}. '
                        f'Available: {available_quantity}, Required: {line.quantity}'
                    )
```

### âœ… Checklist:
- [ ] ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø¹ Ø­Ø°Ù Item Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ø±ØµÙŠØ¯
- [ ] ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ù†Ø¹ ØªØ¹Ø·ÙŠÙ„ Warehouse Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ø±ØµÙŠØ¯
- [ ] ØªÙ… ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø³Ø§Ù„Ø¨
- [ ] Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡

---

## Ø§Ù„Ù…Ù‡Ù…Ø© 9: ØªØ­Ø³ÙŠÙ† Warehouse Model

**Ø§Ù„Ù…Ù„Ù:** `apps/core/models/company_models.py`
**Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:** 1 Ø³Ø§Ø¹Ø©

### Ø§Ù„Ø®Ø·ÙˆØ§Øª:

#### 9.1 Ø£Ø¶Ù Ø­Ù‚Ù„ branch:

```python
    branch = models.ForeignKey(
        'Branch',
        on_delete=models.CASCADE,
        related_name='warehouses',
        verbose_name=_('Ø§Ù„ÙØ±Ø¹'),
        help_text=_('Ø§Ù„ÙØ±Ø¹ Ø§Ù„ØªØ§Ø¨Ø¹ Ù„Ù‡ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹')
    )
```

#### 9.2 Ø£Ø¶Ù Ø­Ù‚Ù„ warehouse_type:

```python
    WAREHOUSE_TYPE_CHOICES = [
        ('main', _('Ø±Ø¦ÙŠØ³ÙŠ')),
        ('branch', _('ÙØ±Ø¹ÙŠ')),
        ('transit', _('ØªØ±Ø§Ù†Ø²ÙŠØª')),
        ('damaged', _('ØªØ§Ù„Ù')),
        ('returns', _('Ù…Ø±ØªØ¬Ø¹Ø§Øª')),
        ('quarantine', _('Ø­Ø¬Ø± ØµØ­ÙŠ')),
        ('virtual', _('Ø§ÙØªØ±Ø§Ø¶ÙŠ')),
    ]

    warehouse_type = models.CharField(
        _('Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹'),
        max_length=20,
        choices=WAREHOUSE_TYPE_CHOICES,
        default='branch',
        help_text=_('ØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø­Ø³Ø¨ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…')
    )
```

#### 9.3 Ø¹Ø¯Ù‘Ù„ unique_together:

```python
    class Meta:
        verbose_name = _('Ù…Ø³ØªÙˆØ¯Ø¹')
        verbose_name_plural = _('Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª')
        unique_together = [['company', 'code'], ['branch', 'code']]
        ordering = ['name']
```

#### 9.4 Ù‚Ù… Ø¨Ø¹Ù…Ù„ Migration:

```bash
python manage.py makemigrations core -n improve_warehouse_model
# Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ù„Ø¥Ø¹Ø·Ø§Ø¡ Ù‚ÙŠÙ…Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ© Ù„Ù„Ù€ branch ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ø©
python manage.py migrate core
```

### âœ… Checklist:
- [ ] ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ branch
- [ ] ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ warehouse_type
- [ ] ØªÙ… ØªØ­Ø¯ÙŠØ« unique_together
- [ ] ØªÙ… Ø¹Ù…Ù„ migration Ø¨Ù†Ø¬Ø§Ø­

---

## ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1B

Ø¹Ù†Ø¯ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1B:

âœ… **ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡:**
- Indexes Ù…Ø­Ø³Ù‘Ù†Ø© Ø¹Ù„Ù‰ Item, ItemVariant, StockMovement
- Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø£Ø³Ø±Ø¹ Ø¨ÙƒØ«ÙŠØ±

âœ… **Validations Ù‚ÙˆÙŠØ©:**
- Ù…Ù†Ø¹ Ø­Ø°Ù items Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ø±ØµÙŠØ¯
- Ù…Ù†Ø¹ ØªØ¹Ø·ÙŠÙ„ warehouses Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ø±ØµÙŠØ¯
- ØªØ­ÙƒÙ… Ø£ÙØ¶Ù„ Ø¨Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø³Ø§Ù„Ø¨

âœ… **Warehouse Model Ø£ÙØ¶Ù„:**
- Ø±Ø¨Ø· Ø¨Ø§Ù„Ù€ branch
- ØªØµÙ†ÙŠÙ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª

---

# ğŸŸ¢ Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1C: ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© (ÙŠÙ…ÙƒÙ† ØªÙ†ÙÙŠØ°Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹)

## Ø§Ù„Ù…Ù‡Ù…Ø© 10: Stock Card Report View

**Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:** 3 Ø³Ø§Ø¹Ø§Øª

### Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:
- Ø¥Ù†Ø´Ø§Ø¡ view Ù„Ø¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ØµÙ†Ù
- Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ø±ÙƒØ§Øª Ù„ØµÙ†Ù Ù…Ø¹ÙŠÙ†
- Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø§ÙØªØªØ§Ø­ÙŠ ÙˆØ§Ù„Ø®ØªØ§Ù…ÙŠ
- Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªØµÙÙŠØ© Ø¨Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ù…Ø³ØªÙˆØ¯Ø¹

**Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:**
- `apps/inventory/views/reports.py` (Ø¬Ø¯ÙŠØ¯)
- `apps/inventory/templates/inventory/stock_card.html` (Ø¬Ø¯ÙŠØ¯)
- ØªØ­Ø¯ÙŠØ« `apps/inventory/urls.py`

*(ÙŠÙ…ÙƒÙ† ØªÙØµÙŠÙ„ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©)*

---

## Ø§Ù„Ù…Ù‡Ù…Ø© 11: Low Stock Alert System

**Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:** 3 Ø³Ø§Ø¹Ø§Øª

### Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:
- Ø¥Ù†Ø´Ø§Ø¡ model Ù„Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª (StockAlert)
- Ø¥Ù†Ø´Ø§Ø¡ view Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
- Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
- Dashboard widget Ù„Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª

*(ÙŠÙ…ÙƒÙ† ØªÙØµÙŠÙ„ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©)*

---

## Ø§Ù„Ù…Ù‡Ù…Ø© 12: Admin Actions

**Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:** 1 Ø³Ø§Ø¹Ø©

### Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨:
- Bulk update Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
- Export Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
- Bulk transfer Ø¨ÙŠÙ† Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª

*(ÙŠÙ…ÙƒÙ† ØªÙØµÙŠÙ„ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©)*

---

# âœ… Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©

## Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1A Ù…ÙƒØªÙ…Ù„Ø© Ø¹Ù†Ø¯Ù…Ø§:
- [x] Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ ItemStock Ù…ÙˆØ¬ÙˆØ¯Ø© ÙˆØªØ¹Ù…Ù„
- [x] Ø¬Ù…ÙŠØ¹ Methods ÙÙŠ ItemVariant ØªØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­
- [x] Signals Ù„Ù„Ù€ purchases ØªØ¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
- [x] Signals Ù„Ù„Ù€ sales ØªØ¹Ù…Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
- [x] balance_before ÙŠÙØ­ÙØ¸ ÙÙŠ ÙƒÙ„ StockMovement
- [x] Ø­Ø³Ø§Ø¨ Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙƒÙ„ÙØ© ØµØ­ÙŠØ­ 100%
- [x] Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³ÙŠÙ†Ø§Ø±ÙŠÙˆ Ø§Ù„ÙƒØ§Ù…Ù„ (Ø´Ø±Ø§Ø¡ â†’ Ø¨ÙŠØ¹) Ù†Ø§Ø¬Ø­
- [x] Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ù„Ù€ migrations
- [x] Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø®Ø·Ø§Ø¡ ÙÙŠ Ø§Ù„Ù€ logs

## Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1B Ù…ÙƒØªÙ…Ù„Ø© Ø¹Ù†Ø¯Ù…Ø§:
- [x] Indexes Ù…Ø­Ø³Ù‘Ù†Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Models
- [x] Validations Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© ØªØ¹Ù…Ù„
- [x] Warehouse Model Ù…Ø­Ø³Ù‘Ù† Ø¨Ù€ branch Ùˆ type
- [x] Ø¬Ù…ÙŠØ¹ Migrations Ù†Ø§Ø¬Ø­Ø©

## Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1C Ù…ÙƒØªÙ…Ù„Ø© Ø¹Ù†Ø¯Ù…Ø§:
- [ ] Stock Card Report ÙŠØ¹Ù…Ù„
- [ ] Low Stock Alerts ØªØ¹Ù…Ù„
- [ ] Admin Actions Ø¬Ø§Ù‡Ø²Ø©

---

# ğŸ¯ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„ØªØ§Ù„ÙŠØ©

**Ø§Ø¨Ø¯Ø£ Ø¨Ø§Ù„Ù…Ø±Ø­Ù„Ø© 1A - Ø§Ù„Ù…Ù‡Ù…Ø© 1**

Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ù‡Ù…Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ØŒ Ù‚Ù… Ø¨Ù…Ø§ ÙŠÙ„ÙŠ:

```
Ø§ÙØªØ­ Ø§Ù„Ù…Ù„Ù apps/inventory/models.py ÙˆØ§Ø¨Ø­Ø« Ø¹Ù† class ItemStock
```

Ø«Ù… Ø§ØªØ¨Ø¹ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ù…Ø°ÙƒÙˆØ±Ø© Ø£Ø¹Ù„Ø§Ù‡ Ø®Ø·ÙˆØ© Ø¨Ø®Ø·ÙˆØ©.

**Ø­Ø¸Ø§Ù‹ Ù…ÙˆÙÙ‚Ø§Ù‹!** ğŸš€
