# متطلبات فواتير البيع والشراء
## Invoice Requirements for Sales and Purchases

تاريخ: 2025-11-09

## المتطلبات الوظيفية (Functional Requirements)

### 1. التحكم في أعمدة بنود الفاتورة (Data Grid Column Control)
**الوصف**: إمكانية إظهار/إخفاء أعمدة بنود الفاتورة حسب المستخدم
**التفاصيل**:
- تخزين تفضيلات المستخدم لعرض الأعمدة
- إمكانية تخصيص العرض لكل مستخدم
- حفظ الإعدادات تلقائياً
- واجهة بسيطة لإدارة الأعمدة المعروضة

**الأولوية**: متوسطة
**الحالة**: غير منفذ

---

### 2. البحث السريع للمواد (Quick Item Search)
**الوصف**: إدخال المادة مباشرة ضمن Data Grid مع بحث مختصر
**التفاصيل**:
- البحث بالأحرف الأولى (مثال: "مف" للبحث عن "مفتاح")
- البحث في: الكود، الاسم، الاسم اللاتيني، الباركود
- عرض النتائج في قائمة منسدلة
- دعم AutoComplete
- عرض معلومات المادة عند الاختيار (السعر، الوحدة، الرصيد)

**المتطلبات التقنية**:
- AJAX autocomplete
- البحث في قاعدة البيانات باستخدام LIKE أو Full-Text Search
- تحسين الأداء للبحث السريع

**الأولوية**: عالية جداً
**الحالة**: غير منفذ

---

### 3. تمييز المواد بالألوان حسب الضريبة (Tax Status Color Coding)
**الوصف**: استخدام ألوان الخلفية للتمييز بين المواد الخاضعة للضريبة والمعفاة
**التفاصيل**:
- **أخضر**: المواد المعفاة من الضريبة
- **أحمر فاتح**: المواد الخاضعة للضريبة
- الألوان يجب أن تكون سهلة القراءة
- تطبيق الألوان على مستوى السطر بالكامل

**الكود اللوني المقترح**:
```css
.tax-exempt {
    background-color: #d4edda; /* أخضر فاتح */
}
.taxable {
    background-color: #f8d7da; /* أحمر فاتح */
}
```

**الأولوية**: متوسطة
**الحالة**: غير منفذ

---

### 4. نوع الدفع والموافقات (Payment Type & Approvals)
**الوصف**: التحكم في نوع الدفع مع نظام موافقات للدفع الآجل
**التفاصيل**:
- **النوع الافتراضي**: نقدي (Cash)
- **أنواع الدفع**:
  - نقدي (Cash) - لا يحتاج موافقة
  - ذمم (Credit/On Account) - يحتاج موافقة المسؤول المباشر
  - شيك (Check)
  - بطاقة ائتمان (Credit Card)
  - تحويل بنكي (Bank Transfer)

**نظام الموافقات**:
- عند اختيار "ذمم"، يتم إرسال طلب موافقة للمسؤول المباشر
- حالات الموافقة: بانتظار الموافقة، موافق عليه، مرفوض
- إشعارات للمسؤول عند ورود طلب موافقة
- إمكانية تحديد حد ائتماني للعميل

**الأولوية**: عالية
**الحالة**: غير منفذ

---

### 5. حالة الفاتورة (Invoice Status)
**الوصف**: عرض واضح لحالة الفاتورة في واجهة المستخدم
**الحالات المطلوبة**:
1. **مسودة** (Draft) - قيد الإنشاء
2. **مرحلة** (Posted) - تم ترحيلها للمخزون والحسابات
3. **مفوترة** (Invoiced) - تم إصدار الفاتورة النهائية
4. **مدفوعة جزئياً** (Partially Paid)
5. **مدفوعة بالكامل** (Fully Paid)
6. **ملغاة** (Cancelled)
7. **مرتجعة** (Returned)

**طريقة العرض**:
- شريط حالة (Status Bar) في أعلى أو أسفل الشاشة
- استخدام ألوان مميزة لكل حالة
- أيقونات توضيحية

**الأولوية**: عالية
**الحالة**: جزئي (موجود في النماذج، يحتاج تحسين في الواجهة)

---

### 6. واجهة مستخدم محسنة - Oracle Forms Style (Enhanced UI)
**الوصف**: واجهة سهلة الاستخدام تعتمد على الكيبورد بشكل أساسي
**المتطلبات**:

#### أ) دعم الكيبورد (Keyboard Support)
- **Tab**: الانتقال للحقل التالي
- **Shift+Tab**: الانتقال للحقل السابق
- **Enter**: حفظ السطر والانتقال للسطر التالي
- **F2**: تعديل السطر الحالي
- **F3**: بحث/إضافة مادة جديدة
- **F4**: عرض قائمة الاختيارات (Dropdown)
- **F5**: تحديث البيانات
- **F9**: حفظ الفاتورة
- **Escape**: إلغاء/العودة
- **Ctrl+D**: حذف السطر
- **Page Up/Down**: التنقل بين الفواتير

#### ب) شريط الحالة (Status Bar)
- عرض معلومات مهمة:
  - حالة الفاتورة
  - إجمالي الفاتورة
  - عدد السطور
  - الرصيد المتاح للعميل
  - رسائل التوجيه (مثل: "اضغط F9 للحفظ")

#### ج) التصميم
- حجم ملائم للأدوات
- تباعد مناسب بين العناصر
- استخدام Grid مرن
- تمييز الحقل النشط بوضوح
- استجابة سريعة

**الأولوية**: عالية جداً
**الحالة**: غير منفذ

---

### 7. تتبع الأسعار وسجل المبيعات (Price Tracking & Sales History)
**الوصف**: عرض آخر سعر بيع مع سجل كامل لحركات البيع
**التفاصيل**:

#### أ) آخر سعر بيع للزبون
- عرض آخر سعر تم بيعه لنفس الزبون
- عرض تاريخ آخر عملية بيع
- مقارنة مع السعر الحالي
- تنبيه في حال اختلاف السعر بنسبة معينة

#### ب) سجل حركات البيع
- عرض جميع عمليات البيع للمادة للزبون
- التفاصيل المطلوبة:
  - التاريخ
  - رقم الفاتورة
  - الكمية
  - السعر
  - الخصم المطبق
  - الإجمالي
  - الفرع
- إمكانية التصفية والبحث
- عرض إحصائيات (متوسط السعر، إجمالي المبيعات)

#### ج) تتبع من كافة الفروع
- عرض البيانات من جميع فروع الشركة
- تمييز الفرع في كل سجل
- إمكانية التصفية حسب الفرع

**واجهة العرض**:
- نافذة منبثقة (Modal/Popup) عند النقر على المادة
- أو قسم جانبي قابل للطي
- جدول مرتب حسب التاريخ (الأحدث أولاً)

**الأولوية**: عالية
**الحالة**: غير منفذ

---

## خطة التنفيذ (Implementation Plan)

### المرحلة الأولى - الأساسيات (Phase 1 - Basics)
1. ✅ نظام الموافقات لنوع الدفع (Payment Type Approvals)
2. ✅ شريط الحالة (Status Bar)
3. ✅ دعم الكيبورد الأساسي (Basic Keyboard Support)

### المرحلة الثانية - البحث والإدخال (Phase 2 - Search & Input)
1. ✅ البحث السريع للمواد (Quick Item Search)
2. ✅ تمييز بالألوان حسب الضريبة (Tax Color Coding)
3. ✅ تتبع الأسعار (Price Tracking)

### المرحلة الثالثة - التخصيص (Phase 3 - Customization)
1. ✅ التحكم في الأعمدة (Column Control)
2. ✅ تحسينات إضافية على الواجهة (UI Enhancements)

---

## ملاحظات تقنية (Technical Notes)

### قاعدة البيانات
- إضافة جدول لحفظ تفضيلات عرض الأعمدة لكل مستخدم
- فهرسة حقول البحث (الاسم، الكود، الباركود) لتحسين الأداء
- جدول لحفظ سجل الأسعار التاريخية

### الأداء
- استخدام Caching للبحث المتكرر
- تحميل البيانات بشكل Lazy Loading
- تحسين استعلامات SQL

### الأمان
- التحقق من صلاحيات المستخدم
- تسجيل جميع التغييرات في Audit Log
- التحقق من الموافقات قبل الترحيل

---

## المراجع والمصادر
- Oracle Forms Best Practices
- Modern Web UI/UX Guidelines
- ERP Systems Standards
