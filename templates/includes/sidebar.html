{# templates/includes/sidebar.html #}
{% load i18n static %}

<div class="sidebar-wrapper">
    <!-- Header -->
    <div class="sidebar-header p-3 text-center border-bottom">
        <h5 class="text-white mb-0">
            <i class="fas fa-building me-2"></i>
            {% if request.current_company %}
                {{ request.current_company.name|truncatechars:15 }}
            {% else %}
                {% trans "نظام الإدارة" %}
            {% endif %}
        </h5>
    </div>

    <!-- Navigation -->
    <nav class="sidebar-nav">
        <ul class="nav flex-column">

            <!-- Dashboard -->
            <li class="nav-item">
                <a class="nav-link {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}"
                   href="{% url 'core:dashboard' %}">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>{% trans "لوحة التحكم" %}</span>
                </a>
            </li>

            <!-- البيانات الأساسية -->
            {% if perms.core.view_businesspartner or perms.core.view_item or perms.core.view_itemcategory or perms.core.view_currency or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link collapsed" data-bs-toggle="collapse" data-bs-target="#masterDataMenu"
                   aria-expanded="false" aria-controls="masterDataMenu">
                    <i class="fas fa-database"></i>
                    <span>{% trans "البيانات الأساسية" %}</span>
                    <i class="fas fa-chevron-down ms-auto"></i>
                </a>
                <div class="collapse {% if 'item' in request.resolver_match.url_name or 'warehouse' in request.resolver_match.url_name or 'partner' in request.resolver_match.url_name or 'brand' in request.resolver_match.url_name or 'unit' in request.resolver_match.url_name or 'currency' in request.resolver_match.url_name or 'variant_attribute' in request.resolver_match.url_name %}show{% endif %}"
                     id="masterDataMenu">
                    <ul class="nav flex-column ms-3">
                        {% if perms.core.view_item or user.is_superuser %}
                            <li class="nav-item">
                                <a class="nav-link {% if request.resolver_match.url_name == 'item_list' %}active{% endif %}"
                                   href="{% url 'core:item_list' %}">
                                    <i class="fas fa-boxes"></i> {% trans "الأصناف" %}
                                </a>
                            </li>
                        {% endif %}

                        {% if perms.core.view_itemcategory or user.is_superuser %}
                            <li class="nav-item">
                                <a class="nav-link {% if request.resolver_match.url_name == 'item_category_list' %}active{% endif %}"
                                   href="{% url 'core:category_list' %}">
                                    <i class="fas fa-tags"></i> {% trans "تصنيفات الأصناف" %}
                                </a>
                            </li>
                        {% endif %}

                        {% if perms.core.view_warehouse or user.is_superuser %}
                            <li class="nav-item">
                                <a class="nav-link {% if request.resolver_match.url_name == 'warehouse_list' %}active{% endif %}"
                                   href="{% url 'core:warehouse_list' %}">
                                    <i class="fas fa-warehouse"></i> {% trans "المستودعات" %}
                                </a>
                            </li>
                        {% endif %}

                        {% if perms.core.view_businesspartner or user.is_superuser %}
                            <li class="nav-item">
                                <a class="nav-link {% if request.resolver_match.url_name == 'partner_list' %}active{% endif %}"
                                   href="{% url 'core:partner_list' %}">
                                    <i class="fas fa-handshake"></i> {% trans "الشركاء التجاريون" %}
                                </a>
                            </li>
                        {% endif %}

                        {% if perms.core.view_brand or user.is_superuser %}
                            <li class="nav-item">
                                <a class="nav-link {% if request.resolver_match.url_name == 'brand_list' %}active{% endif %}"
                                   href="{% url 'core:brand_list' %}">
                                    <i class="fas fa-award"></i> {% trans "العلامات التجارية" %}
                                </a>
                            </li>
                        {% endif %}

                        {% if perms.core.view_unitofmeasure or user.is_superuser %}
                            <li class="nav-item">
                                <a class="nav-link {% if request.resolver_match.url_name == 'unit_list' %}active{% endif %}"
                                   href="{% url 'core:unit_list' %}">
                                    <i class="fas fa-ruler"></i> {% trans "وحدات القياس" %}
                                </a>
                            </li>
                        {% endif %}

                        {% if perms.core.view_currency or user.is_superuser %}
                            <li class="nav-item">
                                <a class="nav-link {% if request.resolver_match.url_name == 'currency_list' %}active{% endif %}"
                                   href="{% url 'core:currency_list' %}">
                                    <i class="fas fa-coins"></i> {% trans "العملات" %}
                                </a>
                            </li>
                        {% endif %}

                        {% if perms.core.view_variantattribute or user.is_superuser %}
                            <li class="nav-item">
                                <a class="nav-link {% if 'variant_attribute' in request.resolver_match.url_name %}active{% endif %}"
                                   href="{% url 'core:variant_attribute_list' %}">
                                    <i class="fas fa-palette"></i> {% trans "خصائص المتغيرات" %}
                                </a>
                            </li>
                        {% endif %}
                    </ul>
                </div>
            </li>
            {% endif %}

            <!-- العمليات -->
            {% if perms.purchases or perms.sales or perms.inventory or perms.accounting or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link collapsed" data-bs-toggle="collapse" data-bs-target="#operationsMenu"
                   aria-expanded="false" aria-controls="operationsMenu">
                    <i class="fas fa-cogs"></i>
                    <span>{% trans "العمليات" %}</span>
                    <i class="fas fa-chevron-down ms-auto"></i>
                </a>
                <div class="collapse" id="operationsMenu">
                    <ul class="nav flex-column ms-3">
                        {% if perms.purchases.view_purchaseorder or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showComingSoon('المشتريات')">
                                <i class="fas fa-shopping-cart"></i> {% trans "المشتريات" %}
                                <span class="badge bg-warning ms-auto">قريباً</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.sales.view_salesinvoice or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showComingSoon('المبيعات')">
                                <i class="fas fa-cash-register"></i> {% trans "المبيعات" %}
                                <span class="badge bg-warning ms-auto">قريباً</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.inventory.view_stockmovement or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showComingSoon('حركة المخزون')">
                                <i class="fas fa-dolly"></i> {% trans "حركة المخزون" %}
                                <span class="badge bg-warning ms-auto">قريباً</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.accounting.view_journalentry or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showComingSoon('القيود اليومية')">
                                <i class="fas fa-calculator"></i> {% trans "القيود اليومية" %}
                                <span class="badge bg-warning ms-auto">قريباً</span>
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </div>
            </li>
            {% endif %}

            <!-- التقارير -->
            {% if perms.reports or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link collapsed" data-bs-toggle="collapse" data-bs-target="#reportsMenu"
                   aria-expanded="false" aria-controls="reportsMenu">
                    <i class="fas fa-chart-bar"></i>
                    <span>{% trans "التقارير" %}</span>
                    <i class="fas fa-chevron-down ms-auto"></i>
                </a>
                <div class="collapse" id="reportsMenu">
                    <ul class="nav flex-column ms-3">
                        {% if perms.reports.view_sales_report or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showComingSoon('تقارير المبيعات')">
                                <i class="fas fa-chart-line"></i> {% trans "تقارير المبيعات" %}
                                <span class="badge bg-warning ms-auto">قريباً</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.reports.view_inventory_report or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showComingSoon('تقارير المخزون')">
                                <i class="fas fa-chart-pie"></i> {% trans "تقارير المخزون" %}
                                <span class="badge bg-warning ms-auto">قريباً</span>
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.reports.view_financial_report or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link" href="#" onclick="showComingSoon('التقارير المالية')">
                                <i class="fas fa-file-invoice-dollar"></i> {% trans "التقارير المالية" %}
                                <span class="badge bg-warning ms-auto">قريباً</span>
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </div>
            </li>
            {% endif %}

            <!-- الإدارة العامة -->
            {% if perms.core.view_user or perms.core.view_company or perms.core.view_branch or perms.core.view_custompermission or user.is_superuser %}
            <li class="nav-item">
    <a class="nav-link collapsed" data-bs-toggle="collapse" data-bs-target="#administrationMenu"
       aria-expanded="false" aria-controls="administrationMenu">
        <i class="fas fa-users-cog"></i>
        <span>{% trans "الإدارة العامة" %}</span>
        <i class="fas fa-chevron-down ms-auto"></i>
    </a>
    <div class="collapse {% if 'user' in request.resolver_match.url_name or 'company' in request.resolver_match.url_name or 'branch' in request.resolver_match.url_name or 'permission' in request.resolver_match.url_name or 'group' in request.resolver_match.url_name or 'profile' in request.resolver_match.url_name or 'numbering' in request.resolver_match.url_name %}show{% endif %}"
         id="administrationMenu">
        <ul class="nav flex-column ms-3">
            {% if perms.core.view_company or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link {% if request.resolver_match.url_name == 'company_detail' or request.resolver_match.url_name == 'company_update' %}active{% endif %}"
                   href="{% url 'core:company_detail' %}">
                    <i class="fas fa-building"></i> {% trans "بيانات الشركة" %}
                </a>
            </li>
            {% endif %}

            {% if perms.core.view_branch or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link {% if 'branch' in request.resolver_match.url_name %}active{% endif %}"
                   href="{% url 'core:branch_list' %}">
                    <i class="fas fa-sitemap"></i> {% trans "الفروع" %}
                </a>
            </li>
            {% endif %}

            {% if perms.core.view_user or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link {% if 'user' in request.resolver_match.url_name %}active{% endif %}"
                   href="{% url 'core:user_list' %}">
                    <i class="fas fa-users"></i> {% trans "المستخدمين" %}
                </a>
            </li>
            {% endif %}

            {% if perms.core.view_userprofile or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link {% if 'profile' in request.resolver_match.url_name %}active{% endif %}"
                   href="{% url 'core:profile_list' %}">
                    <i class="fas fa-user-cog"></i> {% trans "ملفات المستخدمين" %}
                </a>
            </li>
            {% endif %}

            {% if perms.core.view_custompermission or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link {% if 'permission' in request.resolver_match.url_name %}active{% endif %}"
                   href="{% url 'core:permission_list' %}">
                    <i class="fas fa-shield-alt"></i> {% trans "الصلاحيات المخصصة" %}
                </a>
            </li>
            {% endif %}

            {% if perms.core.view_permissiongroup or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link {% if 'group' in request.resolver_match.url_name %}active{% endif %}"
                   href="{% url 'core:group_list' %}">
                    <i class="fas fa-layer-group"></i> {% trans "مجموعات الصلاحيات" %}
                </a>
            </li>
            {% endif %}

            {% if perms.core.view_numberingsequence or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link {% if 'numbering' in request.resolver_match.url_name %}active{% endif %}"
                   href="{% url 'core:numbering_list' %}">
                    <i class="fas fa-sort-numeric-up"></i> {% trans "تسلسل الترقيم" %}
                </a>
            </li>
            {% endif %}

{#            {% if user.is_superuser %}#}
{#            <li class="nav-item">#}
{#                <a class="nav-link" href="{% url 'admin:index' %}" target="_blank">#}
{#                    <i class="fas fa-cogs"></i> {% trans "لوحة Django Admin" %}#}
{#                </a>#}
{#            </li>#}
{#            {% endif %}#}
        </ul>
    </div>
</li>
            {% endif %}

            <!-- فاصل -->
            <li><hr class="sidebar-divider"></li>

            <!-- إعدادات -->
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showComingSoon('الإعدادات')">
                    <i class="fas fa-sliders-h"></i>
                    <span>{% trans "الإعدادات" %}</span>
                </a>
            </li>

            <!-- مساعدة -->
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showComingSoon('المساعدة')">
                    <i class="fas fa-question-circle"></i>
                    <span>{% trans "المساعدة" %}</span>
                </a>
            </li>
        </ul>
    </nav>

    <!-- Footer -->
    <div class="sidebar-footer p-3 mt-auto border-top">
        <div class="text-center text-white-50">
            {% if request.current_company %}
            <small class="d-block"><i class="fas fa-building"></i> {{ request.current_company.name|truncatechars:20 }}</small>
            {% endif %}
            {% if request.current_branch %}
            <small class="d-block"><i class="fas fa-map-marker-alt"></i> {{ request.current_branch.name|truncatechars:20 }}</small>
            {% endif %}
            <small class="d-block mt-2">
                <i class="fas fa-code"></i> v1.0.0 -
                <span id="currentTime"></span>
            </small>
            <small>&copy; 2024 {% trans "نظام ERP" %}</small>
        </div>
    </div>
</div>

<script>
// Update time
function updateTime() {
    const now = new Date();
    document.getElementById('currentTime').textContent = now.toLocaleTimeString('ar-EG', {
        hour: '2-digit',
        minute: '2-digit'
    });
}
setInterval(updateTime, 1000);
updateTime();

// Coming soon function
function showComingSoon(feature) {
    Swal.fire({
        icon: 'info',
        title: '{% trans "قريباً" %}',
        text: `{% trans "وحدة" %} ${feature} {% trans "قيد التطوير وستكون متاحة قريباً" %}`,
        confirmButtonText: '{% trans "حسناً" %}',
        confirmButtonColor: '#0d6efd'
    });
}
</script>

<style>
.sidebar-wrapper {
    height: 100vh;
    display: flex;
    flex-direction: column;
    background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
}

.sidebar-nav {
    flex: 1;
    overflow-y: auto;
    padding: 1rem 0;
}

.nav-link {
    color: rgba(255, 255, 255, 0.8) !important;
    padding: 0.75rem 1rem;
    margin: 0.1rem 0.5rem;
    border-radius: 0.5rem;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
}

.nav-link:hover {
    background-color: rgba(255, 255, 255, 0.15) !important;
    color: #ffffff !important;
    transform: translateX(5px);
}

.nav-link.collapsed:hover {
    background-color: rgba(255, 255, 255, 0.15) !important;
    color: #ffffff !important;
}

/* للعناصر النشطة */
.nav-link.active {
    background-color: rgba(255, 255, 255, 0.25) !important;
    color: #ffffff !important;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.nav-link i {
    width: 20px;
    margin-left: 0.5rem;
}

.sidebar-divider {
    border-color: rgba(255, 255, 255, 0.2);
    margin: 1rem 1.5rem;
}

.badge {
    font-size: 0.6rem;
}

/* Scrollbar */
.sidebar-nav::-webkit-scrollbar {
    width: 5px;
}

.sidebar-nav::-webkit-scrollbar-track {
    background: transparent;
}

.sidebar-nav::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3);
    border-radius: 10px;
}
</style>