{# templates/includes/sidebar.html #}
{% load i18n static %}

<div class="sidebar-wrapper">
    <!-- Header -->
    <div class="sidebar-header p-3 text-center border-bottom">
        <h5 class="text-white mb-0">
            <i class="fas fa-building me-2"></i>
            {% if request.current_company %}
                {{ request.current_company.name|truncatechars:15 }}
            {% else %}
                {% trans "نظام الإدارة" %}
            {% endif %}
        </h5>
    </div>

    <!-- Navigation -->
    <nav class="sidebar-nav">
        <ul class="nav flex-column">

            <!-- Dashboard -->
            <li class="nav-item">
                <a class="nav-link {% if request.resolver_match.url_name == 'dashboard' or request.resolver_match.url_name == 'main_dashboard' %}active{% endif %}"
                   href="{% url 'core:main_dashboard' %}">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>{% trans "لوحة التحكم" %}</span>
                </a>
            </li>

            <!-- المحاسبة -->
            {% if perms.accounting.view_journalentry or perms.accounting.view_account or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link collapsed" data-bs-toggle="collapse" data-bs-target="#accountingMenu"
                   aria-expanded="{% if request.resolver_match.namespace == 'accounting' %}true{% else %}false{% endif %}"
                   aria-controls="accountingMenu">
                    <i class="fas fa-calculator"></i>
                    <span>{% trans "المحاسبة" %}</span>
                    <i class="fas fa-chevron-down ms-auto"></i>
                </a>
                <div class="collapse {% if request.resolver_match.namespace == 'accounting' %}show{% endif %}" id="accountingMenu">
                    <ul class="nav flex-column ms-3">
                    <li class="nav-item">
    <a class="nav-link {% if request.resolver_match.url_name == 'dashboard' and request.resolver_match.namespace == 'accounting' %}active{% endif %}"
       href="{% url 'accounting:dashboard' %}">
        <i class="fas fa-chart-line text-success"></i> {% trans "لوحة المحاسبة" %}
    </a>
</li>

                        <!-- دليل الحسابات والإعداد -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">الإعداد الأساسي</small>
                        </li>

                        {% if perms.accounting.view_accounttype or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'account_type' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'accounting:account_type_list' %}">
                                <i class="fas fa-tags text-primary"></i> {% trans "أنواع الحسابات" %}
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.accounting.view_account or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'account_list' in request.resolver_match.url_name or 'account_create' in request.resolver_match.url_name or 'account_update' in request.resolver_match.url_name or 'account_detail' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'accounting:account_list' %}">
                                <i class="fas fa-sitemap text-info"></i> {% trans "دليل الحسابات" %}
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.accounting.view_fiscalyear or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'fiscal_year' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'accounting:fiscal_year_list' %}">
                                <i class="fas fa-calendar-alt text-warning"></i> {% trans "السنوات المالية" %}
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.accounting.view_accountingperiod or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'period' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'accounting:period_list' %}">
                                <i class="fas fa-calendar-week text-secondary"></i> {% trans "الفترات المحاسبية" %}
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.accounting.view_costcenter or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'cost_center' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'accounting:cost_center_list' %}">
                                <i class="fas fa-building text-purple"></i> {% trans "مراكز التكلفة" %}
                            </a>
                        </li>
                        {% endif %}

                        <!-- فاصل -->
                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- القيود والعمليات -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">القيود والعمليات</small>
                        </li>

                        {% if perms.accounting.view_journalentrytemplate or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'template' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'accounting:template_list' %}">
                                <i class="fas fa-copy text-info"></i> {% trans "قوالب القيود" %}
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.accounting.view_journalentry or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'journal_entry_list' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'accounting:journal_entry_list' %}">
                                <i class="fas fa-list text-primary"></i> {% trans "القيود اليومية" %}
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.accounting.add_journalentry or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'quick_journal_entry' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'accounting:quick_journal_entry' %}">
                                <i class="fas fa-bolt text-warning"></i> {% trans "قيد سريع" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'journal_entry_create' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'accounting:journal_entry_create' %}">
                                <i class="fas fa-plus-circle text-success"></i> {% trans "قيد مفصل" %}
                            </a>
                        </li>
                        {% endif %}

                        <!-- السندات -->
                        {% if perms.accounting.view_paymentvoucher or perms.accounting.view_receiptvoucher or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link collapsed" data-bs-toggle="collapse" data-bs-target="#vouchersMenu"
                               aria-expanded="{% if 'voucher' in request.resolver_match.url_name %}true{% else %}false{% endif %}"
                               aria-controls="vouchersMenu">
                                <i class="fas fa-file-invoice-dollar"></i>
                                <span>{% trans "السندات" %}</span>
                                <i class="fas fa-chevron-down ms-auto"></i>
                            </a>
                            <div class="collapse {% if 'voucher' in request.resolver_match.url_name %}show{% endif %}" id="vouchersMenu">
                                <ul class="nav flex-column ms-3">
                                    {% if perms.accounting.view_paymentvoucher or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'payment_voucher' in request.resolver_match.url_name %}active{% endif %}"
                                           href="{% url 'accounting:payment_voucher_list' %}">
                                            <i class="fas fa-arrow-down text-danger"></i> {% trans "سندات الصرف" %}
                                        </a>
                                    </li>
                                    {% endif %}

                                    {% if perms.accounting.view_receiptvoucher or user.is_superuser %}
                                    <li class="nav-item">
                                        <a class="nav-link {% if 'receipt_voucher' in request.resolver_match.url_name %}active{% endif %}"
                                           href="{% url 'accounting:receipt_voucher_list' %}">
                                            <i class="fas fa-arrow-up text-success"></i> {% trans "سندات القبض" %}
                                        </a>
                                    </li>
                                    {% endif %}
                                </ul>
                            </div>
                        </li>
                        {% endif %}

                        <!-- فاصل -->
                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- التقارير المالية -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">التقارير المالية</small>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link {% if 'trial_balance' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'accounting:trial_balance' %}">
                                <i class="fas fa-balance-scale text-success"></i> {% trans "ميزان المراجعة" %}
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link {% if 'general_ledger' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'accounting:general_ledger' %}">
                                <i class="fas fa-book text-info"></i> {% trans "دفتر الأستاذ" %}
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link {% if 'account_statement' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'accounting:account_statement' %}">
                                <i class="fas fa-file-invoice text-purple"></i> {% trans "كشف الحساب" %}
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link {% if 'income_statement' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'accounting:income_statement' %}">
                                <i class="fas fa-chart-line text-success"></i> {% trans "قائمة الدخل" %}
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link {% if 'balance_sheet' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'accounting:balance_sheet' %}">
                                <i class="fas fa-chart-pie text-secondary"></i> {% trans "الميزانية العمومية" %}
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link {% if 'account_comparison' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'accounting:account_comparison' %}">
                                <i class="fas fa-chart-bar text-primary"></i> {% trans "مقارنة الحسابات" %}
                            </a>
                        </li>
                    </ul>
                </div>
            </li>
            {% endif %}

            <!-- الأصول الثابتة -->
            {% if perms.assets.view_asset or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link collapsed" data-bs-toggle="collapse" data-bs-target="#assetsMenu"
                   aria-expanded="{% if request.resolver_match.namespace == 'assets' %}true{% else %}false{% endif %}"
                   aria-controls="assetsMenu">
                    <i class="fas fa-desktop"></i>
                    <span>{% trans "الأصول الثابتة" %}</span>
                    <i class="fas fa-chevron-down ms-auto"></i>
                </a>
                <div class="collapse {% if request.resolver_match.namespace == 'assets' %}show{% endif %}" id="assetsMenu">
                    <ul class="nav flex-column ms-3">
                        <!-- لوحة التحكم -->
                        <li class="nav-item">
                            <a class="nav-link {% if 'dashboard' in request.resolver_match.url_name and request.resolver_match.namespace == 'assets' %}active{% endif %}"
                               href="{% url 'assets:dashboard' %}">
                                <i class="fas fa-chart-line text-success"></i> {% trans "لوحة الأصول" %}
                            </a>
                        </li>

                        <!-- الإعداد الأساسي -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">الإعداد الأساسي</small>
                        </li>

                        {% if perms.assets.view_assetcategory or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'category' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'assets:category_list' %}">
                                <i class="fas fa-sitemap text-info"></i> {% trans "تصنيفات الأصول" %}
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.assets.view_depreciationmethod or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'depreciation_method' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'assets:depreciation_method_list' %}">
                                <i class="fas fa-chart-line text-warning"></i> {% trans "طرق الإهلاك" %}
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.assets.view_assetcondition or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'condition' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'assets:condition_list' %}">
                                <i class="fas fa-check-circle text-success"></i> {% trans "حالات الأصول" %}
                            </a>
                        </li>
                        {% endif %}

                        <li class="nav-item">
                            <a class="nav-link {% if 'accounting_config' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'assets:accounting_config_list' %}">
                                <i class="fas fa-cogs text-danger"></i> {% trans "إعدادات الحسابات المحاسبية" %}
                            </a>
                        </li>

                        <!-- فاصل -->
                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- الأصول -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">إدارة الأصول</small>
                        </li>

                        {% if perms.assets.view_asset or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'asset_list' in request.resolver_match.url_name or 'asset_detail' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'assets:asset_list' %}">
                                <i class="fas fa-boxes text-primary"></i> {% trans "الأصول" %}
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.assets.add_asset or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'asset_create' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'assets:asset_create' %}">
                                <i class="fas fa-plus-circle text-success"></i> {% trans "إضافة أصل" %}
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.assets.view_assettransaction or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'transaction' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'assets:transaction_list' %}">
                                <i class="fas fa-exchange-alt text-info"></i> {% trans "المعاملات" %}
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.assets.view_assettransfer or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'transfer' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'assets:transfer_list' %}">
                                <i class="fas fa-truck-moving text-warning"></i> {% trans "التحويلات" %}
                            </a>
                        </li>
                        {% endif %}

                        <!-- فاصل -->
                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- الإهلاك -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">الإهلاك</small>
                        </li>

                        {% if perms.assets.view_assetdepreciation or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'depreciation_list' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'assets:depreciation_list' %}">
                                <i class="fas fa-chart-area text-danger"></i> {% trans "قيود الإهلاك" %}
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.assets.add_assetdepreciation or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'bulk_calculate_depreciation' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'assets:bulk_calculate_depreciation' %}">
                                <i class="fas fa-calculator text-warning"></i> {% trans "حساب جماعي" %}
                            </a>
                        </li>
                        {% endif %}

                        <!-- فاصل -->
                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- الصيانة -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">الصيانة</small>
                        </li>

                        {% if perms.assets.view_assetmaintenance or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'maintenance_list' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'assets:maintenance_list' %}">
                                <i class="fas fa-tools text-secondary"></i> {% trans "سجل الصيانة" %}
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.assets.view_maintenanceschedule or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'schedule_list' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'assets:schedule_list' %}">
                                <i class="fas fa-calendar-alt text-info"></i> {% trans "جدولة الصيانة" %}
                            </a>
                        </li>
                        {% endif %}

                        <!-- فاصل -->
                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- التأمين -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">التأمين</small>
                        </li>

                        {% if perms.assets.view_assetinsurance or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'insurance_list' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'assets:insurance_list' %}">
                                <i class="fas fa-shield-alt text-primary"></i> {% trans "بوليصات التأمين" %}
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.assets.view_insuranceclaim or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'claim_list' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'assets:claim_list' %}">
                                <i class="fas fa-file-medical text-danger"></i> {% trans "المطالبات" %}
                            </a>
                        </li>
                        {% endif %}

                        <!-- فاصل -->
                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- الجرد الفعلي -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">الجرد الفعلي</small>
                        </li>

                        {% if perms.assets.view_physicalcount or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'count_list' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'assets:count_list' %}">
                                <i class="fas fa-clipboard-list text-info"></i> {% trans "دورات الجرد" %}
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.assets.add_physicalcount or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'count_create' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'assets:count_create' %}">
                                <i class="fas fa-plus-circle text-success"></i> {% trans "إضافة جرد" %}
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.assets.view_physicalcountadjustment or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'adjustment_list' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'assets:adjustment_list' %}">
                                <i class="fas fa-edit text-warning"></i> {% trans "التعديلات" %}
                            </a>
                        </li>
                        {% endif %}

                        <!-- فاصل -->
                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- الإيجار -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">الإيجار</small>
                        </li>

                        {% if perms.assets.view_assetlease or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'lease_list' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'assets:lease_list' %}">
                                <i class="fas fa-file-contract text-purple"></i> {% trans "عقود الإيجار" %}
                            </a>
                        </li>
                        {% endif %}

                        <!-- فاصل -->
                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- الموافقات -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">الموافقات</small>
                        </li>

                        {% if perms.assets.view_approvalrequest or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'request' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'assets:request_list' %}">
                                <i class="fas fa-clipboard-check text-success"></i> {% trans "طلبات الموافقة" %}
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.assets.view_approvalworkflow or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'workflow_list' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'assets:workflow_list' %}">
                                <i class="fas fa-project-diagram text-info"></i> {% trans "سير العمل" %}
                            </a>
                        </li>
                        {% endif %}

                        <!-- فاصل -->
                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- التقارير -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">التقارير</small>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link {% if 'asset_register_report' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'assets:asset_register_report' %}">
                                <i class="fas fa-file-alt text-primary"></i> {% trans "تقرير الأصول" %}
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link {% if 'depreciation_report' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'assets:depreciation_report' %}">
                                <i class="fas fa-chart-bar text-danger"></i> {% trans "تقرير الإهلاك" %}
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link {% if 'maintenance_report' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'assets:maintenance_report' %}">
                                <i class="fas fa-wrench text-secondary"></i> {% trans "تقرير الصيانة" %}
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link {% if 'valuation_report' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'assets:valuation_report' %}">
                                <i class="fas fa-dollar-sign text-success"></i> {% trans "تقرير التقييم" %}
                            </a>
                        </li>
                    </ul>
                </div>
            </li>
            {% endif %}

            <!-- البيانات الأساسية -->
            {% if perms.core.view_businesspartner or perms.core.view_item or perms.core.view_itemcategory or perms.core.view_currency or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link collapsed" data-bs-toggle="collapse" data-bs-target="#masterDataMenu"
                   aria-expanded="{% if request.resolver_match.namespace == 'core' and 'item' in request.resolver_match.url_name or 'warehouse' in request.resolver_match.url_name or 'partner' in request.resolver_match.url_name or 'brand' in request.resolver_match.url_name or 'unit' in request.resolver_match.url_name or 'currency' in request.resolver_match.url_name or 'variant_attribute' in request.resolver_match.url_name or 'category' in request.resolver_match.url_name %}true{% else %}false{% endif %}"
                   aria-controls="masterDataMenu">
                    <i class="fas fa-database"></i>
                    <span>{% trans "البيانات الأساسية" %}</span>
                    <i class="fas fa-chevron-down ms-auto"></i>
                </a>
                <div class="collapse {% if request.resolver_match.namespace == 'core' and 'item' in request.resolver_match.url_name or 'warehouse' in request.resolver_match.url_name or 'partner' in request.resolver_match.url_name or 'brand' in request.resolver_match.url_name or 'unit' in request.resolver_match.url_name or 'currency' in request.resolver_match.url_name or 'variant_attribute' in request.resolver_match.url_name or 'category' in request.resolver_match.url_name %}show{% endif %}"
                     id="masterDataMenu">
                    <ul class="nav flex-column ms-3">
                        {% if perms.core.view_item or user.is_superuser %}
                            <li class="nav-item">
                                <a class="nav-link {% if 'item_list' in request.resolver_match.url_name or 'item_create' in request.resolver_match.url_name or 'item_update' in request.resolver_match.url_name or 'item_detail' in request.resolver_match.url_name %}active{% endif %}"
                                   href="{% url 'core:item_list' %}">
                                    <i class="fas fa-boxes"></i> {% trans "المواد" %}
                                </a>
                            </li>
                        {% endif %}

                        {% if perms.core.view_itemcategory or user.is_superuser %}
                            <li class="nav-item">
                                <a class="nav-link {% if 'category' in request.resolver_match.url_name %}active{% endif %}"
                                   href="{% url 'core:category_list' %}">
                                    <i class="fas fa-tags"></i> {% trans "تصنيفات المواد" %}
                                </a>
                            </li>
                        {% endif %}

                        {% if perms.core.view_warehouse or user.is_superuser %}
                            <li class="nav-item">
                                <a class="nav-link {% if 'warehouse' in request.resolver_match.url_name %}active{% endif %}"
                                   href="{% url 'core:warehouse_list' %}">
                                    <i class="fas fa-warehouse"></i> {% trans "المستودعات" %}
                                </a>
                            </li>
                        {% endif %}

                        {% if perms.core.view_businesspartner or user.is_superuser %}
                            <li class="nav-item">
                                <a class="nav-link {% if 'partner' in request.resolver_match.url_name %}active{% endif %}"
                                   href="{% url 'core:partner_list' %}">
                                    <i class="fas fa-handshake"></i> {% trans "العملاء والموردين" %}
                                </a>
                            </li>
                        {% endif %}

                        {% if perms.core.view_brand or user.is_superuser %}
                            <li class="nav-item">
                                <a class="nav-link {% if 'brand' in request.resolver_match.url_name %}active{% endif %}"
                                   href="{% url 'core:brand_list' %}">
                                    <i class="fas fa-award"></i> {% trans "العلامات التجارية" %}
                                </a>
                            </li>
                        {% endif %}

                        {% if perms.core.view_unitofmeasure or user.is_superuser %}
                            <li class="nav-item">
                                <a class="nav-link collapsed" data-bs-toggle="collapse" data-bs-target="#uomMenu"
                                   aria-expanded="{% if 'uom' in request.resolver_match.url_name or 'unit' in request.resolver_match.url_name %}true{% else %}false{% endif %}"
                                   aria-controls="uomMenu">
                                    <i class="fas fa-ruler"></i>
                                    <span>{% trans "وحدات القياس" %}</span>
                                    <i class="fas fa-chevron-down ms-auto"></i>
                                </a>
                                <div class="collapse {% if 'uom' in request.resolver_match.url_name or 'unit' in request.resolver_match.url_name %}show{% endif %}" id="uomMenu">
                                    <ul class="nav flex-column ms-3">
                                        <li class="nav-item">
                                            <a class="nav-link {% if 'unit_list' in request.resolver_match.url_name %}active{% endif %}"
                                               href="{% url 'core:unit_list' %}">
                                                <i class="fas fa-list text-primary"></i> {% trans "جميع الوحدات" %}
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link {% if 'uom_group' in request.resolver_match.url_name %}active{% endif %}"
                                               href="{% url 'core:uom_group_list' %}">
                                                <i class="fas fa-layer-group text-info"></i> {% trans "مجموعات الوحدات" %}
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link {% if 'uom_conversion' in request.resolver_match.url_name %}active{% endif %}"
                                               href="{% url 'core:uom_conversion_list' %}">
                                                <i class="fas fa-exchange-alt text-success"></i> {% trans "تحويلات الوحدات" %}
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </li>
                        {% endif %}

                        {% if perms.core.view_currency or user.is_superuser %}
                            <li class="nav-item">
                                <a class="nav-link {% if 'currency' in request.resolver_match.url_name %}active{% endif %}"
                                   href="{% url 'core:currency_list' %}">
                                    <i class="fas fa-coins"></i> {% trans "العملات" %}
                                </a>
                            </li>
                        {% endif %}

                        {% if perms.core.view_variantattribute or user.is_superuser %}
                            <li class="nav-item">
                                <a class="nav-link {% if 'variant_attribute' in request.resolver_match.url_name %}active{% endif %}"
                                   href="{% url 'core:variant_attribute_list' %}">
                                    <i class="fas fa-palette"></i> {% trans "خصائص المتغيرات" %}
                                </a>
                            </li>
                        {% endif %}

                        <!-- Item Templates -->
                        {% if perms.core.view_itemtemplate or user.is_superuser %}
                            <li class="nav-item">
                                <a class="nav-link {% if 'item_template' in request.resolver_match.url_name %}active{% endif %}"
                                   href="{% url 'core:item_template_list' %}">
                                    <i class="fas fa-copy text-warning"></i> {% trans "قوالب المواد" %}
                                </a>
                            </li>
                        {% endif %}
                    </ul>
                </div>
            </li>
            {% endif %}

            <!-- إدارة التسعير -->
            {% if perms.core.view_pricelist or perms.core.view_pricingrule or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link collapsed" data-bs-toggle="collapse" data-bs-target="#pricingMenu"
                   aria-expanded="{% if 'pricing' in request.resolver_match.url_name or 'price' in request.resolver_match.url_name %}true{% else %}false{% endif %}"
                   aria-controls="pricingMenu">
                    <i class="fas fa-tags"></i>
                    <span>{% trans "إدارة التسعير" %}</span>
                    <i class="fas fa-chevron-down ms-auto"></i>
                </a>
                <div class="collapse {% if 'pricing' in request.resolver_match.url_name or 'price' in request.resolver_match.url_name %}show{% endif %}"
                     id="pricingMenu">
                    <ul class="nav flex-column ms-3">
                        <!-- لوحة التسعير -->
                        <li class="nav-item">
                            <a class="nav-link {% if 'pricing_dashboard' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'core:pricing_dashboard' %}">
                                <i class="fas fa-chart-line text-success"></i> {% trans "لوحة التسعير" %}
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link {% if 'enhanced_pricing_dashboard' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'core:enhanced_pricing_dashboard' %}">
                                <i class="fas fa-tachometer-alt text-purple"></i> {% trans "اللوحة المحسنة" %}
                            </a>
                        </li>

                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- القوائم والقواعد -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">القوائم والقواعد</small>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link {% if 'price_list' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'core:price_list_list' %}">
                                <i class="fas fa-list text-primary"></i> {% trans "قوائم الأسعار" %}
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link {% if 'pricing_rule_list_dt' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'core:pricing_rule_list_dt' %}">
                                <i class="fas fa-sliders-h text-info"></i> {% trans "قواعد التسعير" %}
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link {% if 'price_list_items_dt' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'core:price_list_items_dt' %}">
                                <i class="fas fa-tags text-primary"></i> {% trans "عناصر الأسعار" %}
                            </a>
                        </li>

                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- أدوات التسعير -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">أدوات التسعير</small>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link {% if 'inline_price_editor' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'core:inline_price_editor' %}">
                                <i class="fas fa-pen text-danger"></i> {% trans "محرر الأسعار المباشر" %}
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link {% if 'bulk_price_update' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'core:bulk_price_update' %}">
                                <i class="fas fa-edit text-warning"></i> {% trans "تحديث جماعي" %}
                            </a>
                        </li>

                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- استيراد وتصدير -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">استيراد وتصدير</small>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link {% if 'price_list_import' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'core:price_list_import' %}">
                                <i class="fas fa-file-import text-success"></i> {% trans "استيراد الأسعار" %}
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link {% if 'price_list_export' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'core:price_list_export' %}">
                                <i class="fas fa-file-export text-info"></i> {% trans "تصدير الأسعار" %}
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link {% if 'price_simulator' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'core:price_simulator' %}">
                                <i class="fas fa-calculator text-success"></i> {% trans "محاكي الأسعار" %}
                            </a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link {% if 'price_comparison' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'core:price_comparison' %}">
                                <i class="fas fa-balance-scale text-purple"></i> {% trans "مقارنة الأسعار" %}
                            </a>
                        </li>

                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- التقارير -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">التقارير</small>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link {% if 'price_report' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'core:price_report' %}">
                                <i class="fas fa-file-invoice text-secondary"></i> {% trans "تقرير الأسعار" %}
                            </a>
                        </li>
                    </ul>
                </div>
            </li>
            {% endif %}

            <!-- المشتريات -->
            {% if perms.purchases.view_purchaseinvoice or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link collapsed" data-bs-toggle="collapse" data-bs-target="#purchasesMenu"
                   aria-expanded="{% if request.resolver_match.namespace == 'purchases' %}true{% else %}false{% endif %}"
                   aria-controls="purchasesMenu">
                    <i class="fas fa-shopping-cart"></i>
                    <span>{% trans "المشتريات" %}</span>
                    <i class="fas fa-chevron-down ms-auto"></i>
                </a>
                <div class="collapse {% if request.resolver_match.namespace == 'purchases' %}show{% endif %}" id="purchasesMenu">
                    <ul class="nav flex-column ms-3">
                        <!-- لوحة التحكم -->
                        <li class="nav-item">
                            <a class="nav-link {% if 'dashboard' in request.resolver_match.url_name and request.resolver_match.namespace == 'purchases' %}active{% endif %}"
                               href="{% url 'purchases:dashboard' %}">
                                <i class="fas fa-chart-line text-success"></i> {% trans "لوحة المشتريات" %}
                            </a>
                        </li>

                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- 1. عقود الشراء -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">عقود الشراء</small>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'contract' in request.resolver_match.url_name %}active{% endif %}" href="{% url 'purchases:contract_list' %}">
                                <i class="fas fa-file-contract text-purple"></i> {% trans "العقود" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'purchases:contract_create' %}">
                                <i class="fas fa-plus-circle text-success"></i> {% trans "عقد جديد" %}
                            </a>
                        </li>

                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- 2. طلبات الشراء -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">طلبات الشراء</small>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'request' in request.resolver_match.url_name %}active{% endif %}" href="{% url 'purchases:request_list' %}">
                                <i class="fas fa-shopping-basket text-secondary"></i> {% trans "الطلبات" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'purchases:request_create' %}">
                                <i class="fas fa-plus-circle text-success"></i> {% trans "طلب جديد" %}
                            </a>
                        </li>

                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- 3. عروض الأسعار -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">عروض الأسعار</small>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'rfq' in request.resolver_match.url_name %}active{% endif %}" href="{% url 'purchases:rfq_list' %}">
                                <i class="fas fa-file-alt text-warning"></i> {% trans "طلبات العروض" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'quotation' in request.resolver_match.url_name %}active{% endif %}" href="{% url 'purchases:quotation_list' %}">
                                <i class="fas fa-money-check-alt text-success"></i> {% trans "العروض المستلمة" %}
                            </a>
                        </li>

                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- 4. أوامر الشراء -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">أوامر الشراء</small>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'order' in request.resolver_match.url_name %}active{% endif %}" href="{% url 'purchases:order_list' %}">
                                <i class="fas fa-clipboard-list text-info"></i> {% trans "الأوامر" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'purchases:order_create' %}">
                                <i class="fas fa-plus-circle text-success"></i> {% trans "أمر جديد" %}
                            </a>
                        </li>

                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- 5. استلام البضاعة -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">استلام البضاعة</small>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'goods_receipt' in request.resolver_match.url_name %}active{% endif %}" href="{% url 'purchases:goods_receipt_list' %}">
                                <i class="fas fa-dolly text-success"></i> {% trans "محاضر الاستلام" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'purchases:goods_receipt_create' %}">
                                <i class="fas fa-plus-circle text-success"></i> {% trans "محضر جديد" %}
                            </a>
                        </li>

                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- 6. فواتير المشتريات -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">فواتير المشتريات</small>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'invoice' in request.resolver_match.url_name %}active{% endif %}" href="{% url 'purchases:invoice_list' %}">
                                <i class="fas fa-file-invoice text-primary"></i> {% trans "الفواتير" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'purchases:invoice_create' %}">
                                <i class="fas fa-plus-circle text-success"></i> {% trans "فاتورة جديدة" %}
                            </a>
                        </li>

                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- تقارير -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">التقارير</small>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'reports' in request.resolver_match.url_name and request.resolver_match.namespace == 'purchases' %}active{% endif %}"
                               href="{% url 'purchases:reports_list' %}">
                                <i class="fas fa-chart-bar text-info"></i> {% trans "قائمة التقارير" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'purchases_summary' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'purchases:purchases_summary_report' %}">
                                <i class="fas fa-file-invoice-dollar text-primary"></i> {% trans "ملخص المشتريات" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'supplier_performance' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'purchases:supplier_performance_report' %}">
                                <i class="fas fa-star text-warning"></i> {% trans "أداء الموردين" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'purchase_orders_report' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'purchases:purchase_orders_report' %}">
                                <i class="fas fa-shopping-cart text-success"></i> {% trans "أوامر الشراء" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'items_purchases' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'purchases:items_purchases_report' %}">
                                <i class="fas fa-boxes text-info"></i> {% trans "مشتريات الأصناف" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'contracts_report' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'purchases:contracts_report' %}">
                                <i class="fas fa-file-contract text-purple"></i> {% trans "تقرير العقود" %}
                            </a>
                        </li>
                    </ul>
                </div>
            </li>
            {% endif %}

            <!-- الموارد البشرية -->
            {% if perms.hr.view_department or perms.hr.view_employee or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link collapsed" data-bs-toggle="collapse" data-bs-target="#hrMenu"
                   aria-expanded="{% if request.resolver_match.namespace == 'hr' %}true{% else %}false{% endif %}"
                   aria-controls="hrMenu">
                    <i class="fas fa-users"></i>
                    <span>{% trans "الموارد البشرية" %}</span>
                    <i class="fas fa-chevron-down ms-auto"></i>
                </a>
                <div class="collapse {% if request.resolver_match.namespace == 'hr' %}show{% endif %}" id="hrMenu">
                    <ul class="nav flex-column ms-3">
                        <!-- الإعدادات -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">الإعدادات</small>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'department' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'hr:department_list' %}">
                                <i class="fas fa-sitemap text-info"></i> {% trans "الأقسام" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'hr:department_create' %}">
                                <i class="fas fa-plus-circle text-success"></i> {% trans "قسم جديد" %}
                            </a>
                        </li>

                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- الموظفين -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">الموظفين</small>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'employee' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'hr:employee_list' %}">
                                <i class="fas fa-user-tie text-primary"></i> {% trans "الموظفين" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'hr:employee_create' %}">
                                <i class="fas fa-plus-circle text-success"></i> {% trans "موظف جديد" %}
                            </a>
                        </li>
                    </ul>
                </div>
            </li>
            {% endif %}

            <!-- المبيعات -->
            {% if perms.sales.view_salesinvoice or user.is_superuser %}
            <li class="nav-item" >
                <a class="nav-link collapsed" data-bs-toggle="collapse" data-bs-target="#salesMenu"
                   aria-expanded="{% if request.resolver_match.namespace == 'sales' %}true{% else %}false{% endif %}"
                   aria-controls="salesMenu">
                    <i class="fas fa-cash-register"></i>
                    <span>{% trans "المبيعات" %}</span>
                    <i class="fas fa-chevron-down ms-auto"></i>
                </a>
                <div class="collapse {% if request.resolver_match.namespace == 'sales' %}show{% endif %}" id="salesMenu">
                    <ul class="nav flex-column ms-3">
                        <!-- لوحة التحكم -->
                        <li class="nav-item">
                            <a class="nav-link {% if 'dashboard' in request.resolver_match.url_name and request.resolver_match.namespace == 'sales' %}active{% endif %}"
                               href="{% url 'sales:dashboard' %}">
                                <i class="fas fa-chart-line text-success"></i> {% trans "لوحة المبيعات" %}
                            </a>
                        </li>

                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- 1. عروض الأسعار -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">عروض الأسعار</small>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'quotation_list' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'sales:quotation_list' %}">
                                <i class="fas fa-file-alt text-info"></i> {% trans "عروض الأسعار" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'sales:quotation_create' %}">
                                <i class="fas fa-plus-circle text-success"></i> {% trans "عرض جديد" %}
                            </a>
                        </li>

                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- 2. أوامر البيع -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">أوامر البيع</small>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'order_list' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'sales:order_list' %}">
                                <i class="fas fa-clipboard-list text-primary"></i> {% trans "أوامر البيع" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'sales:order_create' %}">
                                <i class="fas fa-plus-circle text-success"></i> {% trans "أمر جديد" %}
                            </a>
                        </li>

                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- 3. فواتير المبيعات -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">فواتير المبيعات</small>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'invoice_list' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'sales:invoice_list' %}">
                                <i class="fas fa-file-invoice text-danger"></i> {% trans "الفواتير" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'sales:invoice_create' %}">
                                <i class="fas fa-plus-circle text-success"></i> {% trans "فاتورة جديدة" %}
                            </a>
                        </li>

                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- 4. الأقساط -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">الأقساط</small>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'installment_list' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'sales:installment_list' %}">
                                <i class="fas fa-calendar-check text-warning"></i> {% trans "الأقساط" %}
                            </a>
                        </li>

                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- 5. عمولات المندوبين -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">عمولات المندوبين</small>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'commission_list' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'sales:commission_list' %}">
                                <i class="fas fa-hand-holding-usd text-success"></i> {% trans "العمولات" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'commission_create' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'sales:commission_create' %}">
                                <i class="fas fa-plus-circle text-success"></i> {% trans "عمولة جديدة" %}
                            </a>
                        </li>

                        <li><hr class="dropdown-divider my-2"></li>

                        <!-- 6. التقارير -->
                        <li class="nav-item">
                            <small class="text-muted ms-3 fw-bold">التقارير</small>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'report_customer_statement' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'sales:report_customer_statement' %}">
                                <i class="fas fa-user-check text-info"></i> {% trans "كشف حساب عميل" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'report_sales_detailed' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'sales:report_sales_detailed' %}">
                                <i class="fas fa-list-alt text-primary"></i> {% trans "مبيعات تفصيلي" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'report_profit_loss' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'sales:report_profit_loss' %}">
                                <i class="fas fa-chart-line text-success"></i> {% trans "الأرباح والخسائر" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'report_tax' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'sales:report_tax' %}">
                                <i class="fas fa-percentage text-warning"></i> {% trans "تقرير الضريبة" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'report_invoice_search' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'sales:report_invoice_search' %}">
                                <i class="fas fa-search text-secondary"></i> {% trans "بحث الفواتير" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'report_quotation_comparison' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'sales:report_quotation_comparison' %}">
                                <i class="fas fa-balance-scale text-info"></i> {% trans "مقارنة العروض" %}
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if 'report_commission' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'sales:report_commission' %}">
                                <i class="fas fa-dollar-sign text-success"></i> {% trans "تقرير العمولات" %}
                            </a>
                        </li>
                    </ul>
                </div>
            </li>
            {% endif %}

            <!-- حركة المخزون -->
            {% if perms.inventory.view_stockmovement or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showComingSoon('حركة المخزون')">
                    <i class="fas fa-dolly"></i>
                    <span>{% trans "حركة المخزون" %}</span>
                    <span class="badge bg-warning ms-auto">قريباً</span>
                </a>
            </li>
            {% endif %}

            <!-- الإدارة العامة -->
            {% if perms.core.view_user or perms.core.view_company or perms.core.view_branch or perms.core.view_custompermission or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link collapsed" data-bs-toggle="collapse" data-bs-target="#administrationMenu"
                   aria-expanded="{% if request.resolver_match.namespace == 'core' and 'user' in request.resolver_match.url_name or 'company' in request.resolver_match.url_name or 'branch' in request.resolver_match.url_name or 'permission' in request.resolver_match.url_name or 'group' in request.resolver_match.url_name or 'profile' in request.resolver_match.url_name or 'numbering' in request.resolver_match.url_name %}true{% else %}false{% endif %}"
                   aria-controls="administrationMenu">
                    <i class="fas fa-users-cog"></i>
                    <span>{% trans "الإدارة العامة" %}</span>
                    <i class="fas fa-chevron-down ms-auto"></i>
                </a>
                <div class="collapse {% if request.resolver_match.namespace == 'core' and 'user' in request.resolver_match.url_name or 'company' in request.resolver_match.url_name or 'branch' in request.resolver_match.url_name or 'permission' in request.resolver_match.url_name or 'group' in request.resolver_match.url_name or 'profile' in request.resolver_match.url_name or 'numbering' in request.resolver_match.url_name %}show{% endif %}"
                     id="administrationMenu">
                    <ul class="nav flex-column ms-3">
                        {% if perms.core.view_company or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'company_detail' in request.resolver_match.url_name or 'company_update' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'core:company_detail' %}">
                                <i class="fas fa-building"></i> {% trans "بيانات الشركة" %}
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.core.view_branch or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'branch' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'core:branch_list' %}">
                                <i class="fas fa-sitemap"></i> {% trans "الفروع" %}
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.core.view_user or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'user' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'core:user_list' %}">
                                <i class="fas fa-users"></i> {% trans "المستخدمين" %}
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.core.view_userprofile or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'profile' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'core:profile_list' %}">
                                <i class="fas fa-user-cog"></i> {% trans "ملفات المستخدمين" %}
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.core.view_custompermission or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'permission' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'core:permission_list' %}">
                                <i class="fas fa-shield-alt"></i> {% trans "الصلاحيات المخصصة" %}
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.core.view_permissiongroup or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'group' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'core:group_list' %}">
                                <i class="fas fa-layer-group"></i> {% trans "مجموعات الصلاحيات" %}
                            </a>
                        </li>
                        {% endif %}

                        {% if perms.core.view_numberingsequence or user.is_superuser %}
                        <li class="nav-item">
                            <a class="nav-link {% if 'numbering' in request.resolver_match.url_name %}active{% endif %}"
                               href="{% url 'core:numbering_list' %}">
                                <i class="fas fa-sort-numeric-up"></i> {% trans "تسلسل الترقيم" %}
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </div>
            </li>
            {% endif %}

            <!-- فاصل -->
            <li><hr class="sidebar-divider"></li>

            <!-- إعدادات -->
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showComingSoon('الإعدادات')">
                    <i class="fas fa-sliders-h"></i>
                    <span>{% trans "الإعدادات" %}</span>
                </a>
            </li>

            <!-- مساعدة -->
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showComingSoon('المساعدة')">
                    <i class="fas fa-question-circle"></i>
                    <span>{% trans "المساعدة" %}</span>
                </a>
            </li>
        </ul>
    </nav>

    <!-- Footer -->
    <div class="sidebar-footer p-3 mt-auto border-top">
        <div class="text-center text-white-50">
            <small>&copy; 2025 {% trans "نظام ERP" %}</small>
        </div>
    </div>
</div>

<!-- Debug Info (يمكن إزالتها في Production) -->
<div class="d-none">
    Debug Info:
    <br>Namespace: {{ request.resolver_match.namespace }}
    <br>URL Name: {{ request.resolver_match.url_name }}
    <br>Full Path: {{ request.path }}
</div>

<script>
// Coming soon function
function showComingSoon(feature) {
    Swal.fire({
        icon: 'info',
        title: '{% trans "قريباً" %}',
        text: `{% trans "وحدة" %} ${feature} {% trans "قيد التطوير وستكون متاحة قريباً" %}`,
        confirmButtonText: '{% trans "حسناً" %}',
        confirmButtonColor: '#0d6efd'
    });
}

// Debug function (يمكن إزالتها في Production)
console.log('Current namespace:', '{{ request.resolver_match.namespace }}');
console.log('Current URL name:', '{{ request.resolver_match.url_name }}');
console.log('Current path:', '{{ request.path }}');
</script>

<style>
.text-purple {
    color: #6f42c1 !important;
}

.sidebar-wrapper {
    height: 100vh;
    display: flex;
    flex-direction: column;
    background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
}

.sidebar-nav {
    flex: 1;
    overflow-y: auto;
    padding: 1rem 0;
}

.nav-link {
    color: rgba(255, 255, 255, 0.8) !important;
    padding: 0.75rem 1rem;
    margin: 0.1rem 0.5rem;
    border-radius: 0.5rem;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    position: relative;
}

.nav-link:hover {
    background-color: rgba(255, 255, 255, 0.15) !important;
    color: #ffffff !important;
    transform: translateX(5px);
}

.nav-link.collapsed:hover {
    background-color: rgba(255, 255, 255, 0.15) !important;
    color: #ffffff !important;
}

/* للعناصر النشطة */
.nav-link.active {
    background-color: rgba(255, 255, 255, 0.25) !important;
    color: #ffffff !important;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    border-left: 3px solid #0d6efd;
}

/* تأثير للعناصر النشطة في القوائم الفرعية */
.collapse .nav-link.active {
    background-color: rgba(13, 110, 253, 0.3) !important;
    color: #ffffff !important;
    margin-left: 1rem;
    margin-right: 0.5rem;
    border-left: 2px solid #0d6efd;
}

.nav-link i {
    width: 20px;
    margin-left: 0.5rem;
}

.sidebar-divider {
    border-color: rgba(255, 255, 255, 0.2);
    margin: 1rem 1.5rem;
}

.badge {
    font-size: 1rem;
}

/* Scrollbar */
.sidebar-nav::-webkit-scrollbar {
    width: 5px;
}

.sidebar-nav::-webkit-scrollbar-track {
    background: transparent;
}

.sidebar-nav::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3);
    border-radius: 10px;
}

/* تحسينات للتصنيفات الفرعية */
.nav-item small.text-muted {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-top: 0.5rem;
    margin-bottom: 0.25rem;
    color: rgba(255, 255, 255, 0.5) !important;
}

/* تباعد أفضل للقوائم المتداخلة */
.collapse .nav-link {
    padding: 0.5rem 0.75rem;
    font-size: 0.9rem;
}

.collapse .collapse .nav-link {
    padding: 0.4rem 0.5rem;
    font-size: 0.85rem;
}

/* تأثير بصري للقوائم المفتوحة */
.collapse.show {
    background-color: rgba(0, 0, 0, 0.1);
    border-radius: 0.5rem;
    margin: 0.2rem 0.5rem;
    padding: 0.5rem 0;
}
</style>