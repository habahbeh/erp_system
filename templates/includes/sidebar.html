{# templates/includes/sidebar.html - تحديث #}
{% load i18n static %}
<nav id="sidebar" class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
    <div class="position-sticky pt-3">
        <ul class="nav flex-column">
            <!-- الرئيسية -->
            <li class="nav-item">
                <a class="nav-link {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}"
                   href="{% url 'core:dashboard' %}">
                    <i class="fas fa-home"></i> {% trans "الرئيسية" %}
                </a>
            </li>

            <!-- البيانات الأساسية -->
            {% if perms.core.view_businesspartner or perms.core.view_item or perms.core.view_itemcategory or perms.core.view_currency or user.is_superuser %}
            <h6 class="sidebar-heading px-3 mt-4 mb-1 text-muted">
                <span>{% trans "البيانات الأساسية" %}</span>
            </h6>

                {% if perms.core.view_item or user.is_superuser %}
                    <li class="nav-item">
                        <a class="nav-link {% if request.resolver_match.url_name == 'item_list' %}active{% endif %}"
                           href="{% url 'core:item_list' %}">
                            <i class="fas fa-boxes"></i> {% trans "الأصناف" %}
                        </a>
                    </li>
                {% endif %}

                {% if perms.core.view_warehouse or user.is_superuser %}
                    <li class="nav-item">
                        <a class="nav-link {% if request.resolver_match.url_name == 'warehouse_list' %}active{% endif %}"
                           href="{% url 'core:warehouse_list' %}">
                            <i class="fas fa-warehouse"></i> {% trans "المستودعات" %}
                        </a>
                    </li>
                {% endif %}

                {% if perms.core.view_businesspartner or user.is_superuser %}
                    <li class="nav-item">
                        <a class="nav-link {% if request.resolver_match.url_name == 'partner_list' %}active{% endif %}"
                           href="{% url 'core:partner_list' %}">
                            <i class="fas fa-handshake"></i> {% trans "الشركاء التجاريون" %}
                        </a>
                    </li>
                {% endif %}

                {% if perms.core.view_brand or user.is_superuser %}
                    <li class="nav-item">
                        <a class="nav-link {% if request.resolver_match.url_name == 'brand_list' %}active{% endif %}"
                           href="{% url 'core:brand_list' %}">
                            <i class="fas fa-award"></i> {% trans "العلامات التجارية" %}
                        </a>
                    </li>
                {% endif %}

                {% if perms.core.view_unitofmeasure or user.is_superuser %}
                    <li class="nav-item">
                        <a class="nav-link {% if request.resolver_match.url_name == 'unit_list' %}active{% endif %}"
                           href="{% url 'core:unit_list' %}">
                            <i class="fas fa-ruler"></i> {% trans "وحدات القياس" %}
                        </a>
                    </li>
                {% endif %}

                {% if perms.core.view_currency or user.is_superuser %}
                    <li class="nav-item">
                        <a class="nav-link {% if request.resolver_match.url_name == 'currency_list' %}active{% endif %}"
                           href="{% url 'core:currency_list' %}">
                            <i class="fas fa-coins"></i> {% trans "العملات" %}
                        </a>
                    </li>
                {% endif %}

                {% if perms.core.view_variantattribute or user.is_superuser %}
                    <li class="nav-item">
                        <a class="nav-link {% if 'variant_attribute' in request.resolver_match.url_name %}active{% endif %}"
                           href="{% url 'core:variant_attribute_list' %}">
                            <i class="fas fa-palette"></i> {% trans "خصائص المتغيرات" %}
                        </a>
                    </li>
                {% endif %}

            {% endif %}

            <!-- العمليات -->
            {% if perms.purchases or perms.sales or perms.inventory or perms.accounting or user.is_superuser %}
            <h6 class="sidebar-heading px-3 mt-4 mb-1 text-muted">
                <span>{% trans "العمليات" %}</span>
            </h6>

            {% if perms.purchases.view_purchaseorder or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showComingSoon('{% trans "المشتريات" %}')">
                    <i class="fas fa-shopping-cart"></i> {% trans "المشتريات" %}
                    <small class="text-muted">({% trans "قريباً" %})</small>
                </a>
            </li>
            {% endif %}

            {% if perms.sales.view_salesinvoice or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showComingSoon('{% trans "المبيعات" %}')">
                    <i class="fas fa-cash-register"></i> {% trans "المبيعات" %}
                    <small class="text-muted">({% trans "قريباً" %})</small>
                </a>
            </li>
            {% endif %}

            {% if perms.inventory.view_stockmovement or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showComingSoon('{% trans "حركة المخزون" %}')">
                    <i class="fas fa-dolly"></i> {% trans "حركة المخزون" %}
                    <small class="text-muted">({% trans "قريباً" %})</small>
                </a>
            </li>
            {% endif %}

            {% if perms.accounting.view_journalentry or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showComingSoon('{% trans "القيود اليومية" %}')">
                    <i class="fas fa-calculator"></i> {% trans "القيود اليومية" %}
                    <small class="text-muted">({% trans "قريباً" %})</small>
                </a>
            </li>
            {% endif %}
            {% endif %}

            <!-- التقارير -->
            {% if perms.reports or user.is_superuser %}
            <h6 class="sidebar-heading px-3 mt-4 mb-1 text-muted">
                <span>{% trans "التقارير" %}</span>
            </h6>

            {% if perms.reports.view_sales_report or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showComingSoon('{% trans "تقارير المبيعات" %}')">
                    <i class="fas fa-chart-bar"></i> {% trans "تقارير المبيعات" %}
                    <small class="text-muted">({% trans "قريباً" %})</small>
                </a>
            </li>
            {% endif %}

            {% if perms.reports.view_inventory_report or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showComingSoon('{% trans "تقارير المخزون" %}')">
                    <i class="fas fa-chart-pie"></i> {% trans "تقارير المخزون" %}
                    <small class="text-muted">({% trans "قريباً" %})</small>
                </a>
            </li>
            {% endif %}

            {% if perms.reports.view_financial_report or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link" href="#" onclick="showComingSoon('{% trans "التقارير المالية" %}')">
                    <i class="fas fa-file-invoice-dollar"></i> {% trans "التقارير المالية" %}
                    <small class="text-muted">({% trans "قريباً" %})</small>
                </a>
            </li>
            {% endif %}
            {% endif %}

            <!-- الإدارة -->
            {% if perms.core.view_user or perms.core.view_company or perms.core.view_branch or perms.core.view_numberingsequence or perms.auth.view_user or user.is_superuser %}
            <h6 class="sidebar-heading px-3 mt-4 mb-1 text-muted">
                <span>{% trans "الإدارة" %}</span>
            </h6>

            <!-- بيانات الشركة -->
            {% if perms.core.view_company or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link {% if request.resolver_match.url_name == 'company_detail' or request.resolver_match.url_name == 'company_update' %}active{% endif %}"
                   href="{% url 'core:company_detail' %}">
                    <i class="fas fa-building"></i> {% trans "بيانات الشركة" %}
                </a>
            </li>
            {% endif %}

            <!-- الفروع -->
            {% if perms.core.view_branch or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link {% if 'branch' in request.resolver_match.url_name %}active{% endif %}"
                   href="{% url 'core:branch_list' %}">
                    <i class="fas fa-sitemap"></i> {% trans "الفروع" %}
                </a>
            </li>
            {% endif %}

            <!-- المستخدمين - إضافة جديد -->
            {% if perms.auth.view_user or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link {% if 'user' in request.resolver_match.url_name %}active{% endif %}"
                   href="{% url 'core:user_list' %}">
                    <i class="fas fa-users"></i> {% trans "المستخدمين" %}
                </a>
            </li>
            {% endif %}


                {% if perms.core.view_userprofile or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link {% if 'profile' in request.resolver_match.url_name %}active{% endif %}"
                   href="{% url 'core:profile_list' %}">
                    <i class="fas fa-user-cog"></i> {% trans "ملفات المستخدمين" %}
                </a>
            </li>
            {% endif %}

            <!-- تسلسل الترقيم -->
            {% if perms.core.view_numberingsequence or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link {% if 'numbering' in request.resolver_match.url_name %}active{% endif %}"
                   href="{% url 'core:numbering_list' %}">
                    <i class="fas fa-sort-numeric-up"></i> {% trans "تسلسل الترقيم" %}
                </a>
            </li>
            {% endif %}

                 <!-- الصلاحيات المخصصة - إضافة جديد -->
            {% if perms.core.view_custompermission or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link {% if 'permission' in request.resolver_match.url_name %}active{% endif %}"
                   href="{% url 'core:permission_list' %}">
                    <i class="fas fa-shield-alt"></i> {% trans "الصلاحيات المخصصة" %}
                </a>
            </li>
            {% endif %}

            <!-- مجموعات الصلاحيات - إضافة جديد -->
            {% if perms.core.view_permissiongroup or user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link {% if 'group' in request.resolver_match.url_name %}active{% endif %}"
                   href="{% url 'core:group_list' %}">
                    <i class="fas fa-layer-group"></i> {% trans "مجموعات الصلاحيات" %}
                </a>
            </li>
            {% endif %}

            {% if user.is_superuser %}
            <li class="nav-item">
                <a class="nav-link" href="{% url 'admin:index' %}" target="_blank">
                    <i class="fas fa-cogs"></i> {% trans "لوحة Django Admin" %}
                </a>
            </li>
            {% endif %}
            {% endif %}
        </ul>

        <!-- معلومات النظام -->
        <div class="mt-5 mb-3 px-3 text-muted small">
            <hr>
            <div class="text-center">
                {% if request.current_company %}
                <p class="mb-1"><i class="fas fa-building"></i> {{ request.current_company.name }}</p>
                {% endif %}
                {% if request.current_branch %}
                <p class="mb-1"><i class="fas fa-map-marker-alt"></i> {{ request.current_branch.name }}</p>
                {% endif %}
                <p class="mb-1">{% trans "الإصدار" %}: 1.0.0</p>
                <p class="mb-0">&copy; 2024 {% trans "نظام ERP" %}</p>
            </div>
        </div>
    </div>
</nav>

<script>
// إظهار رسالة "قريباً" للوحدات غير المكتملة
function showComingSoon(moduleName) {
    alert('وحدة ' + moduleName + ' قيد التطوير وستكون متاحة قريباً!');
}
</script>