{% extends 'base/base.html' %}
{% load i18n %}

{% block content %}
<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-wrench text-primary"></i> {% trans "تفاصيل الصيانة" %}</h2>
        <div>
            {% if maintenance.status == 'scheduled' and perms.assets.change_maintenance %}
            <a href="{% url 'assets:maintenance_update' maintenance.pk %}" class="btn btn-warning">
                <i class="fas fa-edit"></i> {% trans "تعديل" %}
            </a>
            {% endif %}
            <a href="{% url 'assets:maintenance_list' %}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> {% trans "رجوع" %}
            </a>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <!-- Status Badge -->
            <div class="mb-4">
                {% if maintenance.status == 'scheduled' %}
                    <h3><span class="badge bg-primary fs-5">{% trans "مجدولة" %}</span></h3>
                {% elif maintenance.status == 'in_progress' %}
                    <h3><span class="badge bg-warning fs-5">{% trans "جارية" %}</span></h3>
                {% elif maintenance.status == 'completed' %}
                    <h3><span class="badge bg-success fs-5">{% trans "مكتملة" %}</span></h3>
                {% elif maintenance.status == 'cancelled' %}
                    <h3><span class="badge bg-danger fs-5">{% trans "ملغاة" %}</span></h3>
                {% endif %}
            </div>

            <div class="card shadow-sm mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-info-circle"></i> {% trans "معلومات الصيانة" %}</h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="text-muted small">{% trans "الأصل" %}</label>
                            <p class="h6">
                                <a href="{% url 'assets:asset_detail' maintenance.asset.pk %}">
                                    {{ maintenance.asset.name }}
                                </a>
                            </p>
                        </div>
                        <div class="col-md-6">
                            <label class="text-muted small">{% trans "التاريخ المجدول" %}</label>
                            <p class="h6">{{ maintenance.scheduled_date|date:"Y-m-d" }}</p>
                        </div>
                        <div class="col-md-6">
                            <label class="text-muted small">{% trans "نوع الصيانة" %}</label>
                            <p class="h6">{{ maintenance.maintenance_type.name }}</p>
                        </div>
                        <div class="col-md-6">
                            <label class="text-muted small">{% trans "التصنيف" %}</label>
                            <p class="h6">{{ maintenance.get_category_display }}</p>
                        </div>
                        {% if maintenance.actual_start_date %}
                        <div class="col-md-6">
                            <label class="text-muted small">{% trans "تاريخ البدء الفعلي" %}</label>
                            <p class="h6">{{ maintenance.actual_start_date|date:"Y-m-d H:i" }}</p>
                        </div>
                        {% endif %}
                        {% if maintenance.actual_completion_date %}
                        <div class="col-md-6">
                            <label class="text-muted small">{% trans "تاريخ الانتهاء الفعلي" %}</label>
                            <p class="h6">{{ maintenance.actual_completion_date|date:"Y-m-d H:i" }}</p>
                        </div>
                        {% endif %}
                    </div>

                    {% if maintenance.description %}
                    <hr>
                    <div>
                        <label class="text-muted small">{% trans "الوصف" %}</label>
                        <p>{{ maintenance.description }}</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Financial Info -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-dollar-sign"></i> {% trans "المعلومات المالية" %}</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-3">
                            <div class="p-3 bg-light rounded">
                                <div class="text-muted small">{% trans "التكلفة المقدرة" %}</div>
                                <div class="h4 text-primary">{{ maintenance.estimated_cost|floatformat:3|default:"0.000" }}</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="p-3 bg-light rounded">
                                <div class="text-muted small">{% trans "التكلفة الفعلية" %}</div>
                                <div class="h4 text-success">{{ maintenance.actual_cost|floatformat:3|default:"0.000" }}</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="p-3 bg-light rounded">
                                <div class="text-muted small">{% trans "قطع الغيار" %}</div>
                                <div class="h4 text-info">{{ maintenance.parts_cost|floatformat:3|default:"0.000" }}</div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="p-3 bg-light rounded">
                                <div class="text-muted small">{% trans "العمالة" %}</div>
                                <div class="h4 text-warning">{{ maintenance.labor_cost|floatformat:3|default:"0.000" }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Work Done -->
            {% if maintenance.work_done %}
            <div class="card shadow-sm">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fas fa-clipboard-list"></i> {% trans "العمل المنجز" %}</h5>
                </div>
                <div class="card-body">
                    <p class="mb-0">{{ maintenance.work_done }}</p>
                </div>
            </div>
            {% endif %}
        </div>

        <div class="col-lg-4">
            <!-- Technician Info -->
            {% if maintenance.technician %}
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="fas fa-user-cog"></i> {% trans "الفني المسؤول" %}</h6>
                </div>
                <div class="card-body">
                    <p class="mb-0">{{ maintenance.technician }}</p>
                </div>
            </div>
            {% endif %}

            <!-- Vendor Info -->
            {% if maintenance.vendor %}
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="fas fa-building"></i> {% trans "المورد" %}</h6>
                </div>
                <div class="card-body">
                    <p class="mb-0">{{ maintenance.vendor }}</p>
                </div>
            </div>
            {% endif %}

            <!-- Audit Info -->
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="fas fa-history"></i> {% trans "معلومات التدقيق" %}</h6>
                </div>
                <div class="card-body">
                    <p class="small mb-2">
                        <i class="fas fa-user text-muted"></i>
                        <strong>{% trans "أُنشئ بواسطة:" %}</strong><br>
                        {{ maintenance.created_by|default:"النظام" }}
                    </p>
                    <p class="small mb-2">
                        <i class="fas fa-clock text-muted"></i>
                        <strong>{% trans "تاريخ الإنشاء:" %}</strong><br>
                        {{ maintenance.created_at|date:"Y-m-d H:i" }}
                    </p>
                    {% if maintenance.updated_by %}
                    <p class="small mb-2">
                        <i class="fas fa-user-edit text-muted"></i>
                        <strong>{% trans "آخر تعديل بواسطة:" %}</strong><br>
                        {{ maintenance.updated_by }}
                    </p>
                    <p class="small mb-0">
                        <i class="fas fa-clock text-muted"></i>
                        <strong>{% trans "تاريخ آخر تعديل:" %}</strong><br>
                        {{ maintenance.updated_at|date:"Y-m-d H:i" }}
                    </p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
