{# apps/assets/templates/assets/maintenance/type_confirm_delete.html #}
{% extends 'base/base.html' %}
{% load i18n %}

{% block title %}{% trans "تأكيد حذف نوع الصيانة" %}{% endblock %}

{% block extra_css %}
<style>
.delete-card {
    border: none;
    box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.15);
}

.delete-card .card-header {
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    border-bottom: none;
}

.warning-icon {
    font-size: 4rem;
    color: #dc3545;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.6; }
}
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <!-- Delete Confirmation Card -->
            <div class="card delete-card">
                <div class="card-header text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-exclamation-triangle"></i>
                        {% trans "تأكيد حذف نوع الصيانة" %}
                    </h5>
                </div>

                <div class="card-body">
                    <!-- Warning Icon -->
                    <div class="text-center mb-4">
                        <i class="fas fa-exclamation-circle warning-icon"></i>
                    </div>

                    <div class="alert alert-danger text-center">
                        <h5 class="mb-0">
                            {% trans "هل أنت متأكد من حذف نوع الصيانة" %}: <strong>{{ object.name }}</strong>؟
                        </h5>
                    </div>

                    <!-- Check if has dependencies -->
                    {% if maintenance_count > 0 %}
                        <!-- Cannot delete - has maintenance -->
                        <div class="alert alert-danger">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-ban fa-2x me-3"></i>
                                <div>
                                    <strong>{% trans "لا يمكن الحذف!" %}</strong>
                                    <p class="mb-0">
                                        {% trans "هذا النوع مرتبط بـ" %}
                                        <span class="badge bg-dark">{{ maintenance_count }}</span>
                                        {% trans "صيانة" %}.
                                    </p>
                                    <small class="text-muted">
                                        {% trans "يجب حذف أو نقل جميع الصيانات المرتبطة قبل الحذف" %}
                                    </small>
                                </div>
                            </div>
                        </div>

                        <!-- Object Details -->
                        <div class="card border-danger mb-3">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">
                                    <i class="fas fa-info-circle"></i> {% trans "معلومات النوع" %}
                                </h6>
                            </div>
                            <div class="card-body">
                                <table class="table table-sm mb-0">
                                    <tr>
                                        <th width="40%">{% trans "الرمز" %}</th>
                                        <td><code>{{ object.code }}</code></td>
                                    </tr>
                                    <tr>
                                        <th>{% trans "الاسم" %}</th>
                                        <td>{{ object.name }}</td>
                                    </tr>
                                    <tr>
                                        <th>{% trans "نوع الصيانة" %}</th>
                                        <td>{{ object.get_type_display }}</td>
                                    </tr>
                                    <tr>
                                        <th>{% trans "الصيانات المرتبطة" %}</th>
                                        <td><span class="badge bg-danger">{{ maintenance_count }}</span></td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-flex justify-content-between">
                            <a href="{% url 'assets:maintenance_type_list' %}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> {% trans "العودة للقائمة" %}
                            </a>
                            <a href="{% url 'assets:maintenance_type_detail' object.pk %}" class="btn btn-primary">
                                <i class="fas fa-eye"></i> {% trans "عرض التفاصيل" %}
                            </a>
                        </div>

                    {% elif schedule_count > 0 %}
                        <!-- Has schedules - warning -->
                        <div class="alert alert-warning">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-exclamation-triangle fa-2x me-3"></i>
                                <div>
                                    <strong>{% trans "تحذير!" %}</strong>
                                    <p class="mb-0">
                                        {% trans "هذا النوع مرتبط بـ" %}
                                        <span class="badge bg-dark">{{ schedule_count }}</span>
                                        {% trans "جدول صيانة دوري" %}.
                                    </p>
                                    <small class="text-muted">
                                        {% trans "سيتم حذف جداول الصيانة أيضاً عند حذف هذا النوع" %}
                                    </small>
                                </div>
                            </div>
                        </div>

                        <!-- Object Details -->
                        <div class="card border-warning mb-3">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">
                                    <i class="fas fa-info-circle"></i> {% trans "معلومات النوع" %}
                                </h6>
                            </div>
                            <div class="card-body">
                                <table class="table table-sm mb-0">
                                    <tr>
                                        <th width="40%">{% trans "الرمز" %}</th>
                                        <td><code>{{ object.code }}</code></td>
                                    </tr>
                                    <tr>
                                        <th>{% trans "الاسم" %}</th>
                                        <td>{{ object.name }}</td>
                                    </tr>
                                    <tr>
                                        <th>{% trans "نوع الصيانة" %}</th>
                                        <td>{{ object.get_type_display }}</td>
                                    </tr>
                                    <tr>
                                        <th>{% trans "جداول الصيانة" %}</th>
                                        <td><span class="badge bg-warning text-dark">{{ schedule_count }}</span></td>
                                    </tr>
                                    <tr>
                                        <th>{% trans "الحالة" %}</th>
                                        <td>
                                            {% if object.is_active %}
                                                <span class="badge bg-success">{% trans "نشط" %}</span>
                                            {% else %}
                                                <span class="badge bg-secondary">{% trans "غير نشط" %}</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <!-- Confirmation Form -->
                        <form method="post">
                            {% csrf_token %}
                            <div class="d-flex justify-content-between align-items-center">
                                <a href="{% url 'assets:maintenance_type_detail' object.pk %}" class="btn btn-secondary">
                                    <i class="fas fa-times"></i> {% trans "إلغاء" %}
                                </a>
                                <button type="submit" class="btn btn-danger">
                                    <i class="fas fa-trash"></i> {% trans "حذف نهائياً" %}
                                </button>
                            </div>
                        </form>

                    {% else %}
                        <!-- Safe to delete -->
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            {% trans "هذا النوع غير مرتبط بأي صيانات أو جداول. يمكن حذفه بأمان." %}
                        </div>

                        <!-- Object Details -->
                        <div class="card border-info mb-3">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">
                                    <i class="fas fa-info-circle"></i> {% trans "معلومات النوع" %}
                                </h6>
                            </div>
                            <div class="card-body">
                                <table class="table table-sm mb-0">
                                    <tr>
                                        <th width="40%">{% trans "الرمز" %}</th>
                                        <td><code>{{ object.code }}</code></td>
                                    </tr>
                                    <tr>
                                        <th>{% trans "الاسم" %}</th>
                                        <td>{{ object.name }}</td>
                                    </tr>
                                    <tr>
                                        <th>{% trans "نوع الصيانة" %}</th>
                                        <td>{{ object.get_type_display }}</td>
                                    </tr>
                                    <tr>
                                        <th>{% trans "الحالة" %}</th>
                                        <td>
                                            {% if object.is_active %}
                                                <span class="badge bg-success">{% trans "نشط" %}</span>
                                            {% else %}
                                                <span class="badge bg-secondary">{% trans "غير نشط" %}</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <!-- Confirmation Form -->
                        <form method="post" id="deleteForm">
                            {% csrf_token %}
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="confirmDelete" required>
                                <label class="form-check-label" for="confirmDelete">
                                    {% trans "أؤكد أنني أريد حذف هذا النوع نهائياً" %}
                                </label>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <a href="{% url 'assets:maintenance_type_detail' object.pk %}" class="btn btn-secondary">
                                    <i class="fas fa-times"></i> {% trans "إلغاء" %}
                                </a>
                                <button type="submit" class="btn btn-danger" id="deleteBtn" disabled>
                                    <i class="fas fa-trash"></i> {% trans "حذف نهائياً" %}
                                </button>
                            </div>
                        </form>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Enable delete button only when checkbox is checked
    $('#confirmDelete').on('change', function() {
        $('#deleteBtn').prop('disabled', !this.checked);
    });

    // Confirm before deletion
    $('#deleteForm').on('submit', function(e) {
        const confirmed = confirm('{% trans "هل أنت متأكد من حذف هذا النوع نهائياً؟" %}');
        if (!confirmed) {
            e.preventDefault();
        }
    });
});
</script>
{% endblock %}
