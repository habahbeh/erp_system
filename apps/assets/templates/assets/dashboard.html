{# apps/assets/templates/assets/dashboard.html #}
{% extends 'base/base.html' %}
{% load i18n static %}

{% block title %}لوحة الأصول الثابتة{% endblock %}

{% block extra_css %}
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<style>
:root {
  --primary-color: #6366f1;
  --primary-light: #818cf8;
  --primary-dark: #4f46e5;
  --secondary-color: #424242;
  --success-color: #10b981;
  --warning-color: #f59e0b;
  --error-color: #ef4444;
  --info-color: #3b82f6;
  --surface-color: #ffffff;
  --background-color: #f8f9fa;
  --text-primary: #212121;
  --text-secondary: #757575;
  --border-color: #e0e0e0;
  --shadow-1: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
  --shadow-2: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);
  --shadow-3: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);
  --border-radius: 8px;
  --border-radius-large: 12px;
}

* {
  box-sizing: border-box;
}

body {
  font-family: 'Cairo', sans-serif;
  background-color: var(--background-color);
  color: var(--text-primary);
  line-height: 1.6;
}

.dashboard-container {
  max-width: 1440px;
  margin: 0 auto;
  padding: 24px;
}

/* Header Section */
.dashboard-header {
  margin-bottom: 32px;
  padding: 0;
}

.dashboard-title {
  font-size: 2.125rem;
  font-weight: 400;
  color: var(--text-primary);
  margin: 0 0 8px 0;
  letter-spacing: 0.0125em;
}

.dashboard-subtitle {
  font-size: 1rem;
  color: var(--text-secondary);
  margin: 0 0 16px 0;
  font-weight: 400;
}

.company-info {
  display: inline-flex;
  align-items: center;
  background: var(--surface-color);
  padding: 8px 16px;
  border-radius: 20px;
  border: 1px solid var(--border-color);
  font-size: 0.875rem;
  color: var(--text-secondary);
}

.company-info .material-icons {
  font-size: 18px;
  margin-left: 8px;
  color: var(--primary-color);
}

/* Stats Cards */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 24px;
  margin-bottom: 40px;
}

.stats-card {
  background: var(--surface-color);
  border-radius: var(--border-radius-large);
  padding: 24px;
  box-shadow: var(--shadow-1);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  border: 1px solid var(--border-color);
}

.stats-card:hover {
  box-shadow: var(--shadow-2);
  transform: translateY(-2px);
}

.stats-card-content {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
}

.stats-text {
  flex: 1;
}

.stats-label {
  font-size: 0.875rem;
  color: var(--text-secondary);
  margin: 0 0 8px 0;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.stats-value {
  font-size: 2rem;
  font-weight: 300;
  color: var(--text-primary);
  margin: 0;
  line-height: 1.2;
}

.stats-change {
  font-size: 0.75rem;
  margin-top: 8px;
  display: flex;
  align-items: center;
}

.stats-change.positive {
  color: var(--success-color);
}

.stats-change.negative {
  color: var(--error-color);
}

.stats-icon {
  width: 56px;
  height: 56px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-right: 16px;
  flex-shrink: 0;
}

.stats-icon .material-icons {
  font-size: 28px;
  color: var(--surface-color);
}

.stats-card.total-assets .stats-icon { background: linear-gradient(135deg, var(--primary-color), var(--primary-light)); }
.stats-card.original-cost .stats-icon { background: linear-gradient(135deg, var(--success-color), #34d399); }
.stats-card.depreciation .stats-icon { background: linear-gradient(135deg, var(--warning-color), #fbbf24); }
.stats-card.book-value .stats-icon { background: linear-gradient(135deg, var(--info-color), #60a5fa); }

/* Quick Actions */
.quick-actions {
  margin-bottom: 40px;
}

.section-title {
  font-size: 1.5rem;
  font-weight: 400;
  color: var(--text-primary);
  margin: 0 0 24px 0;
}

.actions-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 20px;
}

.action-card {
  background: var(--surface-color);
  border-radius: var(--border-radius-large);
  padding: 24px;
  text-align: center;
  box-shadow: var(--shadow-1);
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  text-decoration: none;
  color: inherit;
  border: 1px solid var(--border-color);
  position: relative;
  overflow: hidden;
  display: block;
}

.action-card:hover {
  box-shadow: var(--shadow-2);
  transform: translateY(-4px);
  text-decoration: none;
  color: inherit;
}

.action-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: var(--primary-color);
  transform: scaleX(0);
  transition: transform 0.3s ease;
}

.action-card:hover::before {
  transform: scaleX(1);
}

.action-icon {
  width: 64px;
  height: 64px;
  border-radius: 50%;
  margin: 0 auto 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
}

.action-icon .material-icons {
  font-size: 32px;
  color: var(--surface-color);
}

.action-card.new-asset .action-icon { background: linear-gradient(135deg, #6366f1, #818cf8); }
.action-card.depreciation .action-icon { background: linear-gradient(135deg, #f59e0b, #fbbf24); }
.action-card.maintenance .action-icon { background: linear-gradient(135deg, #10b981, #34d399); }
.action-card.reports .action-icon { background: linear-gradient(135deg, #8b5cf6, #a78bfa); }

.action-title {
  font-size: 1.125rem;
  font-weight: 500;
  color: var(--text-primary);
  margin: 0 0 8px 0;
}

.action-description {
  font-size: 0.875rem;
  color: var(--text-secondary);
  margin: 0 0 16px 0;
  line-height: 1.5;
}

.action-button {
  background: var(--primary-color);
  color: var(--surface-color);
  border: none;
  padding: 8px 16px;
  border-radius: 20px;
  font-size: 0.875rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s ease;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.action-button:hover {
  background: var(--primary-dark);
  transform: scale(1.05);
}

/* Content Grid */
.content-grid {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 32px;
  margin-bottom: 40px;
}

/* Content Cards */
.content-card {
  background: var(--surface-color);
  border-radius: var(--border-radius-large);
  padding: 0;
  box-shadow: var(--shadow-1);
  border: 1px solid var(--border-color);
  overflow: hidden;
}

.card-header {
  padding: 20px 24px;
  border-bottom: 1px solid var(--border-color);
  background: #fafafa;
}

.card-title {
  font-size: 1.25rem;
  font-weight: 500;
  color: var(--text-primary);
  margin: 0;
  display: flex;
  align-items: center;
}

.card-title .material-icons {
  font-size: 24px;
  margin-left: 12px;
  color: var(--primary-color);
}

.card-body {
  padding: 24px;
}

/* Alert Cards */
.alert-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.alert-item {
  padding: 16px 20px;
  border-bottom: 1px solid var(--border-color);
  transition: background-color 0.2s ease;
  display: flex;
  align-items: center;
  gap: 16px;
}

.alert-item:hover {
  background-color: #f5f5f5;
}

.alert-item:last-child {
  border-bottom: none;
}

.alert-item-icon {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  flex-shrink: 0;
}

.alert-item-icon.warning { background: rgba(245, 158, 11, 0.1); color: var(--warning-color); }
.alert-item-icon.error { background: rgba(239, 68, 68, 0.1); color: var(--error-color); }
.alert-item-icon.info { background: rgba(59, 130, 246, 0.1); color: var(--info-color); }

.alert-item-content {
  flex: 1;
}

.alert-item-title {
  font-size: 0.9375rem;
  font-weight: 500;
  color: var(--text-primary);
  margin: 0 0 4px 0;
}

.alert-item-text {
  font-size: 0.8125rem;
  color: var(--text-secondary);
  margin: 0;
}

/* Recent Activity Table */
.activity-table {
  width: 100%;
  border-collapse: collapse;
}

.activity-table th,
.activity-table td {
  padding: 12px;
  text-align: right;
  border-bottom: 1px solid var(--border-color);
}

.activity-table th {
  font-weight: 500;
  color: var(--text-secondary);
  font-size: 0.875rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  background: #fafafa;
}

.activity-table td {
  font-size: 0.875rem;
  color: var(--text-primary);
}

.activity-link {
  color: var(--primary-color);
  text-decoration: none;
  font-weight: 500;
}

.activity-link:hover {
  text-decoration: underline;
}

.status-badge {
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.status-badge.active {
  background: rgba(16, 185, 129, 0.1);
  color: var(--success-color);
}

.status-badge.inactive {
  background: rgba(107, 114, 128, 0.1);
  color: #6b7280;
}

.status-badge.maintenance {
  background: rgba(245, 158, 11, 0.1);
  color: var(--warning-color);
}

/* Loading Spinner */
.loading-container {
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 48px;
}

.spinner {
  width: 40px;
  height: 40px;
  border: 4px solid var(--border-color);
  border-top: 4px solid var(--primary-color);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Responsive Design */
@media (max-width: 968px) {
  .content-grid {
    grid-template-columns: 1fr;
    gap: 24px;
  }

  .dashboard-container {
    padding: 16px;
  }

  .stats-grid {
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 16px;
  }

  .actions-grid {
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
  }
}

@media (max-width: 576px) {
  .dashboard-title {
    font-size: 1.75rem;
  }

  .stats-card {
    padding: 20px;
  }

  .action-card {
    padding: 20px;
  }

  .stats-value {
    font-size: 1.75rem;
  }
}

/* Animations */
.fade-in {
  animation: fadeIn 0.6s ease-out;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.slide-up {
  animation: slideUp 0.4s ease-out;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Header -->
    <div class="dashboard-header fade-in">
        <h1 class="dashboard-title">لوحة الأصول الثابتة</h1>
        <p class="dashboard-subtitle">نظرة شاملة على الأصول الثابتة والصيانة والإهلاك</p>
        <div class="company-info">
            <span class="material-icons">business</span>
            <span>{{ current_company.name }}</span>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
        <div class="stats-card total-assets slide-up" style="animation-delay: 0.1s">
            <div class="stats-card-content">
                <div class="stats-text">
                    <div class="stats-label">إجمالي الأصول</div>
                    <div class="stats-value" id="totalAssets">...</div>
                    <div class="stats-change positive">
                        <span class="material-icons" style="font-size: 16px;">trending_up</span>
                        <span id="assetsChange">...</span>
                    </div>
                </div>
                <div class="stats-icon">
                    <span class="material-icons">inventory_2</span>
                </div>
            </div>
        </div>

        <div class="stats-card original-cost slide-up" style="animation-delay: 0.2s">
            <div class="stats-card-content">
                <div class="stats-text">
                    <div class="stats-label">التكلفة الأصلية</div>
                    <div class="stats-value" id="originalCost">...</div>
                    <div class="stats-change">
                        <span style="color: var(--text-secondary); font-size: 0.75rem;">دينار أردني</span>
                    </div>
                </div>
                <div class="stats-icon">
                    <span class="material-icons">attach_money</span>
                </div>
            </div>
        </div>

        <div class="stats-card depreciation slide-up" style="animation-delay: 0.3s">
            <div class="stats-card-content">
                <div class="stats-text">
                    <div class="stats-label">الإهلاك المتراكم</div>
                    <div class="stats-value" id="totalDepreciation">...</div>
                    <div class="stats-change">
                        <span style="color: var(--text-secondary); font-size: 0.75rem;">دينار أردني</span>
                    </div>
                </div>
                <div class="stats-icon">
                    <span class="material-icons">trending_down</span>
                </div>
            </div>
        </div>

        <div class="stats-card book-value slide-up" style="animation-delay: 0.4s">
            <div class="stats-card-content">
                <div class="stats-text">
                    <div class="stats-label">القيمة الدفترية</div>
                    <div class="stats-value" id="bookValue">...</div>
                    <div class="stats-change">
                        <span style="color: var(--text-secondary); font-size: 0.75rem;">دينار أردني</span>
                    </div>
                </div>
                <div class="stats-icon">
                    <span class="material-icons">account_balance</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
        <h2 class="section-title">إجراءات سريعة</h2>
        <div class="actions-grid">
            <a href="{% url 'assets:asset_create' %}" class="action-card new-asset slide-up" style="animation-delay: 0.5s">
                <div class="action-icon">
                    <span class="material-icons">add_circle</span>
                </div>
                <h3 class="action-title">أصل جديد</h3>
                <p class="action-description">إضافة أصل ثابت جديد للنظام</p>
                <button class="action-button">إضافة أصل</button>
            </a>

            <a href="{% url 'assets:bulk_calculate_depreciation' %}" class="action-card depreciation slide-up" style="animation-delay: 0.6s">
                <div class="action-icon">
                    <span class="material-icons">calculate</span>
                </div>
                <h3 class="action-title">احتساب الإهلاك</h3>
                <p class="action-description">احتساب الإهلاك الدوري للأصول</p>
                <button class="action-button">احتساب</button>
            </a>

            <a href="{% url 'assets:maintenance_create' %}" class="action-card maintenance slide-up" style="animation-delay: 0.7s">
                <div class="action-icon">
                    <span class="material-icons">build</span>
                </div>
                <h3 class="action-title">صيانة جديدة</h3>
                <p class="action-description">تسجيل عملية صيانة للأصول</p>
                <button class="action-button">تسجيل صيانة</button>
            </a>

            <a href="{% url 'assets:reports' %}" class="action-card reports slide-up" style="animation-delay: 0.8s">
                <div class="action-icon">
                    <span class="material-icons">assessment</span>
                </div>
                <h3 class="action-title">التقارير</h3>
                <p class="action-description">عرض تقارير الأصول والإهلاك</p>
                <button class="action-button">عرض التقارير</button>
            </a>
        </div>
    </div>

    <!-- Content Grid -->
    <div class="content-grid">
        <!-- Recent Activity -->
        <div class="content-card slide-up" style="animation-delay: 0.9s">
            <div class="card-header">
                <h3 class="card-title">
                    <span class="material-icons">history</span>
                    آخر الأصول المضافة
                </h3>
            </div>
            <div class="card-body">
                <div id="recentAssets">
                    <div class="loading-container">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alerts -->
        <div class="content-card slide-up" style="animation-delay: 1s">
            <div class="card-header">
                <h3 class="card-title">
                    <span class="material-icons">notifications</span>
                    التنبيهات
                </h3>
            </div>
            <div class="card-body">
                <ul class="alert-list" id="alertsList">
                    <div class="loading-container">
                        <div class="spinner"></div>
                    </div>
                </ul>
            </div>
        </div>
    </div>

    <!-- Maintenance Section -->
    <div class="content-card slide-up" style="animation-delay: 1.1s">
        <div class="card-header">
            <h3 class="card-title">
                <span class="material-icons">build_circle</span>
                الصيانة القادمة
            </h3>
        </div>
        <div class="card-body">
            <div id="upcomingMaintenance">
                <div class="loading-container">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // تحميل جميع البيانات
    Promise.all([
        loadDashboardStats(),
        loadRecentAssets(),
        loadAlerts(),
        loadUpcomingMaintenance()
    ]).then(() => {
        console.log('تم تحميل جميع بيانات الداشبورد');
    }).catch(error => {
        console.error('خطأ في تحميل بيانات الداشبورد:', error);
        showError('خطأ في تحميل البيانات');
    });

    // إضافة تأثيرات الحركة
    addScrollAnimations();
});

async function loadDashboardStats() {
    try {
        const response = await fetch('{% url "assets:dashboard_stats_ajax" %}', {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'Content-Type': 'application/json',
            }
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();

        if (!data.success) {
            throw new Error(data.error || 'خطأ غير معروف');
        }

        // تحديث الإحصائيات
        animateCounter('totalAssets', data.stats.total_assets || 0);
        animateCounter('originalCost', data.stats.total_cost || 0);
        animateCounter('totalDepreciation', data.stats.total_depreciation || 0);
        animateCounter('bookValue', data.stats.total_book_value || 0);

        // تحديث التغيير
        if (data.stats.assets_change !== undefined) {
            document.getElementById('assetsChange').textContent = `${data.stats.assets_change}% من الشهر الماضي`;
        }

    } catch (error) {
        console.error('خطأ في تحميل الإحصائيات:', error);
        // عرض قيم افتراضية في حالة الخطأ
        document.getElementById('totalAssets').textContent = '--';
        document.getElementById('originalCost').textContent = '--';
        document.getElementById('totalDepreciation').textContent = '--';
        document.getElementById('bookValue').textContent = '--';
        document.getElementById('assetsChange').textContent = '--';

        showError('فشل في تحميل الإحصائيات');
    }
}

async function loadRecentAssets() {
    try {
        const response = await fetch('{% url "assets:asset_datatable_ajax" %}?length=5&order=created_at&dir=desc', {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'Content-Type': 'application/json',
            }
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();

        // بناء جدول الأصول
        const assetsHtml = generateAssetsTable(data.data || []);
        document.getElementById('recentAssets').innerHTML = assetsHtml;

    } catch (error) {
        console.error('خطأ في تحميل الأصول:', error);
        document.getElementById('recentAssets').innerHTML = `
            <div class="text-center py-4">
                <p class="text-muted">لا توجد أصول للعرض</p>
            </div>
        `;
        showError('فشل في تحميل آخر الأصول');
    }
}

async function loadAlerts() {
    try {
        const response = await fetch('{% url "assets:notification_details_ajax" %}', {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'Content-Type': 'application/json',
            }
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();

        // بناء قائمة التنبيهات
        const alertsHtml = generateAlertsList(data.alerts || []);
        document.getElementById('alertsList').innerHTML = alertsHtml;

    } catch (error) {
        console.error('خطأ في تحميل التنبيهات:', error);
        document.getElementById('alertsList').innerHTML = `
            <div class="text-center py-4">
                <p class="text-muted">لا توجد تنبيهات</p>
            </div>
        `;
        showError('فشل في تحميل التنبيهات');
    }
}

async function loadUpcomingMaintenance() {
    try {
        const response = await fetch('{% url "assets:maintenance_datatable_ajax" %}?status=scheduled&length=5', {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'Content-Type': 'application/json',
            }
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();

        // بناء جدول الصيانة
        const maintenanceHtml = generateMaintenanceTable(data.data || []);
        document.getElementById('upcomingMaintenance').innerHTML = maintenanceHtml;

    } catch (error) {
        console.error('خطأ في تحميل الصيانة:', error);
        document.getElementById('upcomingMaintenance').innerHTML = `
            <div class="text-center py-4">
                <p class="text-muted">لا توجد صيانة قادمة</p>
            </div>
        `;
        showError('فشل في تحميل الصيانة القادمة');
    }
}

function generateAssetsTable(assets) {
    if (!assets || assets.length === 0) {
        return `
            <div class="text-center py-4">
                <p class="text-muted">لا توجد أصول للعرض</p>
            </div>
        `;
    }

    let tableHtml = `
        <table class="activity-table">
            <thead>
                <tr>
                    <th>رقم الأصل</th>
                    <th>الاسم</th>
                    <th>الفئة</th>
                    <th>القيمة الدفترية</th>
                    <th>الحالة</th>
                </tr>
            </thead>
            <tbody>
    `;

    assets.forEach(asset => {
        const statusClass = getAssetStatusClass(asset.status);

        tableHtml += `
            <tr>
                <td><a href="/assets/assets/${asset.id}/" class="activity-link">${asset.asset_number || '--'}</a></td>
                <td>${asset.name || '--'}</td>
                <td>${asset.category_name || '--'}</td>
                <td>${formatNumber(asset.book_value || 0)}</td>
                <td><span class="status-badge ${statusClass}">${asset.status_display || '--'}</span></td>
            </tr>
        `;
    });

    tableHtml += `
            </tbody>
        </table>
    `;

    return tableHtml;
}

function generateAlertsList(alerts) {
    if (!alerts || alerts.length === 0) {
        return `
            <div class="text-center py-4">
                <p class="text-muted">لا توجد تنبيهات</p>
            </div>
        `;
    }

    let alertsHtml = '';

    alerts.forEach(alert => {
        alertsHtml += `
            <li class="alert-item">
                <div class="alert-item-icon ${alert.type}">
                    <span class="material-icons">${alert.icon || 'info'}</span>
                </div>
                <div class="alert-item-content">
                    <div class="alert-item-title">${alert.title}</div>
                    <div class="alert-item-text">${alert.message}</div>
                </div>
            </li>
        `;
    });

    return alertsHtml;
}

function generateMaintenanceTable(maintenances) {
    if (!maintenances || maintenances.length === 0) {
        return `
            <div class="text-center py-4">
                <p class="text-muted">لا توجد صيانة قادمة</p>
            </div>
        `;
    }

    let tableHtml = `
        <table class="activity-table">
            <thead>
                <tr>
                    <th>رقم الصيانة</th>
                    <th>الأصل</th>
                    <th>النوع</th>
                    <th>التاريخ المجدول</th>
                    <th>الحالة</th>
                </tr>
            </thead>
            <tbody>
    `;

    maintenances.forEach(maintenance => {
        tableHtml += `
            <tr>
                <td><a href="/assets/maintenance/${maintenance.id}/" class="activity-link">${maintenance.maintenance_number || '--'}</a></td>
                <td>${maintenance.asset_name || '--'}</td>
                <td>${maintenance.type_name || '--'}</td>
                <td>${maintenance.scheduled_date || '--'}</td>
                <td><span class="status-badge">${maintenance.status_display || '--'}</span></td>
            </tr>
        `;
    });

    tableHtml += `
            </tbody>
        </table>
    `;

    return tableHtml;
}

function getAssetStatusClass(status) {
    const statusClasses = {
        'active': 'active',
        'inactive': 'inactive',
        'under_maintenance': 'maintenance',
        'disposed': 'inactive',
        'sold': 'inactive'
    };
    return statusClasses[status] || 'inactive';
}

function formatNumber(number) {
    if (typeof number !== 'number') {
        return '0.00';
    }
    return new Intl.NumberFormat('en-US', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
    }).format(number);
}

function animateCounter(elementId, target) {
    const element = document.getElementById(elementId);
    if (!element) return;

    let current = 0;
    const increment = Math.max(1, Math.ceil(target / 50));
    const duration = 2000; // 2 seconds
    const stepTime = Math.abs(Math.floor(duration / (target / increment)));

    const timer = setInterval(() => {
        current += increment;
        if (current >= target) {
            element.textContent = formatNumber(target);
            clearInterval(timer);
        } else {
            element.textContent = formatNumber(current);
        }
    }, stepTime);
}

function addScrollAnimations() {
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.animationPlayState = 'running';
            }
        });
    }, observerOptions);

    document.querySelectorAll('.slide-up').forEach(el => {
        observer.observe(el);
    });
}

function showError(message) {
    console.warn(message);

    const errorDiv = document.createElement('div');
    errorDiv.className = 'alert alert-warning fade-in';
    errorDiv.style.cssText = `
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 9999;
        max-width: 400px;
        padding: 12px 20px;
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 8px;
        color: #856404;
        font-size: 14px;
    `;
    errorDiv.textContent = message;

    document.body.appendChild(errorDiv);

    setTimeout(() => {
        errorDiv.remove();
    }, 5000);
}
</script>
{% endblock %}
