# Generated by Django 4.1.13 on 2025-08-23 06:09

from decimal import Decimal
from django.conf import settings
import django.core.validators
from django.db import migrations, models
import django.db.models.deletion


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('base_data', '0002_businesspartner_itemcomponent_itemconversion_and_more'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
        ('core', '0003_custompermission_numberingsequence_systemsettings_and_more'),
        ('accounting', '0001_initial'),
        ('sales', '0001_initial'),
        ('purchases', '0001_initial'),
    ]

    operations = [
        migrations.CreateModel(
            name='StockCount',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='تاريخ الإنشاء')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='تاريخ التعديل')),
                ('is_active', models.BooleanField(default=True, verbose_name='نشط')),
                ('number', models.CharField(editable=False, max_length=50, verbose_name='رقم الجرد')),
                ('date', models.DateField(verbose_name='تاريخ الجرد')),
                ('count_type', models.CharField(choices=[('periodic', 'جرد دوري'), ('annual', 'جرد سنوي'), ('cycle', 'جرد دائري'), ('special', 'جرد خاص')], default='periodic', max_length=20, verbose_name='نوع الجرد')),
                ('status', models.CharField(choices=[('planned', 'مخطط'), ('in_progress', 'جاري'), ('completed', 'مكتمل'), ('approved', 'معتمد'), ('cancelled', 'ملغي')], default='planned', max_length=20, verbose_name='الحالة')),
                ('approval_date', models.DateTimeField(blank=True, null=True, verbose_name='تاريخ الاعتماد')),
                ('notes', models.TextField(blank=True, verbose_name='ملاحظات')),
                ('adjustment_entry', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='accounting.journalentry', verbose_name='قيد التسوية')),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_counts', to=settings.AUTH_USER_MODEL, verbose_name='اعتمد بواسطة')),
                ('branch', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, to='core.branch', verbose_name='الفرع')),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.company', verbose_name='الشركة')),
                ('count_team', models.ManyToManyField(related_name='stock_counts', to=settings.AUTH_USER_MODEL, verbose_name='فريق الجرد')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL, verbose_name='أنشأ بواسطة')),
                ('supervisor', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='supervised_counts', to=settings.AUTH_USER_MODEL, verbose_name='المشرف')),
                ('updated_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL, verbose_name='عدّل بواسطة')),
                ('warehouse', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='base_data.warehouse', verbose_name='المستودع')),
            ],
            options={
                'verbose_name': 'جرد',
                'verbose_name_plural': 'الجرد',
                'ordering': ['-date', '-number'],
            },
        ),
        migrations.CreateModel(
            name='StockTransfer',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='تاريخ الإنشاء')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='تاريخ التعديل')),
                ('is_active', models.BooleanField(default=True, verbose_name='نشط')),
                ('document_type', models.CharField(choices=[('in', 'سند إدخال'), ('out', 'سند إخراج'), ('transfer', 'سند تحويل')], max_length=10, verbose_name='نوع السند')),
                ('number', models.CharField(editable=False, max_length=50, verbose_name='رقم السند')),
                ('date', models.DateField(verbose_name='التاريخ')),
                ('reference', models.CharField(blank=True, help_text='رقم الفاتورة أو المستند المرتبط', max_length=100, verbose_name='المرجع')),
                ('is_posted', models.BooleanField(default=False, verbose_name='مرحل')),
                ('posted_date', models.DateTimeField(blank=True, null=True, verbose_name='تاريخ الترحيل')),
                ('notes', models.TextField(blank=True, verbose_name='ملاحظات')),
                ('approval_date', models.DateTimeField(blank=True, null=True, verbose_name='تاريخ الاعتماد')),
                ('received_date', models.DateTimeField(blank=True, null=True, verbose_name='تاريخ الاستلام')),
                ('status', models.CharField(choices=[('draft', 'مسودة'), ('pending', 'معلق'), ('approved', 'معتمد'), ('in_transit', 'في الطريق'), ('received', 'مستلم'), ('cancelled', 'ملغي')], default='draft', max_length=20, verbose_name='الحالة')),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_transfers', to=settings.AUTH_USER_MODEL, verbose_name='اعتمد بواسطة')),
                ('branch', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, to='core.branch', verbose_name='الفرع')),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.company', verbose_name='الشركة')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL, verbose_name='أنشأ بواسطة')),
                ('destination_warehouse', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='incoming_transfers', to='base_data.warehouse', verbose_name='المستودع الهدف')),
                ('posted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_posted', to=settings.AUTH_USER_MODEL, verbose_name='رحل بواسطة')),
                ('received_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='received_transfers', to=settings.AUTH_USER_MODEL, verbose_name='استلم بواسطة')),
                ('updated_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL, verbose_name='عدّل بواسطة')),
                ('warehouse', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_documents', to='base_data.warehouse', verbose_name='المستودع')),
            ],
            options={
                'verbose_name': 'تحويل مخزني',
                'verbose_name_plural': 'التحويلات المخزنية',
                'ordering': ['-date', '-number'],
                'unique_together': {('company', 'number')},
            },
        ),
        migrations.CreateModel(
            name='StockTransferLine',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('barcode', models.CharField(blank=True, max_length=50, verbose_name='باركود')),
                ('quantity', models.DecimalField(decimal_places=3, max_digits=12, validators=[django.core.validators.MinValueValidator(Decimal('0.001'))], verbose_name='الكمية')),
                ('received_quantity', models.DecimalField(decimal_places=3, default=0, max_digits=12, verbose_name='الكمية المستلمة')),
                ('unit_cost', models.DecimalField(decimal_places=3, max_digits=12, validators=[django.core.validators.MinValueValidator(0)], verbose_name='الإفرادي')),
                ('total_cost', models.DecimalField(decimal_places=3, default=0, editable=False, max_digits=15, verbose_name='الإجمالي')),
                ('notes', models.TextField(blank=True, verbose_name='ملاحظات')),
                ('item', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='base_data.item', verbose_name='المادة')),
                ('transfer', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lines', to='inventory.stocktransfer', verbose_name='التحويل')),
            ],
            options={
                'verbose_name': 'سطر تحويل',
                'verbose_name_plural': 'سطور التحويلات',
            },
        ),
        migrations.CreateModel(
            name='StockOut',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='تاريخ الإنشاء')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='تاريخ التعديل')),
                ('is_active', models.BooleanField(default=True, verbose_name='نشط')),
                ('document_type', models.CharField(choices=[('in', 'سند إدخال'), ('out', 'سند إخراج'), ('transfer', 'سند تحويل')], max_length=10, verbose_name='نوع السند')),
                ('number', models.CharField(editable=False, max_length=50, verbose_name='رقم السند')),
                ('date', models.DateField(verbose_name='التاريخ')),
                ('reference', models.CharField(blank=True, help_text='رقم الفاتورة أو المستند المرتبط', max_length=100, verbose_name='المرجع')),
                ('is_posted', models.BooleanField(default=False, verbose_name='مرحل')),
                ('posted_date', models.DateTimeField(blank=True, null=True, verbose_name='تاريخ الترحيل')),
                ('notes', models.TextField(blank=True, verbose_name='ملاحظات')),
                ('destination_type', models.CharField(choices=[('sales', 'مبيعات'), ('return', 'مرتجع مشتريات'), ('consumption', 'استهلاك'), ('damage', 'تالف'), ('adjustment', 'تسوية'), ('other', 'أخرى')], max_length=20, verbose_name='جهة الإخراج')),
                ('branch', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, to='core.branch', verbose_name='الفرع')),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.company', verbose_name='الشركة')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL, verbose_name='أنشأ بواسطة')),
                ('customer', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, to='base_data.customer', verbose_name='العميل')),
                ('journal_entry', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='accounting.journalentry', verbose_name='القيد المحاسبي')),
                ('posted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_posted', to=settings.AUTH_USER_MODEL, verbose_name='رحل بواسطة')),
                ('sales_invoice', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='stock_outs', to='sales.salesinvoice', verbose_name='فاتورة المبيعات')),
                ('updated_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL, verbose_name='عدّل بواسطة')),
                ('warehouse', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_documents', to='base_data.warehouse', verbose_name='المستودع')),
            ],
            options={
                'verbose_name': 'سند إخراج',
                'verbose_name_plural': 'سندات الإخراج',
                'ordering': ['-date', '-number'],
                'unique_together': {('company', 'number')},
            },
        ),
        migrations.CreateModel(
            name='StockMovement',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('date', models.DateTimeField(auto_now_add=True, verbose_name='التاريخ والوقت')),
                ('movement_type', models.CharField(choices=[('in', 'إدخال'), ('out', 'إخراج'), ('transfer_out', 'تحويل صادر'), ('transfer_in', 'تحويل وارد')], max_length=20, verbose_name='نوع الحركة')),
                ('quantity', models.DecimalField(decimal_places=3, max_digits=12, verbose_name='الكمية')),
                ('unit_cost', models.DecimalField(decimal_places=3, max_digits=12, verbose_name='تكلفة الوحدة')),
                ('total_cost', models.DecimalField(decimal_places=3, max_digits=15, verbose_name='التكلفة الإجمالية')),
                ('balance_quantity', models.DecimalField(decimal_places=3, max_digits=12, verbose_name='رصيد الكمية')),
                ('balance_value', models.DecimalField(decimal_places=3, max_digits=15, verbose_name='رصيد القيمة')),
                ('reference_type', models.CharField(blank=True, max_length=50, verbose_name='نوع المرجع')),
                ('reference_id', models.IntegerField(blank=True, null=True, verbose_name='رقم المرجع')),
                ('reference_number', models.CharField(blank=True, max_length=50, verbose_name='رقم المستند')),
                ('branch', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, to='core.branch', verbose_name='الفرع')),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.company', verbose_name='الشركة')),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to=settings.AUTH_USER_MODEL, verbose_name='أنشأ بواسطة')),
                ('item', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='base_data.item', verbose_name='المادة')),
                ('warehouse', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='base_data.warehouse', verbose_name='المستودع')),
            ],
            options={
                'verbose_name': 'حركة صنف',
                'verbose_name_plural': 'حركة الأصناف',
                'ordering': ['-date'],
            },
        ),
        migrations.CreateModel(
            name='StockIn',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='تاريخ الإنشاء')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='تاريخ التعديل')),
                ('is_active', models.BooleanField(default=True, verbose_name='نشط')),
                ('document_type', models.CharField(choices=[('in', 'سند إدخال'), ('out', 'سند إخراج'), ('transfer', 'سند تحويل')], max_length=10, verbose_name='نوع السند')),
                ('number', models.CharField(editable=False, max_length=50, verbose_name='رقم السند')),
                ('date', models.DateField(verbose_name='التاريخ')),
                ('reference', models.CharField(blank=True, help_text='رقم الفاتورة أو المستند المرتبط', max_length=100, verbose_name='المرجع')),
                ('is_posted', models.BooleanField(default=False, verbose_name='مرحل')),
                ('posted_date', models.DateTimeField(blank=True, null=True, verbose_name='تاريخ الترحيل')),
                ('notes', models.TextField(blank=True, verbose_name='ملاحظات')),
                ('source_type', models.CharField(choices=[('purchase', 'مشتريات'), ('return', 'مرتجع مبيعات'), ('production', 'إنتاج'), ('opening', 'رصيد افتتاحي'), ('adjustment', 'تسوية'), ('other', 'أخرى')], max_length=20, verbose_name='مصدر الإدخال')),
                ('branch', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, to='core.branch', verbose_name='الفرع')),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.company', verbose_name='الشركة')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created', to=settings.AUTH_USER_MODEL, verbose_name='أنشأ بواسطة')),
                ('journal_entry', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='accounting.journalentry', verbose_name='القيد المحاسبي')),
                ('posted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_posted', to=settings.AUTH_USER_MODEL, verbose_name='رحل بواسطة')),
                ('purchase_invoice', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='stock_ins', to='purchases.purchaseinvoice', verbose_name='فاتورة المشتريات')),
                ('supplier', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, to='base_data.supplier', verbose_name='المورد')),
                ('updated_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated', to=settings.AUTH_USER_MODEL, verbose_name='عدّل بواسطة')),
                ('warehouse', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='%(class)s_documents', to='base_data.warehouse', verbose_name='المستودع')),
            ],
            options={
                'verbose_name': 'سند إدخال',
                'verbose_name_plural': 'سندات الإدخال',
                'ordering': ['-date', '-number'],
            },
        ),
        migrations.CreateModel(
            name='StockDocumentLine',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('quantity', models.DecimalField(decimal_places=3, max_digits=12, validators=[django.core.validators.MinValueValidator(Decimal('0.001'))], verbose_name='الكمية')),
                ('unit_cost', models.DecimalField(decimal_places=3, max_digits=12, validators=[django.core.validators.MinValueValidator(0)], verbose_name='تكلفة الوحدة')),
                ('total_cost', models.DecimalField(decimal_places=3, default=0, editable=False, max_digits=15, verbose_name='التكلفة الإجمالية')),
                ('batch_number', models.CharField(blank=True, max_length=50, verbose_name='رقم الدفعة')),
                ('expiry_date', models.DateField(blank=True, null=True, verbose_name='تاريخ الانتهاء')),
                ('notes', models.TextField(blank=True, verbose_name='ملاحظات')),
                ('item', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='base_data.item', verbose_name='المادة')),
                ('stock_in', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='lines', to='inventory.stockin', verbose_name='سند الإدخال')),
                ('stock_out', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='lines', to='inventory.stockout', verbose_name='سند الإخراج')),
            ],
            options={
                'verbose_name': 'سطر سند مخزني',
                'verbose_name_plural': 'سطور السندات المخزنية',
            },
        ),
        migrations.CreateModel(
            name='StockCountLine',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('system_quantity', models.DecimalField(decimal_places=3, help_text='الكمية المسجلة في النظام', max_digits=12, verbose_name='الكمية بالنظام')),
                ('counted_quantity', models.DecimalField(decimal_places=3, help_text='الكمية المحسوبة فعلياً', max_digits=12, verbose_name='الكمية الفعلية')),
                ('difference_quantity', models.DecimalField(decimal_places=3, default=0, editable=False, max_digits=12, verbose_name='الفرق')),
                ('unit_cost', models.DecimalField(decimal_places=3, max_digits=12, verbose_name='تكلفة الوحدة')),
                ('system_value', models.DecimalField(decimal_places=3, editable=False, max_digits=15, verbose_name='القيمة بالنظام')),
                ('counted_value', models.DecimalField(decimal_places=3, editable=False, max_digits=15, verbose_name='القيمة الفعلية')),
                ('difference_value', models.DecimalField(decimal_places=3, default=0, editable=False, max_digits=15, verbose_name='فرق القيمة')),
                ('notes', models.TextField(blank=True, verbose_name='ملاحظات')),
                ('adjustment_reason', models.CharField(blank=True, max_length=200, verbose_name='سبب الفرق')),
                ('count', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lines', to='inventory.stockcount', verbose_name='الجرد')),
                ('item', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='base_data.item', verbose_name='المادة')),
            ],
            options={
                'verbose_name': 'سطر جرد',
                'verbose_name_plural': 'سطور الجرد',
            },
        ),
        migrations.CreateModel(
            name='ItemStock',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('quantity', models.DecimalField(decimal_places=3, default=0, max_digits=12, verbose_name='الكمية المتاحة')),
                ('reserved_quantity', models.DecimalField(decimal_places=3, default=0, max_digits=12, verbose_name='الكمية المحجوزة')),
                ('average_cost', models.DecimalField(decimal_places=3, default=0, max_digits=12, verbose_name='متوسط التكلفة')),
                ('total_value', models.DecimalField(decimal_places=3, default=0, max_digits=15, verbose_name='القيمة الإجمالية')),
                ('last_movement_date', models.DateTimeField(blank=True, null=True, verbose_name='تاريخ آخر حركة')),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.company', verbose_name='الشركة')),
                ('item', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='base_data.item', verbose_name='المادة')),
                ('warehouse', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='base_data.warehouse', verbose_name='المستودع')),
            ],
            options={
                'verbose_name': 'رصيد مادة',
                'verbose_name_plural': 'أرصدة المواد',
            },
        ),
        migrations.AddIndex(
            model_name='stockmovement',
            index=models.Index(fields=['item', 'warehouse', '-date'], name='inventory_s_item_id_2ee36b_idx'),
        ),
        migrations.AddIndex(
            model_name='stockmovement',
            index=models.Index(fields=['reference_type', 'reference_id'], name='inventory_s_referen_5aaa1a_idx'),
        ),
        migrations.AlterUniqueTogether(
            name='stockin',
            unique_together={('company', 'number')},
        ),
        migrations.AlterUniqueTogether(
            name='stockcountline',
            unique_together={('count', 'item')},
        ),
        migrations.AlterUniqueTogether(
            name='stockcount',
            unique_together={('company', 'number')},
        ),
        migrations.AlterUniqueTogether(
            name='itemstock',
            unique_together={('item', 'warehouse')},
        ),
    ]
