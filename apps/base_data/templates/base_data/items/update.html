<!-- apps/base_data/templates/base_data/items/update.html -->
{% extends 'base_data/items/create.html' %}
{% load i18n %}

{% block form_icon %}<i class="fas fa-edit me-2"></i>{% endblock %}
{% block form_title %}{% trans "تعديل الصنف" %}: {{ item.name }}{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item">
    <a href="{% url 'base_data:item_list' %}">{% trans "الأصناف" %}</a>
</li>
<li class="breadcrumb-item">
    <a href="{% url 'base_data:item_detail' item.pk %}">{{ item.name }}</a>
</li>
<li class="breadcrumb-item active">{% trans "تعديل" %}</li>
{% endblock %}

{% block back_url %}{% url 'base_data:item_detail' item.pk %}{% endblock %}
{% block cancel_url %}{% url 'base_data:item_detail' item.pk %}{% endblock %}

{% block submit_text %}{% trans "حفظ التعديلات" %}{% endblock %}

{% block form_actions %}
<div class="btn-group" role="group">
    <a href="{% url 'base_data:item_detail' item.pk %}" class="btn btn-secondary btn-sm">
        <i class="fas fa-arrow-right me-1"></i>{% trans "رجوع" %}
    </a>
    {% if perms.base_data.delete_item %}
    <a href="{% url 'base_data:item_delete' item.pk %}" class="btn btn-danger btn-sm">
        <i class="fas fa-trash me-1"></i>{% trans "حذف" %}
    </a>
    {% endif %}
</div>
{% endblock %}

{% block form_custom_js %}
{{ block.super }}

// إضافة تبويبات للمعدلات والمكونات في حالة التعديل
$(document).ready(function() {
    // إضافة tabs للمعدلات والمكونات
    if($('#conversion-formset').length || $('#component-formset').length) {
        addAdvancedTabs();
    }
});

function addAdvancedTabs() {
    let tabsHtml = `
        <ul class="nav nav-tabs mb-3" id="advancedTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="conversions-tab" data-bs-toggle="tab"
                        data-bs-target="#conversions" type="button" role="tab">
                    <i class="fas fa-exchange-alt me-1"></i>{% trans "معدلات التحويل" %}
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="components-tab" data-bs-toggle="tab"
                        data-bs-target="#components" type="button" role="tab">
                    <i class="fas fa-puzzle-piece me-1"></i>{% trans "المكونات" %}
                </button>
            </li>
        </ul>
    `;

    $('.row:last').after(tabsHtml);

    let tabContent = `
        <div class="tab-content" id="advancedTabContent">
            <div class="tab-pane fade show active" id="conversions" role="tabpanel">
                <div id="conversion-formset"></div>
            </div>
            <div class="tab-pane fade" id="components" role="tabpanel">
                <div id="component-formset"></div>
            </div>
        </div>
    `;

    $('#advancedTabs').after(tabContent);
}
{% endblock %}