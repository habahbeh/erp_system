<!-- File: apps/base_data/templates/base_data/categories/create.html -->
{% extends 'base_data/base/form_base.html' %}
{% load i18n widget_tweaks %}

{% block breadcrumb_items %}
<li class="breadcrumb-item">
    <a href="{% url 'base_data:category_list' %}">{% trans "التصنيفات" %}</a>
</li>
<li class="breadcrumb-item active">{% trans "إضافة تصنيف جديد" %}</li>
{% endblock %}

{% block form_icon %}<i class="fas fa-plus-circle me-2"></i>{% endblock %}
{% block form_title %}{% trans "إضافة تصنيف جديد" %}{% endblock %}
{% block back_url %}{% url 'base_data:category_list' %}{% endblock %}
{% block cancel_url %}{% url 'base_data:category_list' %}{% endblock %}

{% block main_fields %}
<!-- Basic Information Card -->
<div class="card mb-4">
    <div class="card-header bg-primary text-white">
        <h6 class="card-title mb-0">
            <i class="fas fa-info-circle me-2"></i>{% trans "المعلومات الأساسية" %}
        </h6>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <div class="form-group">
                    <label for="{{ form.code.id_for_label }}" class="form-label">
                        {{ form.code.label }}
                        {% if form.code.field.required %}<span class="text-danger">*</span>{% endif %}
                    </label>
                    {{ form.code|add_class:"form-control" }}
                    {% if form.code.errors %}
                        <div class="invalid-feedback d-block">{{ form.code.errors.0 }}</div>
                    {% endif %}
                    <div class="form-text">{% trans "رمز فريد للتصنيف" %}</div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="{{ form.parent.id_for_label }}" class="form-label">
                        {{ form.parent.label }}
                    </label>
                    {{ form.parent|add_class:"form-select" }}
                    {% if form.parent.errors %}
                        <div class="invalid-feedback d-block">{{ form.parent.errors.0 }}</div>
                    {% endif %}
                    <div class="form-text">{% trans "اختر التصنيف الأب (اختياري)" %}</div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="form-group">
                    <label for="{{ form.name.id_for_label }}" class="form-label required-field">
                        {{ form.name.label }}
                    </label>
                    {{ form.name|add_class:"form-control" }}
                    {% if form.name.errors %}
                        <div class="invalid-feedback d-block">{{ form.name.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="form-group">
                    <label for="{{ form.name_en.id_for_label }}" class="form-label">
                        {{ form.name_en.label }}
                    </label>
                    {{ form.name_en|add_class:"form-control" }}
                    {% if form.name_en.errors %}
                        <div class="invalid-feedback d-block">{{ form.name_en.errors.0 }}</div>
                    {% endif %}
                    <div class="form-text">{% trans "الاسم باللغة الإنجليزية (اختياري)" %}</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Additional Information Card -->
<div class="card">
    <div class="card-header bg-secondary text-white">
        <h6 class="card-title mb-0">
            <i class="fas fa-cogs me-2"></i>{% trans "معلومات إضافية" %}
        </h6>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-12">
                <div class="form-group">
                    <label for="{{ form.description.id_for_label }}" class="form-label">
                        {{ form.description.label }}
                    </label>
                    {{ form.description|add_class:"form-control"|attr:"rows:4" }}
                    {% if form.description.errors %}
                        <div class="invalid-feedback d-block">{{ form.description.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="form-group">
                    <label for="{{ form.notes.id_for_label }}" class="form-label">
                        {{ form.notes.label }}
                    </label>
                    {{ form.notes|add_class:"form-control"|attr:"rows:3" }}
                    {% if form.notes.errors %}
                        <div class="invalid-feedback d-block">{{ form.notes.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block side_fields %}
<!-- Status Card -->
<div class="card mb-4">
    <div class="card-header bg-success text-white">
        <h6 class="card-title mb-0">
            <i class="fas fa-toggle-on me-2"></i>{% trans "الحالة" %}
        </h6>
    </div>
    <div class="card-body">
        <div class="form-check form-switch">
            {{ form.is_active|add_class:"form-check-input" }}
            <label for="{{ form.is_active.id_for_label }}" class="form-check-label">
                {{ form.is_active.label }}
            </label>
            {% if form.is_active.errors %}
                <div class="invalid-feedback d-block">{{ form.is_active.errors.0 }}</div>
            {% endif %}
        </div>
        <div class="form-text">{% trans "التصنيفات غير النشطة لن تظهر في القوائم" %}</div>
    </div>
</div>

<!-- Preview Card -->
<div class="card">
    <div class="card-header bg-info text-white">
        <h6 class="card-title mb-0">
            <i class="fas fa-eye me-2"></i>{% trans "معاينة" %}
        </h6>
    </div>
    <div class="card-body">
        <div id="category-preview">
            <div class="text-muted text-center py-3">
                <i class="fas fa-sitemap fa-2x mb-2"></i>
                <p>{% trans "املأ الحقول لمعاينة التصنيف" %}</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block form_custom_js %}
// Update preview when fields change
function updatePreview() {
    var name = $('#id_name').val();
    var nameEn = $('#id_name_en').val();
    var parent = $('#id_parent option:selected').text();
    var isActive = $('#id_is_active').is(':checked');

    if (!name) {
        $('#category-preview').html(
            '<div class="text-muted text-center py-3">' +
            '<i class="fas fa-sitemap fa-2x mb-2"></i>' +
            '<p>املأ الحقول لمعاينة التصنيف</p>' +
            '</div>'
        );
        return;
    }

    var html = '<div class="category-preview-item">';

    // Parent indicator
    if (parent && parent !== '---------') {
        html += '<small class="text-muted"><i class="fas fa-arrow-up me-1"></i>' + parent + '</small><br>';
    }

    // Category name
    html += '<h6 class="mb-1">';
    html += '<i class="fas fa-folder me-2"></i>' + name;
    if (isActive) {
        html += ' <span class="badge bg-success">نشط</span>';
    } else {
        html += ' <span class="badge bg-danger">غير نشط</span>';
    }
    html += '</h6>';

    // English name
    if (nameEn) {
        html += '<small class="text-muted">' + nameEn + '</small>';
    }

    html += '</div>';

    $('#category-preview').html(html);
}

// Bind events
$('#id_name, #id_name_en, #id_parent, #id_is_active').on('input change', updatePreview);

// Auto-generate code based on name
$('#id_name').on('input', function() {
    var name = $(this).val();
    if (name && !$('#id_code').val()) {
        var code = name.replace(/\s+/g, '_').replace(/[^\w\u0600-\u06FF]/g, '').toUpperCase();
        if (code.length > 20) code = code.substr(0, 20);
        $('#id_code').val(code);
    }
    updatePreview();
});

// Initialize preview
$(document).ready(function() {
    updatePreview();
});
{% endblock %}