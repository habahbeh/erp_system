{# apps/base_data/templates/base_data/supplier/form.html #}
{% extends 'base/base.html' %}
{% load i18n static %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<style>
    .required:after {
        content: " *";
        color: red;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <!-- رأس الصفحة -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h3">{{ title }}</h1>
                <a href="{% url 'base_data:supplier_list' %}" class="btn btn-secondary">
                    <i class="fas fa-arrow-right"></i> {% trans "رجوع للقائمة" %}
                </a>
            </div>

            <!-- النموذج -->
            <form method="post" class="needs-validation" novalidate>
                {% csrf_token %}

                <!-- الأخطاء العامة -->
                {% if form.non_field_errors %}
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    {{ form.non_field_errors }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
                {% endif %}

                <div class="card">
                    <div class="card-body">
                        <!-- معلومات أساسية -->
                        <h5 class="card-title mb-4">
                            <i class="fas fa-info-circle"></i> {% trans "معلومات أساسية" %}
                        </h5>

                        <div class="row mb-3">
                            <div class="col-md-3">
                                <label for="{{ form.code.id_for_label }}" class="form-label required">
                                    {{ form.code.label }}
                                </label>
                                {{ form.code }}
                                {% if form.code.errors %}
                                    <div class="invalid-feedback d-block">{{ form.code.errors.0 }}</div>
                                {% endif %}
                            </div>

                            <div class="col-md-6">
                                <label for="{{ form.name.id_for_label }}" class="form-label required">
                                    {{ form.name.label }}
                                </label>
                                {{ form.name }}
                                {% if form.name.errors %}
                                    <div class="invalid-feedback d-block">{{ form.name.errors.0 }}</div>
                                {% endif %}
                            </div>

                            <div class="col-md-3">
                                <label for="{{ form.account_type.id_for_label }}" class="form-label">
                                    {{ form.account_type.label }}
                                </label>
                                {{ form.account_type }}
                                {% if form.account_type.errors %}
                                    <div class="invalid-feedback d-block">{{ form.account_type.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="{{ form.name_en.id_for_label }}" class="form-label">
                                    {{ form.name_en.label }}
                                </label>
                                {{ form.name_en }}
                                {% if form.name_en.errors %}
                                    <div class="invalid-feedback d-block">{{ form.name_en.errors.0 }}</div>
                                {% endif %}
                            </div>

                            <div class="col-md-6">
                                <label for="{{ form.contact_person.id_for_label }}" class="form-label">
                                    {{ form.contact_person.label }}
                                </label>
                                {{ form.contact_person }}
                                {% if form.contact_person.errors %}
                                    <div class="invalid-feedback d-block">{{ form.contact_person.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <hr class="my-4">

                        <!-- معلومات الاتصال -->
                        <h5 class="card-title mb-4">
                            <i class="fas fa-phone"></i> {% trans "معلومات الاتصال" %}
                        </h5>

                        <div class="row mb-3">
                            <div class="col-md-3">
                                <label for="{{ form.phone.id_for_label }}" class="form-label">
                                    {{ form.phone.label }}
                                </label>
                                {{ form.phone }}
                                {% if form.phone.errors %}
                                    <div class="invalid-feedback d-block">{{ form.phone.errors.0 }}</div>
                                {% endif %}
                            </div>

                            <div class="col-md-3">
                                <label for="{{ form.mobile.id_for_label }}" class="form-label">
                                    {{ form.mobile.label }}
                                </label>
                                {{ form.mobile }}
                                {% if form.mobile.errors %}
                                    <div class="invalid-feedback d-block">{{ form.mobile.errors.0 }}</div>
                                {% endif %}
                            </div>

                            <div class="col-md-3">
                                <label for="{{ form.fax.id_for_label }}" class="form-label">
                                    {{ form.fax.label }}
                                </label>
                                {{ form.fax }}
                                {% if form.fax.errors %}
                                    <div class="invalid-feedback d-block">{{ form.fax.errors.0 }}</div>
                                {% endif %}
                            </div>

                            <div class="col-md-3">
                                <label for="{{ form.email.id_for_label }}" class="form-label">
                                    {{ form.email.label }}
                                </label>
                                {{ form.email }}
                                {% if form.email.errors %}
                                    <div class="invalid-feedback d-block">{{ form.email.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="{{ form.website.id_for_label }}" class="form-label">
                                    {{ form.website.label }}
                                </label>
                                {{ form.website }}
                                {% if form.website.errors %}
                                    <div class="invalid-feedback d-block">{{ form.website.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <hr class="my-4">

                        <!-- العنوان -->
                        <h5 class="card-title mb-4">
                            <i class="fas fa-map-marker-alt"></i> {% trans "العنوان" %}
                        </h5>

                        <div class="row mb-3">
                            <div class="col-md-12">
                                <label for="{{ form.address.id_for_label }}" class="form-label">
                                    {{ form.address.label }}
                                </label>
                                {{ form.address }}
                                {% if form.address.errors %}
                                    <div class="invalid-feedback d-block">{{ form.address.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="{{ form.city.id_for_label }}" class="form-label">
                                    {{ form.city.label }}
                                </label>
                                {{ form.city }}
                                {% if form.city.errors %}
                                    <div class="invalid-feedback d-block">{{ form.city.errors.0 }}</div>
                                {% endif %}
                            </div>

                            <div class="col-md-6">
                                <label for="{{ form.region.id_for_label }}" class="form-label">
                                    {{ form.region.label }}
                                </label>
                                {{ form.region }}
                                {% if form.region.errors %}
                                    <div class="invalid-feedback d-block">{{ form.region.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <hr class="my-4">

                        <!-- معلومات ضريبية -->
                        <h5 class="card-title mb-4">
                            <i class="fas fa-file-invoice"></i> {% trans "معلومات ضريبية" %}
                        </h5>

                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="{{ form.tax_number.id_for_label }}" class="form-label">
                                    {{ form.tax_number.label }}
                                </label>
                                {{ form.tax_number }}
                                {% if form.tax_number.errors %}
                                    <div class="invalid-feedback d-block">{{ form.tax_number.errors.0 }}</div>
                                {% endif %}
                            </div>

                            <div class="col-md-4">
                                <label for="{{ form.tax_status.id_for_label }}" class="form-label">
                                    {{ form.tax_status.label }}
                                </label>
                                {{ form.tax_status }}
                                {% if form.tax_status.errors %}
                                    <div class="invalid-feedback d-block">{{ form.tax_status.errors.0 }}</div>
                                {% endif %}
                            </div>

                            <div class="col-md-4">
                                <label for="{{ form.commercial_register.id_for_label }}" class="form-label">
                                    {{ form.commercial_register.label }}
                                </label>
                                {{ form.commercial_register }}
                                {% if form.commercial_register.errors %}
                                    <div class="invalid-feedback d-block">{{ form.commercial_register.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <hr class="my-4">

                        <!-- حدود الائتمان -->
                        <h5 class="card-title mb-4">
                            <i class="fas fa-credit-card"></i> {% trans "حدود الائتمان" %}
                        </h5>

                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="{{ form.credit_limit.id_for_label }}" class="form-label">
                                    {{ form.credit_limit.label }}
                                </label>
                                <div class="input-group">
                                    {{ form.credit_limit }}
                                    <span class="input-group-text">{{ CURRENCY }}</span>
                                </div>
                                {% if form.credit_limit.errors %}
                                    <div class="invalid-feedback d-block">{{ form.credit_limit.errors.0 }}</div>
                                {% endif %}
                            </div>

                            <div class="col-md-4">
                                <label for="{{ form.credit_period.id_for_label }}" class="form-label">
                                    {{ form.credit_period.label }}
                                </label>
                                <div class="input-group">
                                    {{ form.credit_period }}
                                    <span class="input-group-text">{% trans "يوم" %}</span>
                                </div>
                                {% if form.credit_period.errors %}
                                    <div class="invalid-feedback d-block">{{ form.credit_period.errors.0 }}</div>
                                {% endif %}
                            </div>

                            <div class="col-md-4">
                                <label for="{{ form.payment_terms.id_for_label }}" class="form-label">
                                    {{ form.payment_terms.label }}
                                </label>
                                {{ form.payment_terms }}
                                {% if form.payment_terms.errors %}
                                    <div class="invalid-feedback d-block">{{ form.payment_terms.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <hr class="my-4">

                        <!-- معلومات إضافية -->
                        <h5 class="card-title mb-4">
                            <i class="fas fa-info"></i> {% trans "معلومات إضافية" %}
                        </h5>

                        <div class="row mb-3">
                            <div class="col-md-12">
                                <div class="form-check">
                                    {{ form.is_active }}
                                    <label class="form-check-label" for="{{ form.is_active.id_for_label }}">
                                        {{ form.is_active.label }}
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-12">
                                <label for="{{ form.notes.id_for_label }}" class="form-label">
                                    {{ form.notes.label }}
                                </label>
                                {{ form.notes }}
                                {% if form.notes.errors %}
                                    <div class="invalid-feedback d-block">{{ form.notes.errors.0 }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- أزرار الحفظ -->
                    <div class="card-footer">
                        <div class="d-flex justify-content-between">
                            <a href="{% url 'base_data:supplier_list' %}" class="btn btn-secondary">
                                <i class="fas fa-times"></i> {% trans "إلغاء" %}
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> {{ submit_text|default:_("حفظ") }}
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // تفعيل التحقق من الحقول المطلوبة
    (function() {
        'use strict';
        window.addEventListener('load', function() {
            var forms = document.getElementsByClassName('needs-validation');
            var validation = Array.prototype.filter.call(forms, function(form) {
                form.addEventListener('submit', function(event) {
                    if (form.checkValidity() === false) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        }, false);
    })();
</script>
{% endblock %}