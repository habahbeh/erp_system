<!-- apps/base_data/templates/base_data/partners/update.html -->
{% extends 'base_data/partners/create.html' %}
{% load i18n %}

{% block form_icon %}<i class="fas fa-user-edit me-2"></i>{% endblock %}
{% block form_title %}{% trans "تعديل الشريك" %}: {{ partner.name }}{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item">
    <a href="{% url 'base_data:partner_list' %}">{% trans "الشركاء التجاريون" %}</a>
</li>
<li class="breadcrumb-item">
    <a href="{% url 'base_data:partner_detail' partner.pk %}">{{ partner.name }}</a>
</li>
<li class="breadcrumb-item active">{% trans "تعديل" %}</li>
{% endblock %}

{% block back_url %}{% url 'base_data:partner_detail' partner.pk %}{% endblock %}
{% block cancel_url %}{% url 'base_data:partner_detail' partner.pk %}{% endblock %}

{% block submit_text %}{% trans "حفظ التعديلات" %}{% endblock %}

{% block form_actions %}
<div class="btn-group" role="group">
    <a href="{% url 'base_data:partner_detail' partner.pk %}" class="btn btn-secondary btn-sm">
        <i class="fas fa-arrow-right me-1"></i>{% trans "رجوع" %}
    </a>
    {% if perms.base_data.view_businesspartner %}
    <a href="{% url 'base_data:partner_statement' partner.pk %}" class="btn btn-info btn-sm">
        <i class="fas fa-file-invoice me-1"></i>{% trans "كشف الحساب" %}
    </a>
    {% endif %}
    {% if perms.base_data.delete_businesspartner %}
    <a href="{% url 'base_data:partner_delete' partner.pk %}" class="btn btn-danger btn-sm">
        <i class="fas fa-trash me-1"></i>{% trans "حذف" %}
    </a>
    {% endif %}
</div>
{% endblock %}

{% block form_custom_js %}
{{ block.super }}

// إضافة تبويبات للمعلومات الإضافية
$(document).ready(function() {
    // إضافة tabs للمعلومات المختلفة
    addPartnerTabs();
});

function addPartnerTabs() {
    let tabsHtml = `
        <ul class="nav nav-tabs mb-3" id="partnerTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="basic-info-tab" data-bs-toggle="tab"
                        data-bs-target="#basic-info" type="button" role="tab">
                    <i class="fas fa-info-circle me-1"></i>{% trans "المعلومات الأساسية" %}
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="contact-info-tab" data-bs-toggle="tab"
                        data-bs-target="#contact-info" type="button" role="tab">
                    <i class="fas fa-address-book me-1"></i>{% trans "معلومات الاتصال" %}
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="financial-info-tab" data-bs-toggle="tab"
                        data-bs-target="#financial-info" type="button" role="tab">
                    <i class="fas fa-money-bill-wave me-1"></i>{% trans "المعلومات المالية" %}
                </button>
            </li>
        </ul>
    `;

    $('form > .row:first').before(tabsHtml);

    // تجميع المحتوى في tabs
    let tabContent = `
        <div class="tab-content" id="partnerTabContent">
            <div class="tab-pane fade show active" id="basic-info" role="tabpanel">
                <div class="tab-basic-info"></div>
            </div>
            <div class="tab-pane fade" id="contact-info" role="tabpanel">
                <div class="tab-contact-info"></div>
            </div>
            <div class="tab-pane fade" id="financial-info" role="tabpanel">
                <div class="tab-financial-info"></div>
            </div>
        </div>
    `;

    $('#partnerTabs').after(tabContent);

    // نقل المحتوى إلى التبويبات
    $('.card').each(function(index) {
        let cardHeader = $(this).find('.card-header h6').text();

        if(cardHeader.includes('المعلومات الأساسية') || cardHeader.includes('الضريبية')) {
            $(this).appendTo('.tab-basic-info');
        } else if(cardHeader.includes('الاتصال')) {
            $(this).appendTo('.tab-contact-info');
        } else {
            $(this).appendTo('.tab-financial-info');
        }
    });
}
{% endblock %}