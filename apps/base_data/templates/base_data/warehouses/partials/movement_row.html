<!-- apps/base_data/templates/base_data/warehouses/partials/movement_row.html -->
{% load i18n humanize %}

<tr class="movement-row" data-movement-id="{{ movement.pk }}">
    <td>
        <div>
            <strong>{{ movement.created_at|date:"d/m/Y" }}</strong>
            <br><small class="text-muted">{{ movement.created_at|time:"H:i:s" }}</small>
        </div>
    </td>

    <td>
        <div class="d-flex align-items-center">
            {% if movement.item.image %}
                <img src="{{ movement.item.image.url }}" alt="{{ movement.item.name }}"
                     class="rounded me-2" style="width: 24px; height: 24px; object-fit: cover;">
            {% else %}
                <div class="bg-light border rounded me-2 d-flex align-items-center justify-content-center"
                     style="width: 24px; height: 24px;">
                    <i class="fas fa-box text-muted" style="font-size: 10px;"></i>
                </div>
            {% endif %}
            <div>
                <a href="{% url 'base_data:item_detail' movement.item.pk %}" class="text-decoration-none">
                    <strong>{{ movement.item.name }}</strong>
                </a>
                <br><small class="text-muted">{{ movement.item.code }}</small>
            </div>
        </div>
    </td>

    <td>
        {% if movement.movement_type == 'in' %}
            <span class="badge bg-success">
                <i class="fas fa-arrow-down me-1"></i>{% trans "دخول" %}
            </span>
        {% elif movement.movement_type == 'out' %}
            <span class="badge bg-danger">
                <i class="fas fa-arrow-up me-1"></i>{% trans "خروج" %}
            </span>
        {% elif movement.movement_type == 'adjustment' %}
            <span class="badge bg-warning">
                <i class="fas fa-edit me-1"></i>{% trans "تسوية" %}
            </span>
        {% elif movement.movement_type == 'transfer_in' %}
            <span class="badge bg-info">
                <i class="fas fa-arrow-right me-1"></i>{% trans "نقل وارد" %}
            </span>
        {% elif movement.movement_type == 'transfer_out' %}
            <span class="badge bg-secondary">
                <i class="fas fa-arrow-left me-1"></i>{% trans "نقل صادر" %}
            </span>
        {% else %}
            <span class="badge bg-light text-dark">{{ movement.get_movement_type_display }}</span>
        {% endif %}
    </td>

    <td class="text-center">
        <span class="fw-bold {% if movement.movement_type in 'in,transfer_in,adjustment' and movement.quantity > 0 %}text-success{% elif movement.movement_type in 'out,transfer_out' or movement.quantity < 0 %}text-danger{% else %}text-muted{% endif %}">
            {% if movement.movement_type in 'out,transfer_out' %}-{% endif %}{{ movement.quantity|floatformat:3 }}
        </span>
        <br><small class="text-muted">{{ movement.item.unit.name }}</small>
    </td>

    <td class="text-center">
        {% if movement.unit_cost %}
            <span class="fw-bold">{{ movement.unit_cost|floatformat:2 }}</span>
            <br><small class="text-muted">{% trans "ريال" %}</small>
        {% else %}
            <span class="text-muted">-</span>
        {% endif %}
    </td>

    <td class="text-center">
        <span class="fw-bold text-primary">{{ movement.balance_after|floatformat:3 }}</span>
    </td>

    <td>
        {% if movement.reference_number %}
            <code>{{ movement.reference_number }}</code>
            {% if movement.reference_url %}
                <br><a href="{{ movement.reference_url }}" target="_blank" class="btn btn-light btn-sm">
                    <i class="fas fa-external-link-alt"></i>
                </a>
            {% endif %}
        {% else %}
            <span class="text-muted">-</span>
        {% endif %}
    </td>

    <td>
        {% if movement.created_by %}
            <div>
                <i class="fas fa-user me-1"></i>{{ movement.created_by.get_full_name }}
            </div>
        {% else %}
            <span class="text-muted">{% trans "النظام" %}</span>
        {% endif %}
    </td>

    <td>
        {% if movement.notes %}
            <span class="text-truncate d-inline-block" style="max-width: 150px;"
                  title="{{ movement.notes }}">{{ movement.notes }}</span>
        {% else %}
            <span class="text-muted">-</span>
        {% endif %}
    </td>

    <td class="text-center">
        <div class="btn-group btn-group-sm">
            <button type="button" class="btn btn-light btn-sm"
                    onclick="showMovementDetails({{ movement.pk }})"
                    title="{% trans 'التفاصيل' %}">
                <i class="fas fa-eye"></i>
            </button>
            {% if movement.can_reverse and perms.base_data.change_warehouse %}
            <button type="button" class="btn btn-warning btn-sm"
                    onclick="reverseMovement({{ movement.pk }})"
                    title="{% trans 'عكس الحركة' %}">
                <i class="fas fa-undo"></i>
            </button>
            {% endif %}
        </div>
    </td>
</tr>