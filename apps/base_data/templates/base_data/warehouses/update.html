<!-- apps/base_data/templates/base_data/warehouses/update.html -->
{% extends 'base_data/warehouses/create.html' %}
{% load i18n %}

{% block form_icon %}<i class="fas fa-edit me-2"></i>{% endblock %}
{% block form_title %}{% trans "تعديل المستودع" %}: {{ warehouse.name }}{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item">
    <a href="{% url 'base_data:warehouse_list' %}">{% trans "المستودعات" %}</a>
</li>
<li class="breadcrumb-item">
    <a href="{% url 'base_data:warehouse_detail' warehouse.pk %}">{{ warehouse.name }}</a>
</li>
<li class="breadcrumb-item active">{% trans "تعديل" %}</li>
{% endblock %}

{% block back_url %}{% url 'base_data:warehouse_detail' warehouse.pk %}{% endblock %}
{% block cancel_url %}{% url 'base_data:warehouse_detail' warehouse.pk %}{% endblock %}

{% block submit_text %}{% trans "حفظ التعديلات" %}{% endblock %}

{% block form_actions %}
<div class="btn-group" role="group">
    <a href="{% url 'base_data:warehouse_detail' warehouse.pk %}" class="btn btn-secondary btn-sm">
        <i class="fas fa-arrow-right me-1"></i>{% trans "رجوع" %}
    </a>
    {% if perms.base_data.view_warehouse %}
    <a href="{% url 'base_data:warehouse_inventory' warehouse.pk %}" class="btn btn-info btn-sm">
        <i class="fas fa-boxes me-1"></i>{% trans "المخزون" %}
    </a>
    {% endif %}
    {% if perms.base_data.view_warehouse %}
    <a href="{% url 'base_data:warehouse_movements' warehouse.pk %}" class="btn btn-warning btn-sm">
        <i class="fas fa-exchange-alt me-1"></i>{% trans "الحركات" %}
    </a>
    {% endif %}
    {% if perms.base_data.delete_warehouse %}
    <a href="{% url 'base_data:warehouse_delete' warehouse.pk %}" class="btn btn-danger btn-sm">
        <i class="fas fa-trash me-1"></i>{% trans "حذف" %}
    </a>
    {% endif %}
</div>
{% endblock %}

{% block form_custom_js %}
{{ block.super }}

// إضافة تحذير إذا كان المستودع يحتوي على أصناف
$(document).ready(function() {
    {% if warehouse.items.count > 0 %}
    $('.card-body').first().prepend(`
        <div class="alert alert-warning">
            <h6 class="alert-heading">
                <i class="fas fa-exclamation-triangle me-1"></i>{% trans "تحذير" %}
            </h6>
            <p class="mb-0">
                {% trans "هذا المستودع يحتوي على" %} <strong>{{ warehouse.items.count }}</strong> {% trans "صنف. تأكد من أن التعديلات لن تؤثر على المخزون الموجود." %}
            </p>
        </div>
    `);
    {% endif %}

    // تحذير عند تغيير نوع المستودع إذا كان يحتوي على أصناف
    $('#id_warehouse_type').change(function() {
        {% if warehouse.items.count > 0 %}
        if(confirm('{% trans "تغيير نوع المستودع قد يؤثر على المخزون الموجود. هل أنت متأكد؟" %}')) {
            updateWarehouseTypeFields();
        } else {
            $(this).val('{{ warehouse.warehouse_type }}');
        }
        {% else %}
        updateWarehouseTypeFields();
        {% endif %}
    });
});
{% endblock %}