# Generated by Django 5.2.5 on 2025-11-27 16:28

import django.core.validators
import django.db.models.deletion
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('core', '0017_add_partner_item_price'),
        ('hr', '0009_performance_models'),
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        # Skip all LeaveBalance, LeaveRequest, and Attendance field changes
        # as the database schema is already correct - just sync model state
        migrations.SeparateDatabaseAndState(
            state_operations=[
                migrations.RemoveField(
                    model_name='leavebalance',
                    name='earned',
                ),
                migrations.RemoveField(
                    model_name='leaverequest',
                    name='approved_at',
                ),
                migrations.RemoveField(
                    model_name='leaverequest',
                    name='attachment',
                ),
                migrations.RemoveField(
                    model_name='leaverequest',
                    name='request_number',
                ),
                migrations.AddField(
                    model_name='leaverequest',
                    name='approval_date',
                    field=models.DateTimeField(blank=True, null=True, verbose_name='تاريخ الموافقة'),
                ),
                migrations.AddField(
                    model_name='leaverequest',
                    name='is_active',
                    field=models.BooleanField(default=True, verbose_name='نشط'),
                ),
                migrations.AlterField(
                    model_name='attendance',
                    name='working_hours',
                    field=models.DecimalField(db_column='work_hours', decimal_places=2, default=0, max_digits=5, verbose_name='ساعات العمل'),
                ),
                migrations.AlterField(
                    model_name='leavebalance',
                    name='opening_balance',
                    field=models.DecimalField(db_column='entitled_days', decimal_places=2, default=0, max_digits=5, verbose_name='الرصيد الافتتاحي'),
                ),
                migrations.AlterField(
                    model_name='leavebalance',
                    name='used',
                    field=models.DecimalField(db_column='used_days', decimal_places=2, default=0, max_digits=5, verbose_name='المستخدم'),
                ),
                migrations.AlterField(
                    model_name='leaverequest',
                    name='status',
                    field=models.CharField(choices=[('draft', 'مسودة'), ('pending', 'قيد الانتظار'), ('approved', 'موافق عليه'), ('rejected', 'مرفوض'), ('cancelled', 'ملغي')], default='pending', max_length=20, verbose_name='الحالة'),
                ),
            ],
            database_operations=[],  # Don't make any DB changes for these
        ),
        # Only create the new Training tables
        migrations.CreateModel(
            name='TrainingCategory',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, verbose_name='اسم الفئة')),
                ('name_en', models.CharField(blank=True, max_length=100, verbose_name='الاسم بالإنجليزية')),
                ('description', models.TextField(blank=True, verbose_name='الوصف')),
                ('is_active', models.BooleanField(default=True, verbose_name='نشط')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='training_categories', to='core.company', verbose_name='الشركة')),
                ('parent', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='children', to='hr.trainingcategory', verbose_name='الفئة الأم')),
            ],
            options={
                'verbose_name': 'فئة تدريب',
                'verbose_name_plural': 'فئات التدريب',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='TrainingProvider',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=200, verbose_name='اسم المزود')),
                ('provider_type', models.CharField(choices=[('internal', 'داخلي'), ('external', 'خارجي'), ('online', 'إلكتروني'), ('university', 'جامعة'), ('institute', 'معهد')], default='external', max_length=20, verbose_name='نوع المزود')),
                ('contact_person', models.CharField(blank=True, max_length=100, verbose_name='جهة الاتصال')),
                ('phone', models.CharField(blank=True, max_length=20, verbose_name='الهاتف')),
                ('email', models.EmailField(blank=True, max_length=254, verbose_name='البريد الإلكتروني')),
                ('website', models.URLField(blank=True, verbose_name='الموقع الإلكتروني')),
                ('address', models.TextField(blank=True, verbose_name='العنوان')),
                ('specializations', models.TextField(blank=True, help_text='مجالات التدريب التي يقدمها', verbose_name='التخصصات')),
                ('rating', models.DecimalField(blank=True, decimal_places=2, max_digits=3, null=True, validators=[django.core.validators.MinValueValidator(Decimal('0')), django.core.validators.MaxValueValidator(Decimal('5'))], verbose_name='التقييم')),
                ('notes', models.TextField(blank=True, verbose_name='ملاحظات')),
                ('is_active', models.BooleanField(default=True, verbose_name='نشط')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='training_providers', to='core.company', verbose_name='الشركة')),
            ],
            options={
                'verbose_name': 'مزود تدريب',
                'verbose_name_plural': 'مزودي التدريب',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='TrainingCourse',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('code', models.CharField(max_length=50, verbose_name='رمز الدورة')),
                ('name', models.CharField(max_length=200, verbose_name='اسم الدورة')),
                ('name_en', models.CharField(blank=True, max_length=200, verbose_name='الاسم بالإنجليزية')),
                ('description', models.TextField(blank=True, verbose_name='الوصف')),
                ('objectives', models.TextField(blank=True, help_text='ما سيتعلمه المتدربون', verbose_name='الأهداف')),
                ('course_type', models.CharField(choices=[('mandatory', 'إلزامي'), ('optional', 'اختياري'), ('certification', 'شهادة مهنية'), ('workshop', 'ورشة عمل'), ('seminar', 'ندوة'), ('conference', 'مؤتمر')], default='optional', max_length=20, verbose_name='نوع الدورة')),
                ('delivery_method', models.CharField(choices=[('classroom', 'حضوري'), ('online', 'عن بعد'), ('blended', 'مدمج'), ('self_paced', 'ذاتي')], default='classroom', max_length=20, verbose_name='طريقة التدريب')),
                ('status', models.CharField(choices=[('draft', 'مسودة'), ('planned', 'مخطط'), ('open', 'مفتوح للتسجيل'), ('in_progress', 'قيد التنفيذ'), ('completed', 'مكتمل'), ('cancelled', 'ملغي')], default='draft', max_length=20, verbose_name='الحالة')),
                ('start_date', models.DateField(blank=True, null=True, verbose_name='تاريخ البداية')),
                ('end_date', models.DateField(blank=True, null=True, verbose_name='تاريخ النهاية')),
                ('duration_hours', models.PositiveIntegerField(default=0, verbose_name='المدة (ساعات)')),
                ('duration_days', models.PositiveIntegerField(default=0, verbose_name='المدة (أيام)')),
                ('location', models.CharField(blank=True, max_length=200, verbose_name='المكان')),
                ('max_participants', models.PositiveIntegerField(default=0, help_text='0 يعني بدون حد', verbose_name='الحد الأقصى للمشاركين')),
                ('min_participants', models.PositiveIntegerField(default=0, verbose_name='الحد الأدنى للمشاركين')),
                ('cost_per_participant', models.DecimalField(decimal_places=2, default=Decimal('0'), max_digits=10, verbose_name='التكلفة لكل مشارك')),
                ('total_budget', models.DecimalField(decimal_places=2, default=Decimal('0'), max_digits=12, verbose_name='الميزانية الكلية')),
                ('trainer_name', models.CharField(blank=True, max_length=200, verbose_name='اسم المدرب')),
                ('prerequisites', models.TextField(blank=True, verbose_name='المتطلبات السابقة')),
                ('materials', models.TextField(blank=True, verbose_name='المواد التدريبية')),
                ('certificate_issued', models.BooleanField(default=False, verbose_name='تصدر شهادة')),
                ('notes', models.TextField(blank=True, verbose_name='ملاحظات')),
                ('is_active', models.BooleanField(default=True, verbose_name='نشط')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('category', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='courses', to='hr.trainingcategory', verbose_name='الفئة')),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='training_courses', to='core.company', verbose_name='الشركة')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_courses', to=settings.AUTH_USER_MODEL, verbose_name='أنشئ بواسطة')),
                ('provider', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='courses', to='hr.trainingprovider', verbose_name='مزود التدريب')),
                ('target_departments', models.ManyToManyField(blank=True, related_name='targeted_courses', to='hr.department', verbose_name='الأقسام المستهدفة')),
                ('target_job_titles', models.ManyToManyField(blank=True, related_name='targeted_courses', to='hr.jobtitle', verbose_name='المسميات الوظيفية المستهدفة')),
                ('trainer_employee', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='courses_as_trainer', to='hr.employee', verbose_name='المدرب (موظف)')),
            ],
            options={
                'verbose_name': 'دورة تدريبية',
                'verbose_name_plural': 'الدورات التدريبية',
                'ordering': ['-start_date', 'name'],
                'unique_together': {('company', 'code')},
            },
        ),
        migrations.CreateModel(
            name='TrainingEnrollment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('status', models.CharField(choices=[('nominated', 'مرشح'), ('pending_approval', 'بانتظار الموافقة'), ('approved', 'موافق عليه'), ('enrolled', 'مسجل'), ('attending', 'يحضر'), ('completed', 'أكمل'), ('no_show', 'لم يحضر'), ('withdrawn', 'منسحب'), ('failed', 'لم ينجح')], default='nominated', max_length=20, verbose_name='الحالة')),
                ('approval_date', models.DateField(blank=True, null=True, verbose_name='تاريخ الموافقة')),
                ('enrollment_date', models.DateField(blank=True, null=True, verbose_name='تاريخ التسجيل')),
                ('completion_date', models.DateField(blank=True, null=True, verbose_name='تاريخ الإكمال')),
                ('attendance_percentage', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True, validators=[django.core.validators.MinValueValidator(Decimal('0')), django.core.validators.MaxValueValidator(Decimal('100'))], verbose_name='نسبة الحضور %')),
                ('score', models.DecimalField(blank=True, decimal_places=2, max_digits=5, null=True, verbose_name='الدرجة')),
                ('grade', models.CharField(blank=True, max_length=20, verbose_name='التقدير')),
                ('certificate_number', models.CharField(blank=True, max_length=50, verbose_name='رقم الشهادة')),
                ('certificate_date', models.DateField(blank=True, null=True, verbose_name='تاريخ الشهادة')),
                ('actual_cost', models.DecimalField(decimal_places=2, default=Decimal('0'), max_digits=10, verbose_name='التكلفة الفعلية')),
                ('notes', models.TextField(blank=True, verbose_name='ملاحظات')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='training_approvals', to=settings.AUTH_USER_MODEL, verbose_name='وافق عليه')),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='training_enrollments', to='core.company', verbose_name='الشركة')),
                ('course', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='enrollments', to='hr.trainingcourse', verbose_name='الدورة')),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='training_enrollments', to='hr.employee', verbose_name='الموظف')),
                ('nominated_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='nominations_made', to='hr.employee', verbose_name='رشح بواسطة')),
            ],
            options={
                'verbose_name': 'تسجيل تدريب',
                'verbose_name_plural': 'تسجيلات التدريب',
                'ordering': ['-created_at'],
                'unique_together': {('course', 'employee')},
            },
        ),
        migrations.CreateModel(
            name='TrainingFeedback',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('content_rating', models.PositiveIntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(5)], verbose_name='تقييم المحتوى')),
                ('trainer_rating', models.PositiveIntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(5)], verbose_name='تقييم المدرب')),
                ('materials_rating', models.PositiveIntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(5)], verbose_name='تقييم المواد التدريبية')),
                ('organization_rating', models.PositiveIntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(5)], verbose_name='تقييم التنظيم')),
                ('relevance_rating', models.PositiveIntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(5)], verbose_name='مدى ارتباطه بالعمل')),
                ('overall_rating', models.PositiveIntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(5)], verbose_name='التقييم العام')),
                ('strengths', models.TextField(blank=True, verbose_name='نقاط القوة')),
                ('improvements', models.TextField(blank=True, verbose_name='مقترحات التحسين')),
                ('knowledge_gained', models.TextField(blank=True, verbose_name='المعرفة المكتسبة')),
                ('application_plan', models.TextField(blank=True, help_text='كيف ستطبق ما تعلمته في عملك', verbose_name='خطة التطبيق')),
                ('would_recommend', models.BooleanField(default=True, verbose_name='هل توصي بالدورة للآخرين')),
                ('additional_comments', models.TextField(blank=True, verbose_name='تعليقات إضافية')),
                ('submitted_at', models.DateTimeField(auto_now_add=True)),
                ('enrollment', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='feedback', to='hr.trainingenrollment', verbose_name='التسجيل')),
            ],
            options={
                'verbose_name': 'تقييم تدريب',
                'verbose_name_plural': 'تقييمات التدريب',
                'ordering': ['-submitted_at'],
            },
        ),
        migrations.CreateModel(
            name='TrainingPlan',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=200, verbose_name='اسم الخطة')),
                ('year', models.PositiveIntegerField(verbose_name='السنة')),
                ('status', models.CharField(choices=[('draft', 'مسودة'), ('pending_approval', 'بانتظار الموافقة'), ('approved', 'معتمدة'), ('in_progress', 'قيد التنفيذ'), ('completed', 'مكتملة'), ('cancelled', 'ملغاة')], default='draft', max_length=20, verbose_name='الحالة')),
                ('total_budget', models.DecimalField(decimal_places=2, default=Decimal('0'), max_digits=12, verbose_name='الميزانية الإجمالية')),
                ('allocated_budget', models.DecimalField(decimal_places=2, default=Decimal('0'), max_digits=12, verbose_name='الميزانية المخصصة')),
                ('spent_budget', models.DecimalField(decimal_places=2, default=Decimal('0'), max_digits=12, verbose_name='الميزانية المصروفة')),
                ('objectives', models.TextField(blank=True, verbose_name='أهداف الخطة')),
                ('notes', models.TextField(blank=True, verbose_name='ملاحظات')),
                ('approved_date', models.DateField(blank=True, null=True, verbose_name='تاريخ الاعتماد')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_training_plans', to=settings.AUTH_USER_MODEL, verbose_name='اعتمد بواسطة')),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='training_plans', to='core.company', verbose_name='الشركة')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_training_plans', to=settings.AUTH_USER_MODEL, verbose_name='أنشئ بواسطة')),
                ('department', models.ForeignKey(blank=True, help_text='اتركه فارغاً للخطة على مستوى الشركة', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='training_plans', to='hr.department', verbose_name='القسم')),
            ],
            options={
                'verbose_name': 'خطة تدريب',
                'verbose_name_plural': 'خطط التدريب',
                'ordering': ['-year', 'name'],
                'unique_together': {('company', 'year', 'department')},
            },
        ),
        migrations.CreateModel(
            name='TrainingPlanItem',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('custom_course_name', models.CharField(blank=True, max_length=200, verbose_name='اسم الدورة (إذا غير موجودة)')),
                ('target_employees_count', models.PositiveIntegerField(default=0, verbose_name='عدد الموظفين المستهدفين')),
                ('priority', models.CharField(choices=[('low', 'منخفضة'), ('medium', 'متوسطة'), ('high', 'عالية'), ('critical', 'حرجة')], default='medium', max_length=20, verbose_name='الأولوية')),
                ('planned_quarter', models.PositiveIntegerField(blank=True, choices=[(1, 'الربع الأول'), (2, 'الربع الثاني'), (3, 'الربع الثالث'), (4, 'الربع الرابع')], null=True, verbose_name='الربع المخطط')),
                ('planned_budget', models.DecimalField(decimal_places=2, default=Decimal('0'), max_digits=10, verbose_name='الميزانية المخططة')),
                ('actual_budget', models.DecimalField(decimal_places=2, default=Decimal('0'), max_digits=10, verbose_name='التكلفة الفعلية')),
                ('is_completed', models.BooleanField(default=False, verbose_name='مكتمل')),
                ('notes', models.TextField(blank=True, verbose_name='ملاحظات')),
                ('category', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='plan_items', to='hr.trainingcategory', verbose_name='الفئة')),
                ('course', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='plan_items', to='hr.trainingcourse', verbose_name='الدورة')),
                ('plan', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='items', to='hr.trainingplan', verbose_name='الخطة')),
                ('target_departments', models.ManyToManyField(blank=True, related_name='plan_items', to='hr.department', verbose_name='الأقسام المستهدفة')),
            ],
            options={
                'verbose_name': 'بند خطة تدريب',
                'verbose_name_plural': 'بنود خطط التدريب',
                'ordering': ['planned_quarter', '-priority'],
            },
        ),
        migrations.CreateModel(
            name='TrainingRequest',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('request_type', models.CharField(choices=[('self', 'طلب ذاتي'), ('manager', 'ترشيح من المدير'), ('hr', 'من الموارد البشرية')], default='self', max_length=20, verbose_name='نوع الطلب')),
                ('status', models.CharField(choices=[('draft', 'مسودة'), ('pending', 'قيد الانتظار'), ('manager_approved', 'موافقة المدير'), ('hr_approved', 'موافقة الموارد البشرية'), ('approved', 'معتمد'), ('rejected', 'مرفوض'), ('scheduled', 'تم الجدولة'), ('completed', 'مكتمل')], default='draft', max_length=20, verbose_name='الحالة')),
                ('custom_course_name', models.CharField(blank=True, max_length=200, verbose_name='اسم الدورة (إذا غير موجودة)')),
                ('justification', models.TextField(help_text='لماذا تحتاج هذا التدريب', verbose_name='مبررات الطلب')),
                ('expected_benefits', models.TextField(blank=True, verbose_name='الفوائد المتوقعة')),
                ('preferred_date_from', models.DateField(blank=True, null=True, verbose_name='التاريخ المفضل من')),
                ('preferred_date_to', models.DateField(blank=True, null=True, verbose_name='التاريخ المفضل إلى')),
                ('estimated_cost', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True, verbose_name='التكلفة التقديرية')),
                ('manager_comments', models.TextField(blank=True, verbose_name='ملاحظات المدير')),
                ('hr_comments', models.TextField(blank=True, verbose_name='ملاحظات الموارد البشرية')),
                ('manager_approved_date', models.DateField(blank=True, null=True, verbose_name='تاريخ موافقة المدير')),
                ('hr_approved_date', models.DateField(blank=True, null=True, verbose_name='تاريخ موافقة HR')),
                ('rejection_reason', models.TextField(blank=True, verbose_name='سبب الرفض')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('company', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='training_requests', to='core.company', verbose_name='الشركة')),
                ('course', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='requests', to='hr.trainingcourse', verbose_name='الدورة المطلوبة')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_training_requests', to=settings.AUTH_USER_MODEL, verbose_name='أنشئ بواسطة')),
                ('employee', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='training_requests', to='hr.employee', verbose_name='الموظف')),
                ('hr_approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='training_hr_approvals', to=settings.AUTH_USER_MODEL, verbose_name='موافقة HR')),
                ('manager_approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='training_manager_approvals', to=settings.AUTH_USER_MODEL, verbose_name='موافقة المدير')),
                ('training_category', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='requests', to='hr.trainingcategory', verbose_name='فئة التدريب')),
            ],
            options={
                'verbose_name': 'طلب تدريب',
                'verbose_name_plural': 'طلبات التدريب',
                'ordering': ['-created_at'],
            },
        ),
    ]
