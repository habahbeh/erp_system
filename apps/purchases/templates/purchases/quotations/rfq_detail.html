{% extends 'base/base.html' %}
{% load i18n static %}

{% block title %}{{ title }}{% endblock %}

{% block extra_css %}
<style>
/* Screen Styles */
.info-card {
    border-right: 4px solid #0d6efd;
}

.table-section {
    margin-top: 1.5rem;
}

.action-button {
    margin: 0 0.25rem;
}

.status-badge-lg {
    font-size: 1rem;
    padding: 0.5rem 1rem;
}

.info-label {
    font-size: 0.85rem;
    color: #6c757d;
    margin-bottom: 0.25rem;
}

.info-value {
    font-weight: 600;
    color: #212529;
}

.supplier-card {
    border: 1px solid #dee2e6;
    border-radius: 0.5rem;
    padding: 1rem;
    margin-bottom: 0.75rem;
    background: #f8f9fa;
}

.supplier-card:hover {
    background: #fff;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

/* Hide print document on screen */
.print-document {
    display: none;
}

/* Print Styles */
@media print {
    /* Hide everything except print document */
    body * {
        visibility: hidden;
    }

    .print-document,
    .print-document * {
        visibility: visible;
    }

    .print-document {
        display: block !important;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        background: white;
        padding: 0;
        margin: 0;
    }

    .no-print {
        display: none !important;
    }

    /* Page setup */
    @page {
        size: A4;
        margin: 15mm 10mm;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
        font-size: 11pt;
        line-height: 1.4;
        color: #333;
        direction: rtl;
    }

    /* Document header */
    .doc-header {
        border-bottom: 3px solid #1a5276;
        padding-bottom: 15px;
        margin-bottom: 20px;
    }

    .company-logo {
        max-height: 80px;
        max-width: 200px;
    }

    .company-info {
        text-align: left;
        font-size: 9pt;
        color: #555;
    }

    .doc-title {
        text-align: center;
        background: linear-gradient(135deg, #1a5276 0%, #2980b9 100%);
        color: white;
        padding: 12px 20px;
        margin: 15px 0;
        font-size: 18pt;
        font-weight: bold;
        border-radius: 5px;
    }

    .doc-number {
        text-align: center;
        font-size: 14pt;
        color: #1a5276;
        margin-bottom: 15px;
    }

    /* Info boxes */
    .info-box {
        border: 1px solid #ddd;
        border-radius: 5px;
        padding: 10px;
        margin-bottom: 15px;
        background: #f9f9f9;
    }

    .info-box-title {
        font-weight: bold;
        color: #1a5276;
        border-bottom: 1px solid #ddd;
        padding-bottom: 5px;
        margin-bottom: 8px;
        font-size: 11pt;
    }

    .info-row {
        display: flex;
        margin-bottom: 5px;
    }

    .info-label-print {
        font-weight: bold;
        color: #555;
        min-width: 120px;
    }

    .info-value-print {
        color: #333;
    }

    /* Tables */
    .print-table {
        width: 100%;
        border-collapse: collapse;
        margin: 15px 0;
        font-size: 10pt;
    }

    .print-table th {
        background: #1a5276;
        color: white;
        padding: 10px 8px;
        text-align: center;
        font-weight: bold;
        border: 1px solid #1a5276;
    }

    .print-table td {
        padding: 8px;
        border: 1px solid #ddd;
        vertical-align: middle;
    }

    .print-table tbody tr:nth-child(even) {
        background: #f9f9f9;
    }

    .print-table tfoot {
        background: #e8e8e8;
        font-weight: bold;
    }

    .print-table tfoot td {
        border-top: 2px solid #1a5276;
    }

    /* Price input column for supplier */
    .price-input-cell {
        background: #fffef0 !important;
        border: 2px solid #f39c12 !important;
        min-width: 100px;
    }

    /* Terms section */
    .terms-section {
        margin-top: 20px;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background: #fafafa;
        page-break-inside: avoid;
    }

    .terms-title {
        font-weight: bold;
        color: #1a5276;
        font-size: 12pt;
        margin-bottom: 10px;
        border-bottom: 1px solid #1a5276;
        padding-bottom: 5px;
    }

    .terms-list {
        margin: 0;
        padding-right: 20px;
    }

    .terms-list li {
        margin-bottom: 5px;
    }

    /* Supplier response section */
    .response-section {
        margin-top: 25px;
        padding: 15px;
        border: 2px dashed #2980b9;
        border-radius: 5px;
        background: #f0f8ff;
        page-break-inside: avoid;
    }

    .response-title {
        font-weight: bold;
        color: #1a5276;
        font-size: 12pt;
        text-align: center;
        margin-bottom: 15px;
    }

    .response-field {
        display: flex;
        margin-bottom: 12px;
        align-items: center;
    }

    .response-label {
        font-weight: bold;
        min-width: 150px;
    }

    .response-line {
        flex: 1;
        border-bottom: 1px solid #999;
        margin-right: 10px;
        min-height: 20px;
    }

    /* Signatures */
    .signatures-section {
        margin-top: 40px;
        page-break-inside: avoid;
    }

    .signature-row {
        display: flex;
        justify-content: space-between;
        margin-top: 60px;
    }

    .signature-box {
        text-align: center;
        width: 30%;
    }

    .signature-line-print {
        border-top: 1px solid #333;
        padding-top: 8px;
        margin-top: 40px;
        font-weight: bold;
        font-size: 10pt;
    }

    /* Footer */
    .doc-footer {
        margin-top: 30px;
        padding-top: 15px;
        border-top: 2px solid #1a5276;
        text-align: center;
        font-size: 9pt;
        color: #666;
    }

    .doc-footer-contact {
        margin-top: 5px;
    }

    /* Important notice */
    .important-notice {
        background: #fff3cd;
        border: 1px solid #ffc107;
        border-radius: 5px;
        padding: 10px;
        margin: 15px 0;
        font-size: 10pt;
    }

    .important-notice strong {
        color: #856404;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Screen View (hidden when printing) -->
    <div class="no-print">
        <!-- Breadcrumbs -->
        <nav aria-label="breadcrumb" class="mb-3">
            <ol class="breadcrumb">
                {% for breadcrumb in breadcrumbs %}
                    {% if forloop.last %}
                        <li class="breadcrumb-item active">{{ breadcrumb.title }}</li>
                    {% else %}
                        <li class="breadcrumb-item">
                            <a href="{{ breadcrumb.url }}">{{ breadcrumb.title }}</a>
                        </li>
                    {% endif %}
                {% endfor %}
            </ol>
        </nav>

        <!-- Header -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="h3 mb-1">{{ title }}</h1>
                <p class="text-muted mb-0">{% trans "تفاصيل طلب عرض السعر" %}</p>
            </div>
            <div>
                <!-- Print Button -->
                <button onclick="window.print()" class="btn btn-primary action-button">
                    <i class="fas fa-print"></i> {% trans "طباعة للإرسال للمورد" %}
                </button>

                {% if rfq.status == 'draft' %}
                    <a href="{% url 'purchases:send_rfq_to_suppliers' rfq.pk %}" class="btn btn-success action-button">
                        <i class="fas fa-paper-plane"></i> {% trans "إرسال للموردين" %}
                    </a>
                    <a href="{% url 'purchases:rfq_update' rfq.pk %}" class="btn btn-warning action-button">
                        <i class="fas fa-edit"></i> {% trans "تعديل" %}
                    </a>
                    <a href="{% url 'purchases:rfq_delete' rfq.pk %}" class="btn btn-danger action-button">
                        <i class="fas fa-trash"></i> {% trans "حذف" %}
                    </a>
                {% elif rfq.status == 'sent' %}
                    <a href="{% url 'purchases:mark_rfq_as_evaluating' rfq.pk %}" class="btn btn-primary action-button">
                        <i class="fas fa-clipboard-check"></i> {% trans "البدء بالتقييم" %}
                    </a>
                    <a href="{% url 'purchases:cancel_rfq' rfq.pk %}" class="btn btn-danger action-button">
                        <i class="fas fa-ban"></i> {% trans "إلغاء" %}
                    </a>
                {% elif rfq.status == 'evaluating' %}
                    <a href="{% url 'purchases:quotation_list' %}?rfq={{ rfq.id }}" class="btn btn-info action-button">
                        <i class="fas fa-file-invoice"></i> {% trans "عرض العروض المستلمة" %}
                    </a>
                {% endif %}
                <a href="{% url 'purchases:rfq_list' %}" class="btn btn-secondary action-button">
                    <i class="fas fa-arrow-right"></i> {% trans "رجوع" %}
                </a>
            </div>
        </div>

        <!-- RFQ Information Card -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card info-card shadow-sm">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">
                            <i class="fas fa-info-circle"></i> {% trans "معلومات طلب عرض السعر" %}
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-3 col-6">
                                <div class="mb-3">
                                    <div class="info-label">{% trans "رقم الطلب" %}</div>
                                    <div class="info-value text-primary">{{ rfq.number }}</div>
                                </div>
                            </div>
                            <div class="col-md-3 col-6">
                                <div class="mb-3">
                                    <div class="info-label">{% trans "التاريخ" %}</div>
                                    <div class="info-value">{{ rfq.date|date:"Y-m-d" }}</div>
                                </div>
                            </div>
                            <div class="col-md-3 col-6">
                                <div class="mb-3">
                                    <div class="info-label">{% trans "آخر موعد لتقديم العروض" %}</div>
                                    <div class="info-value">
                                        {% if rfq.submission_deadline %}
                                            <span class="text-danger">{{ rfq.submission_deadline|date:"Y-m-d" }}</span>
                                        {% else %}
                                            <span class="text-muted">-</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 col-6">
                                <div class="mb-3">
                                    <div class="info-label">{% trans "الحالة" %}</div>
                                    <div>
                                        {% if rfq.status == 'draft' %}
                                            <span class="badge status-badge-lg bg-secondary">{% trans "مسودة" %}</span>
                                        {% elif rfq.status == 'sent' %}
                                            <span class="badge status-badge-lg bg-info">{% trans "مرسل" %}</span>
                                        {% elif rfq.status == 'receiving' %}
                                            <span class="badge status-badge-lg bg-primary">{% trans "استقبال عروض" %}</span>
                                        {% elif rfq.status == 'evaluating' %}
                                            <span class="badge status-badge-lg bg-warning text-dark">{% trans "قيد التقييم" %}</span>
                                        {% elif rfq.status == 'awarded' %}
                                            <span class="badge status-badge-lg bg-success">{% trans "تم الترسية" %}</span>
                                        {% elif rfq.status == 'cancelled' %}
                                            <span class="badge status-badge-lg bg-danger">{% trans "ملغي" %}</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-3 col-6">
                                <div class="mb-3">
                                    <div class="info-label">{% trans "تاريخ التسليم المطلوب" %}</div>
                                    <div class="info-value">
                                        {% if rfq.required_delivery_date %}
                                            {{ rfq.required_delivery_date|date:"Y-m-d" }}
                                        {% else %}
                                            <span class="text-muted">-</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 col-6">
                                <div class="mb-3">
                                    <div class="info-label">{% trans "العملة" %}</div>
                                    <div class="info-value">{{ rfq.currency.name|default:"-" }}</div>
                                </div>
                            </div>
                            <div class="col-md-3 col-6">
                                <div class="mb-3">
                                    <div class="info-label">{% trans "طلب الشراء المرتبط" %}</div>
                                    <div class="info-value">
                                        {% if rfq.purchase_request %}
                                            <a href="{% url 'purchases:request_detail' rfq.purchase_request.pk %}">
                                                {{ rfq.purchase_request.number }}
                                            </a>
                                        {% else %}
                                            <span class="text-muted">-</span>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 col-6">
                                <div class="mb-3">
                                    <div class="info-label">{% trans "أنشئ بواسطة" %}</div>
                                    <div class="info-value">{{ rfq.created_by.get_full_name|default:rfq.created_by.username }}</div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-12">
                                <div class="mb-3">
                                    <div class="info-label">{% trans "الموضوع" %}</div>
                                    <div class="info-value fs-5">{{ rfq.subject }}</div>
                                </div>
                            </div>
                        </div>

                        {% if rfq.description %}
                        <div class="row">
                            <div class="col-md-12">
                                <div class="mb-3">
                                    <div class="info-label">{% trans "الوصف" %}</div>
                                    <p class="mb-0">{{ rfq.description|linebreaks }}</p>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        {% if rfq.payment_terms %}
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <div class="info-label">{% trans "شروط الدفع" %}</div>
                                    <p class="mb-0">{{ rfq.payment_terms|linebreaks }}</p>
                                </div>
                            </div>
                        {% endif %}
                        {% if rfq.delivery_terms %}
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <div class="info-label">{% trans "شروط التسليم" %}</div>
                                    <p class="mb-0">{{ rfq.delivery_terms|linebreaks }}</p>
                                </div>
                            </div>
                        </div>
                        {% elif rfq.payment_terms %}
                        </div>
                        {% endif %}

                        {% if rfq.warranty_required %}
                        <div class="row">
                            <div class="col-md-12">
                                <div class="mb-0">
                                    <div class="info-label">{% trans "متطلبات الضمان" %}</div>
                                    <p class="mb-0">
                                        <i class="fas fa-shield-alt text-success me-1"></i>
                                        {% trans "مطلوب ضمان" %}
                                        {% if rfq.warranty_period_months %}
                                            - {{ rfq.warranty_period_months }} {% trans "شهر" %}
                                        {% endif %}
                                    </p>
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        {% if rfq.notes %}
                        <div class="row mt-3">
                            <div class="col-md-12">
                                <div class="mb-0">
                                    <div class="info-label">{% trans "ملاحظات" %}</div>
                                    <p class="mb-0 text-muted">{{ rfq.notes|linebreaks }}</p>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Suppliers Section -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-users"></i> {% trans "الموردين المستهدفين" %}
                            <span class="badge bg-primary ms-2">{{ rfq.quotations.count }}</span>
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered table-hover align-middle mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th style="width: 50px;">#</th>
                                        <th>{% trans "اسم المورد" %}</th>
                                        <th>{% trans "البريد الإلكتروني" %}</th>
                                        <th>{% trans "الهاتف" %}</th>
                                        <th>{% trans "المدينة" %}</th>
                                        <th class="text-center">{% trans "حالة العرض" %}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for quotation in rfq.quotations.all %}
                                    <tr>
                                        <td class="text-center">{{ forloop.counter }}</td>
                                        <td>
                                            <strong>{{ quotation.supplier.name }}</strong>
                                            {% if quotation.supplier.code %}
                                                <br><small class="text-muted">{{ quotation.supplier.code }}</small>
                                            {% endif %}
                                        </td>
                                        <td>{{ quotation.supplier.email|default:"-" }}</td>
                                        <td>{{ quotation.supplier.phone|default:"-" }}</td>
                                        <td>{{ quotation.supplier.city|default:"-" }}</td>
                                        <td class="text-center">
                                            {% if quotation.status == 'draft' %}
                                                <span class="badge bg-secondary">{% trans "مسودة" %}</span>
                                            {% elif quotation.status == 'sent' %}
                                                <span class="badge bg-info">{% trans "مرسل" %}</span>
                                            {% elif quotation.status == 'received' %}
                                                <span class="badge bg-success">{% trans "تم الاستلام" %}</span>
                                            {% elif quotation.status == 'awarded' %}
                                                <span class="badge bg-primary">{% trans "فائز" %}</span>
                                            {% elif quotation.status == 'rejected' %}
                                                <span class="badge bg-danger">{% trans "مرفوض" %}</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="6" class="text-center text-muted py-4">
                                            <i class="fas fa-users fa-2x mb-2 d-block"></i>
                                            {% trans "لم يتم تحديد موردين بعد" %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Items Section -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card shadow-sm">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-boxes"></i> {% trans "الأصناف المطلوبة" %}
                            <span class="badge bg-primary ms-2">{{ rfq.items.count }}</span>
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered table-hover align-middle mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th style="width: 50px;">#</th>
                                        <th>{% trans "الصنف" %}</th>
                                        <th>{% trans "الوصف" %}</th>
                                        <th>{% trans "المواصفات" %}</th>
                                        <th class="text-end" style="width: 120px;">{% trans "الكمية" %}</th>
                                        <th style="width: 100px;">{% trans "الوحدة" %}</th>
                                        <th class="text-end" style="width: 130px;">{% trans "السعر التقديري" %}</th>
                                        <th class="text-end" style="width: 130px;">{% trans "الإجمالي" %}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for item in rfq.items.all %}
                                    <tr>
                                        <td class="text-center">{{ forloop.counter }}</td>
                                        <td>
                                            {% if item.item %}
                                                <strong>{{ item.item.name }}</strong>
                                                {% if item.item.code %}
                                                    <br><small class="text-muted">{{ item.item.code }}</small>
                                                {% endif %}
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td>{{ item.item_description|default:"-"|linebreaksbr }}</td>
                                        <td>{{ item.specifications|default:"-"|linebreaksbr }}</td>
                                        <td class="text-end fw-bold">{{ item.quantity|floatformat:3 }}</td>
                                        <td>
                                            {% if item.unit %}
                                                {{ item.unit }}
                                            {% elif item.item and item.item.base_uom %}
                                                {{ item.item.base_uom.name }}
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td class="text-end">
                                            {% if item.estimated_price %}
                                                {{ item.estimated_price|floatformat:3 }}
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                        <td class="text-end">
                                            {% if item.line_total %}
                                                {{ item.line_total|floatformat:3 }}
                                            {% else %}
                                                <span class="text-muted">-</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% if item.notes %}
                                    <tr class="table-light">
                                        <td></td>
                                        <td colspan="7">
                                            <small class="text-muted">
                                                <i class="fas fa-sticky-note me-1"></i>
                                                {{ item.notes }}
                                            </small>
                                        </td>
                                    </tr>
                                    {% endif %}
                                    {% empty %}
                                    <tr>
                                        <td colspan="8" class="text-center text-muted py-4">
                                            <i class="fas fa-boxes fa-2x mb-2 d-block"></i>
                                            {% trans "لا توجد أصناف" %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                                {% if rfq.items.exists %}
                                <tfoot class="table-light">
                                    <tr>
                                        <td colspan="7" class="text-start fw-bold">{% trans "الإجمالي التقديري" %}</td>
                                        <td class="text-end fw-bold">
                                            {{ estimated_total|floatformat:3 }}
                                            {% if rfq.currency %}
                                                <small class="text-muted">{{ rfq.currency.code }}</small>
                                            {% endif %}
                                        </td>
                                    </tr>
                                </tfoot>
                                {% endif %}
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ======================= PRINT DOCUMENT ======================= -->
    <div class="print-document">
        <!-- Document Header with Company Logo -->
        <div class="doc-header">
            <table style="width: 100%;">
                <tr>
                    <td style="width: 30%; text-align: right; vertical-align: top;">
                        {% if request.current_company.logo %}
                            <img src="{{ request.current_company.logo.url }}" alt="Logo" class="company-logo">
                        {% else %}
                            <div style="font-size: 24pt; font-weight: bold; color: #1a5276;">
                                {{ request.current_company.name }}
                            </div>
                        {% endif %}
                    </td>
                    <td style="width: 40%; text-align: center; vertical-align: middle;">
                        <div style="font-size: 14pt; font-weight: bold; color: #1a5276;">
                            {{ request.current_company.name }}
                        </div>
                        {% if request.current_company.name_en %}
                        <div style="font-size: 11pt; color: #666;">
                            {{ request.current_company.name_en }}
                        </div>
                        {% endif %}
                    </td>
                    <td style="width: 30%; text-align: left; vertical-align: top;" class="company-info">
                        {% if request.current_company.address %}
                            <div>{{ request.current_company.address }}</div>
                        {% endif %}
                        {% if request.current_company.phone %}
                            <div>{% trans "هاتف" %}: {{ request.current_company.phone }}</div>
                        {% endif %}
                        {% if request.current_company.email %}
                            <div>{{ request.current_company.email }}</div>
                        {% endif %}
                        {% if request.current_company.website %}
                            <div>{{ request.current_company.website }}</div>
                        {% endif %}
                        {% if request.current_company.tax_number %}
                            <div>{% trans "الرقم الضريبي" %}: {{ request.current_company.tax_number }}</div>
                        {% endif %}
                    </td>
                </tr>
            </table>
        </div>

        <!-- Document Title -->
        <div class="doc-title">
            {% trans "طلب عرض أسعار" %}
            <br>
            <span style="font-size: 12pt;">Request for Quotation (RFQ)</span>
        </div>

        <!-- Document Number -->
        <div class="doc-number">
            {% trans "رقم الطلب" %}: <strong>{{ rfq.number }}</strong>
        </div>

        <!-- RFQ Info Section -->
        <table style="width: 100%; margin-bottom: 15px;">
            <tr>
                <td style="width: 50%; vertical-align: top; padding-left: 10px;">
                    <div class="info-box">
                        <div class="info-box-title">{% trans "معلومات الطلب" %}</div>
                        <div class="info-row">
                            <span class="info-label-print">{% trans "التاريخ" %}:</span>
                            <span class="info-value-print">{{ rfq.date|date:"Y-m-d" }}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label-print">{% trans "آخر موعد للتقديم" %}:</span>
                            <span class="info-value-print" style="color: #c0392b; font-weight: bold;">
                                {% if rfq.submission_deadline %}
                                    {{ rfq.submission_deadline|date:"Y-m-d" }}
                                {% else %}
                                    -
                                {% endif %}
                            </span>
                        </div>
                        <div class="info-row">
                            <span class="info-label-print">{% trans "تاريخ التسليم المطلوب" %}:</span>
                            <span class="info-value-print">
                                {% if rfq.required_delivery_date %}
                                    {{ rfq.required_delivery_date|date:"Y-m-d" }}
                                {% else %}
                                    -
                                {% endif %}
                            </span>
                        </div>
                        <div class="info-row">
                            <span class="info-label-print">{% trans "العملة" %}:</span>
                            <span class="info-value-print">{{ rfq.currency.name|default:"-" }}</span>
                        </div>
                    </div>
                </td>
                <td style="width: 50%; vertical-align: top; padding-right: 10px;">
                    <div class="info-box">
                        <div class="info-box-title">{% trans "الموضوع" %}</div>
                        <div style="font-weight: bold; font-size: 12pt; color: #333;">
                            {{ rfq.subject }}
                        </div>
                        {% if rfq.description %}
                        <div style="margin-top: 8px; font-size: 10pt; color: #555;">
                            {{ rfq.description|truncatewords:50 }}
                        </div>
                        {% endif %}
                    </div>
                </td>
            </tr>
        </table>

        <!-- Important Notice -->
        <div class="important-notice">
            <strong>{% trans "تنبيه هام" %}:</strong>
            {% trans "يرجى تعبئة الأسعار في العمود المخصص وإعادة العرض قبل تاريخ" %}
            <strong>
                {% if rfq.submission_deadline %}
                    {{ rfq.submission_deadline|date:"Y-m-d" }}
                {% else %}
                    ({% trans "غير محدد" %})
                {% endif %}
            </strong>
        </div>

        <!-- Items Table -->
        <table class="print-table">
            <thead>
                <tr>
                    <th style="width: 35px;">#</th>
                    <th style="width: 20%;">{% trans "الصنف / البند" %}</th>
                    <th>{% trans "الوصف والمواصفات" %}</th>
                    <th style="width: 70px;">{% trans "الكمية" %}</th>
                    <th style="width: 60px;">{% trans "الوحدة" %}</th>
                    <th style="width: 90px;" class="price-input-cell">{% trans "سعر الوحدة" %}</th>
                    <th style="width: 90px;" class="price-input-cell">{% trans "الإجمالي" %}</th>
                </tr>
            </thead>
            <tbody>
                {% for item in rfq.items.all %}
                <tr>
                    <td style="text-align: center;">{{ forloop.counter }}</td>
                    <td>
                        {% if item.item %}
                            <strong>{{ item.item.name }}</strong>
                            {% if item.item.code %}
                                <br><small>({{ item.item.code }})</small>
                            {% endif %}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        {{ item.item_description|default:"" }}
                        {% if item.specifications %}
                            <br><small style="color: #666;">{{ item.specifications }}</small>
                        {% endif %}
                        {% if item.notes %}
                            <br><small style="color: #888;"><em>{{ item.notes }}</em></small>
                        {% endif %}
                    </td>
                    <td style="text-align: center; font-weight: bold;">{{ item.quantity|floatformat:2 }}</td>
                    <td style="text-align: center;">
                        {% if item.unit %}
                            {{ item.unit }}
                        {% elif item.item and item.item.base_uom %}
                            {{ item.item.base_uom.name }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td class="price-input-cell" style="text-align: center;">
                        <!-- Space for supplier to fill -->
                    </td>
                    <td class="price-input-cell" style="text-align: center;">
                        <!-- Space for supplier to fill -->
                    </td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="5"></td>
                    <td style="text-align: left; font-weight: bold;">{% trans "المجموع الفرعي" %}:</td>
                    <td class="price-input-cell"></td>
                </tr>
                <tr>
                    <td colspan="5"></td>
                    <td style="text-align: left; font-weight: bold;">{% trans "الضريبة" %} (%):</td>
                    <td class="price-input-cell"></td>
                </tr>
                <tr>
                    <td colspan="5"></td>
                    <td style="text-align: left; font-weight: bold; font-size: 11pt;">{% trans "الإجمالي الكلي" %}:</td>
                    <td class="price-input-cell" style="font-weight: bold;"></td>
                </tr>
            </tfoot>
        </table>

        <!-- Terms Section -->
        <div class="terms-section">
            <div class="terms-title">{% trans "الشروط والأحكام" %}</div>
            <ul class="terms-list">
                {% if rfq.payment_terms %}
                    <li><strong>{% trans "شروط الدفع" %}:</strong> {{ rfq.payment_terms }}</li>
                {% endif %}
                {% if rfq.delivery_terms %}
                    <li><strong>{% trans "شروط التسليم" %}:</strong> {{ rfq.delivery_terms }}</li>
                {% endif %}
                {% if rfq.warranty_required %}
                    <li><strong>{% trans "الضمان" %}:</strong> {% trans "مطلوب ضمان" %}{% if rfq.warranty_period_months %} {{ rfq.warranty_period_months }} {% trans "شهر" %}{% endif %}</li>
                {% endif %}
                <li>{% trans "الأسعار شاملة جميع التكاليف والضرائب إلا إذا ذكر خلاف ذلك" %}</li>
                <li>{% trans "صلاحية العرض لا تقل عن 30 يوم من تاريخ التقديم" %}</li>
                <li>{% trans "يرجى إرفاق كتالوجات أو عينات إن وجدت" %}</li>
            </ul>
            {% if rfq.notes %}
            <div style="margin-top: 10px; padding-top: 10px; border-top: 1px dashed #ccc;">
                <strong>{% trans "ملاحظات إضافية" %}:</strong>
                <div style="color: #555; margin-top: 5px;">{{ rfq.notes }}</div>
            </div>
            {% endif %}
        </div>

        <!-- Supplier Response Section -->
        <div class="response-section">
            <div class="response-title">{% trans "بيانات المورد وتوقيع العرض" %}</div>
            <table style="width: 100%;">
                <tr>
                    <td style="width: 50%; padding-left: 15px;">
                        <div class="response-field">
                            <span class="response-label">{% trans "اسم الشركة" %}:</span>
                            <span class="response-line"></span>
                        </div>
                        <div class="response-field">
                            <span class="response-label">{% trans "اسم المسؤول" %}:</span>
                            <span class="response-line"></span>
                        </div>
                        <div class="response-field">
                            <span class="response-label">{% trans "رقم الهاتف" %}:</span>
                            <span class="response-line"></span>
                        </div>
                    </td>
                    <td style="width: 50%; padding-right: 15px;">
                        <div class="response-field">
                            <span class="response-label">{% trans "البريد الإلكتروني" %}:</span>
                            <span class="response-line"></span>
                        </div>
                        <div class="response-field">
                            <span class="response-label">{% trans "تاريخ العرض" %}:</span>
                            <span class="response-line"></span>
                        </div>
                        <div class="response-field">
                            <span class="response-label">{% trans "صلاحية العرض حتى" %}:</span>
                            <span class="response-line"></span>
                        </div>
                    </td>
                </tr>
            </table>
        </div>

        <!-- Signatures -->
        <div class="signatures-section">
            <div class="signature-row">
                <div class="signature-box">
                    <div class="signature-line-print">{% trans "توقيع المورد وختمه" %}</div>
                </div>
                <div class="signature-box">
                    <div class="signature-line-print">{% trans "توقيع مدير المشتريات" %}</div>
                </div>
                <div class="signature-box">
                    <div class="signature-line-print">{% trans "اعتماد الإدارة" %}</div>
                </div>
            </div>
        </div>

        <!-- Document Footer -->
        <div class="doc-footer">
            <div style="font-weight: bold; color: #1a5276;">{{ request.current_company.name }}</div>
            <div class="doc-footer-contact">
                {% if request.current_company.address %}{{ request.current_company.address }}{% endif %}
                {% if request.current_company.phone %} | {% trans "هاتف" %}: {{ request.current_company.phone }}{% endif %}
                {% if request.current_company.email %} | {{ request.current_company.email }}{% endif %}
            </div>
            <div style="margin-top: 8px; font-size: 8pt;">
                {% trans "تم الطباعة بتاريخ" %}: {% now "Y-m-d H:i" %} | {{ rfq.number }}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Confirmation for action buttons
    $('a[href*="delete"], a[href*="cancel"]').on('click', function(e) {
        if (!confirm('{% trans "هل أنت متأكد من تنفيذ هذا الإجراء؟" %}')) {
            e.preventDefault();
        }
    });
});
</script>
{% endblock %}
