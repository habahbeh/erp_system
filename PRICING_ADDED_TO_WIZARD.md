# ุชู ุฅุถุงูุฉ ูุณู ุงูุฃุณุนุงุฑ ุฅูู Wizard ุฅุถุงูุฉ ุงูููุงุฏ โ

**ุงูุชุงุฑูุฎ**: 2025-11-19
**ุงูุชุญุฏูุซ**: ุฅุถุงูุฉ ูุธุงู ุงูุฃุณุนุงุฑ ุงููุงูู ูู ุงูุฎุทูุฉ 3

---

## ๐ฏ ุงููุดููุฉ ุงูุฃุตููุฉ

ุจุนุฏ ุฅูุดุงุก ุงูู Wizardุ ูุงุญุธูุง ุฃู:
- โ **ูุณู ุงูุฃุณุนุงุฑ ููููุฏ** - ูุงู ูุฐููุฑุงู ูู ุงูุนููุงู ููุท
- โ ูุง ูููู ุฅุถุงูุฉ ุฃุณุนุงุฑ ููููุงุฏ ุงูุนุงุฏูุฉ
- โ ูุง ูููู ุฅุถุงูุฉ ุฃุณุนุงุฑ ูููุชุบูุฑุงุช

---

## โ ุงูุญู ุงููููุฐ

### 1. ุฅุถุงูุฉ ูุณู ุงูุฃุณุนุงุฑ ูู ุงูุฎุทูุฉ 3

**ุงูููู**: `apps/core/templates/core/items/item_form_wizard.html` (ุงูุณุทุฑ 689-750)

ุชู ุฅุถุงูุฉ ูุณููู ููุฃุณุนุงุฑ:

#### ุฃ. ุงูุฃุณุนุงุฑ ููููุงุฏ ุจุฏูู ูุชุบูุฑุงุช (`simplePricesSection`)
```html
<table class="table table-sm table-bordered">
    <thead>
        <tr>
            <th>ูุงุฆูุฉ ุงูุณุนุฑ</th>
            <th>ุงูุณุนุฑ</th>
        </tr>
    </thead>
    <tbody>
        {% for price_list in price_lists %}
        <tr>
            <td>{{ price_list.name }}</td>
            <td>
                <input type="number"
                       name="price_{{ price_list.id }}"
                       placeholder="0.00"
                       step="0.001">
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
```

#### ุจ. ุงูุฃุณุนุงุฑ ูููุชุบูุฑุงุช (`variantPricesSection`)
```html
<div id="variantPricesTables"></div>
```

ูุชู ููุก ูุฐุง ุงููุณู ุฏููุงููููุงู ุจุฌุฏุงูู ุงูุฃุณุนุงุฑ ููู ูุชุบูุฑ.

---

### 2. JavaScript ูุชุจุฏูู ุนุฑุถ ุงูุฃุณุนุงุฑ

**ุงูููู**: `apps/core/templates/core/items/item_form_wizard.html` (ุงูุณุทุฑ 966-988)

ุนูุฏ ุชูุนูู/ุฅูุบุงุก ุชูุนูู "ูู ูุชุบูุฑุงุช":
```javascript
hasVariantsCheckbox.addEventListener('change', function() {
    const simplePricesSection = document.getElementById('simplePricesSection');
    const variantPricesSection = document.getElementById('variantPricesSection');

    if (this.checked) {
        // ุฅุฎูุงุก ุงูุฃุณุนุงุฑ ุงูุจุณูุทุฉุ ุฅุธูุงุฑ ุฃุณุนุงุฑ ุงููุชุบูุฑุงุช
        simplePricesSection.style.display = 'none';
        variantPricesSection.style.display = 'block';
    } else {
        // ุฅุธูุงุฑ ุงูุฃุณุนุงุฑ ุงูุจุณูุทุฉุ ุฅุฎูุงุก ุฃุณุนุงุฑ ุงููุชุบูุฑุงุช
        simplePricesSection.style.display = 'block';
        variantPricesSection.style.display = 'none';
    }
});
```

---

### 3. ุฏุงูุฉ ุชูููุฏ ุฌุฏุงูู ุฃุณุนุงุฑ ุงููุชุบูุฑุงุช

**ุงูููู**: `apps/core/templates/core/items/item_form_wizard.html` (ุงูุณุทุฑ 1056-1122)

```javascript
function generateVariantPricesTables(variants) {
    const container = document.getElementById('variantPricesTables');
    const priceLists = {{ price_lists_json|safe }};

    // ููู ูุงุฆูุฉ ุฃุณุนุงุฑ
    priceLists.forEach(priceList => {
        // ุฅูุดุงุก ุฌุฏูู ูููุตู
        // ููู ูุชุบูุฑ
        variants.forEach((variant, index) => {
            // ุญูู ุฅุฏุฎุงู ุงูุณุนุฑ
            // ุงุณู ุงูุญูู: variant_price_{priceListId}_{variantIndex}
        });
    });
}
```

**ุชูุณุชุฏุนู ุชููุงุฆูุงู**: ุนูุฏ ุงูุงูุชูุงู ูู ุงูุฎุทูุฉ 2 โ ุงูุฎุทูุฉ 3 (ุงูุณุทุฑ 937-938)

---

### 4. ุชุนุฏูู View ูุฏุนู ุฃุณุนุงุฑ ุงููุชุบูุฑุงุช

**ุงูููู**: `apps/core/views/item_views.py` (ุงูุณุทุฑ 269-337 ู 622-690)

ุนุฏูููุง ุฏุงูุฉ `save_variant_prices` ูุฏุนู **ุชูุณูููู** ููุฃุณุนุงุฑ:

#### ุงูุชูุณูู ุงูุฃูู (ุฌุฏูุฏ): `variant_price_{price_list_id}_{variant_index}`
- ููุณุชุฎุฏู ุนูุฏ **ุฅุถุงูุฉ ูุงุฏุฉ ุฌุฏูุฏ** ุจูุชุบูุฑุงุช
- ุงููุชุบูุฑุงุช ูู ูุชู ุญูุธูุง ุจุนุฏุ ูููุณ ููุง IDs
- ูุณุชุฎุฏู index (ุงูุชุฑุชูุจ) ููุฑุจุท

```python
if key.startswith('variant_price_'):
    parts = key.split('_')
    price_list_id = int(parts[2])
    variant_index = int(parts[3])

    # ุงูุญุตูู ุนูู ุงููุชุบูุฑ ูู ุงููุงุฆูุฉ ุจุงูุชุฑุชูุจ
    if variant_index < len(variants):
        variant_obj = variants[variant_index]
```

#### ุงูุชูุณูู ุงูุซุงูู (ูุฏูู): `price_{price_list_id}_{variant_id}`
- ููุณุชุฎุฏู ุนูุฏ **ุชุนุฏูู ูุงุฏุฉ ููุฌูุฏ** ุจูุชุบูุฑุงุช
- ุงููุชุบูุฑุงุช ููุฌูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ูููุง IDs

```python
elif key.startswith('price_'):
    parts = key.split('_')
    price_list_id = int(parts[1])
    variant_id = int(parts[2])

    # ุงูุจุญุซ ุนู ุงููุชุบูุฑ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
    variant_obj = ItemVariant.objects.get(
        pk=variant_id,
        item=self.object
    )
```

---

## ๐ ููู ูุนูู ุงููุธุงูุ

### ุณููุงุฑูู 1: ุฅุถุงูุฉ ูุงุฏุฉ ุจุฏูู ูุชุบูุฑุงุช

1. **ุงูุฎุทูุฉ 1**: ุงููุณุชุฎุฏู ูุฏุฎู ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ
2. **ุงูุฎุทูุฉ 2**: ูุง ููุนูู "ูู ูุชุบูุฑุงุช"
3. **ุงูุฎุทูุฉ 3**:
   - โ ูุธูุฑ ุฌุฏูู ุงูุฃุณุนุงุฑ ุงูุจุณูุท
   - ูุฏุฎู ุงูุณุนุฑ ููู ูุงุฆูุฉ ุฃุณุนุงุฑ
   - ูุซุงู: `price_1` = 100.00
4. **ุงูุญูุธ**:
   - ูุชู ุฅูุดุงุก ุงููุงุฏุฉ
   - `save_item_prices()` ุชุญูุธ ุงูุฃุณุนุงุฑ

---

### ุณููุงุฑูู 2: ุฅุถุงูุฉ ูุงุฏุฉ ุจูุชุบูุฑุงุช

1. **ุงูุฎุทูุฉ 1**: ุงููุณุชุฎุฏู ูุฏุฎู ุงููุนูููุงุช ุงูุฃุณุงุณูุฉ
2. **ุงูุฎุทูุฉ 2**:
   - โ ููุนูู "ูู ูุชุบูุฑุงุช"
   - ูุฎุชุงุฑ ุงูุฎุตุงุฆุต ูุงูููู
   - ูุซุงู: ููู (ุฃุจูุถุ ุฃุณูุฏ) + ููุงุณ (ุตุบูุฑุ ูุจูุฑ)
   - ุงููุชูุฌุฉ: 4 ูุชุบูุฑุงุช (2 ร 2)
3. **ุงูุงูุชูุงู ุฅูู ุงูุฎุทูุฉ 3**:
   - `calculateVariants()` ููุญุณุจ ุงููุชุบูุฑุงุช
   - `generateVariantPricesTables()` ุชูููููุฏ ุฌุฏุงูู ุงูุฃุณุนุงุฑ
4. **ุงูุฎุทูุฉ 3**:
   - โ ูุธูุฑ ุฌุฏูู ุฃุณุนุงุฑ ููู ูุงุฆูุฉ ุณุนุฑ
   - ููู ูุชุบูุฑ ุญูู ูููุตู
   - ูุซุงู:
     - `variant_price_1_0` = 95.00 (ูุงุฆูุฉ VIPุ ุงููุชุบูุฑ 0)
     - `variant_price_1_1` = 95.00 (ูุงุฆูุฉ VIPุ ุงููุชุบูุฑ 1)
     - `variant_price_2_0` = 90.00 (ูุงุฆูุฉ ุงูุชุฌุฒุฆุฉุ ุงููุชุบูุฑ 0)
     - ...
5. **ุงูุญูุธ**:
   - ูุชู ุฅูุดุงุก ุงููุงุฏุฉ
   - `create_variants_from_json()` ุชููุดุฆ ุงููุชุบูุฑุงุช
   - `save_variant_prices()` ุชุญูุธ ุงูุฃุณุนุงุฑ
   - ูุฑุจุท ูู ุณุนุฑ ุจุงููุชุบูุฑ ุงูููุงุณุจ ุจุงูุชุฑุชูุจ

---

## ๐ฏ ูุซุงู ุนููู

### ูุฏุฎูุงุช:
- **ุงุณู ุงููุงุฏุฉ**: ูููุต ุฑุฌุงูู
- **ุงููุชุบูุฑุงุช**:
  - ุงูููู: ุฃุจูุถุ ุฃุณูุฏ
  - ุงูููุงุณ: Sุ Mุ L
  - **ุงููุชุบูุฑุงุช ุงููููุฏุฉ**: 6 ูุชุบูุฑุงุช (2 ร 3)
- **ููุงุฆู ุงูุฃุณุนุงุฑ**: VIPุ ุชุฌุฒุฆุฉ
- **ุงูุฃุณุนุงุฑ ุงููุฏุฎูุฉ**:
  - ูุงุฆูุฉ VIP:
    - ุฃุจูุถ-S: 100
    - ุฃุจูุถ-M: 100
    - ุฃุจูุถ-L: 105
    - ุฃุณูุฏ-S: 105
    - ุฃุณูุฏ-M: 105
    - ุฃุณูุฏ-L: 110
  - ูุงุฆูุฉ ุงูุชุฌุฒุฆุฉ:
    - ุฃุจูุถ-S: 95
    - ุฃุจูุถ-M: 95
    - ...

### ุญููู POST ุงููุฑุณูุฉ:
```
variant_price_1_0 = 100   # VIP - ุฃุจูุถ-S (index 0)
variant_price_1_1 = 100   # VIP - ุฃุจูุถ-M (index 1)
variant_price_1_2 = 105   # VIP - ุฃุจูุถ-L (index 2)
variant_price_1_3 = 105   # VIP - ุฃุณูุฏ-S (index 3)
variant_price_1_4 = 105   # VIP - ุฃุณูุฏ-M (index 4)
variant_price_1_5 = 110   # VIP - ุฃุณูุฏ-L (index 5)
variant_price_2_0 = 95    # ุชุฌุฒุฆุฉ - ุฃุจูุถ-S
variant_price_2_1 = 95    # ุชุฌุฒุฆุฉ - ุฃุจูุถ-M
...
```

### ุงููุชูุฌุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:

**ุฌุฏูู Item**:
- id: 1
- name: "ูููุต ุฑุฌุงูู"
- has_variants: true

**ุฌุฏูู ItemVariant**:
- id: 1, item_id: 1, code: "ITM000001-V001" (ุฃุจูุถ-S)
- id: 2, item_id: 1, code: "ITM000001-V002" (ุฃุจูุถ-M)
- id: 3, item_id: 1, code: "ITM000001-V003" (ุฃุจูุถ-L)
- id: 4, item_id: 1, code: "ITM000001-V004" (ุฃุณูุฏ-S)
- id: 5, item_id: 1, code: "ITM000001-V005" (ุฃุณูุฏ-M)
- id: 6, item_id: 1, code: "ITM000001-V006" (ุฃุณูุฏ-L)

**ุฌุฏูู PriceListItem**:
- price_list_id: 1 (VIP), item_id: 1, variant_id: 1, price: 100.00
- price_list_id: 1 (VIP), item_id: 1, variant_id: 2, price: 100.00
- price_list_id: 1 (VIP), item_id: 1, variant_id: 3, price: 105.00
- price_list_id: 1 (VIP), item_id: 1, variant_id: 4, price: 105.00
- price_list_id: 1 (VIP), item_id: 1, variant_id: 5, price: 105.00
- price_list_id: 1 (VIP), item_id: 1, variant_id: 6, price: 110.00
- price_list_id: 2 (ุชุฌุฒุฆุฉ), item_id: 1, variant_id: 1, price: 95.00
- ...

---

## ๐ ููุฎุต ุงูุชุบููุฑุงุช

### ุงููููุงุช ุงููุนุฏูุฉ:

1. **`apps/core/templates/core/items/item_form_wizard.html`**
   - ุงูุณุทุฑ 689-750: ุฅุถุงูุฉ ูุณู ุงูุฃุณุนุงุฑ
   - ุงูุณุทุฑ 966-988: JavaScript ูุชุจุฏูู ุงูุฃุณุนุงุฑ
   - ุงูุณุทุฑ 937-938: ุงุณุชุฏุนุงุก `generateVariantPricesTables()`
   - ุงูุณุทุฑ 1056-1122: ุฏุงูุฉ `generateVariantPricesTables()`

2. **`apps/core/views/item_views.py`**
   - ุงูุณุทุฑ 269-337: ุชุนุฏูู `save_variant_prices()` ูู `ItemCreateView`
   - ุงูุณุทุฑ 622-690: ุชุนุฏูู `save_variant_prices()` ูู `ItemUpdateView`

---

## โ ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ 1: ูุงุฏุฉ ุจุฏูู ูุชุบูุฑุงุช + ุฃุณุนุงุฑ

```
ุงูุฎุทูุฉ 1: ุงุณู: "ููุชุฌ ุงุฎุชุจุงุฑ 1"
ุงูุฎุทูุฉ 2: ุจุฏูู ูุชุบูุฑุงุช
ุงูุฎุทูุฉ 3: ุณุนุฑ VIP: 100.00
ุงูุฎุทูุฉ 4: ุญูุธ

โ ุงููุชูุฌุฉ ุงููุชููุนุฉ:
- ูุงุฏุฉ ุฌุฏูุฏ ุชู ุฅูุดุงุคูุง
- ุฑุณุงูุฉ: "ุชู ุฅุถุงูุฉ ุงููุงุฏุฉ ... ูุน 1 ุณุนุฑ ุจูุฌุงุญ"
- ุงูุณุนุฑ ูุญููุธ ูู PriceListItem
```

### ุงุฎุชุจุงุฑ 2: ูุงุฏุฉ ุจูุชุบูุฑุงุช + ุฃุณุนุงุฑ

```
ุงูุฎุทูุฉ 1: ุงุณู: "ูููุต ุงุฎุชุจุงุฑ"
ุงูุฎุทูุฉ 2:
  - โ ูู ูุชุบูุฑุงุช
  - ุงูููู: ุฃุจูุถุ ุฃุณูุฏ
  - ุงูููุงุณ: Sุ M
  - ุนุฏุฏ ุงููุชุบูุฑุงุช: 4
ุงูุฎุทูุฉ 3:
  - ุฌุฏูู VIP:
    - ุฃุจูุถ-S: 100
    - ุฃุจูุถ-M: 100
    - ุฃุณูุฏ-S: 105
    - ุฃุณูุฏ-M: 105
ุงูุฎุทูุฉ 4: ุญูุธ

โ ุงููุชูุฌุฉ ุงููุชููุนุฉ:
- ูุงุฏุฉ ุฌุฏูุฏ ุชู ุฅูุดุงุคูุง
- 4 ูุชุบูุฑุงุช ุชู ุฅูุดุงุคูุง
- ุฑุณุงูุฉ: "ุชู ุฅุถุงูุฉ ุงููุงุฏุฉ ... ูุน 4 ูุชุบูุฑ ู 4 ุณุนุฑ ุจูุฌุงุญ"
- 4 ุฃุณุนุงุฑ ูุญููุธุฉ ูู PriceListItem
```

---

## ๐ฏ ุงููููุฒุงุช ุงูุฌุฏูุฏุฉ

โ **ุฅุถุงูุฉ ุฃุณุนุงุฑ ููููุงุฏ ุงูุนุงุฏูุฉ**: ุฌุฏูู ุจุณูุท ูู ุงูุฎุทูุฉ 3
โ **ุฅุถุงูุฉ ุฃุณุนุงุฑ ูููุชุบูุฑุงุช**: ุฌุฏุงูู ูููุตูุฉ ููู ูุงุฆูุฉ ุณุนุฑ
โ **ุชุจุฏูู ุชููุงุฆู**: ุนูุฏ ุชูุนูู "ูู ูุชุบูุฑุงุช"ุ ูุชุบูุฑ ุนุฑุถ ุงูุฃุณุนุงุฑ
โ **ุฏุนู ููุงุฆู ุฃุณุนุงุฑ ูุชุนุฏุฏุฉ**: ุฌุฏูู ูููุตู ููู ูุงุฆูุฉ
โ **ุชูููุฏ ุชููุงุฆู**: ุฌุฏุงูู ุงูุฃุณุนุงุฑ ุชูููููุฏ ุชููุงุฆูุงู ุนูุฏ ุชูููุฏ ุงููุชุบูุฑุงุช
โ **ุชูุณูู ุฐูู**: ุฏุนู ุชูุณูููู ููุฃุณุนุงุฑ (ุฅุถุงูุฉ + ุชุนุฏูู)
โ **ุชุญูู ูู ุงูุจูุงูุงุช**: ูุง ูุชู ุญูุธ ุงูุฃุณุนุงุฑ ุงูุณุงูุจุฉ ุฃู ุงููุงุฑุบุฉ

---

## ๐ ุงูุชุญูู ุงูููู

```bash
# ุชุญูู ูู ุตุญุฉ ุงูููุฏ
python3 -m py_compile apps/core/views/item_views.py
โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก

# ุชุญูู ูู Django
python manage.py check core
โ System check identified no issues (0 silenced).
```

---

## ๐ ุงูููุงุญุธุงุช

1. **ุงูุฃุณุนุงุฑ ุงุฎุชูุงุฑูุฉ**: ูููู ุชุฑู ุญููู ุงูุฃุณุนุงุฑ ูุงุฑุบุฉ
2. **ููุงุฆู ูุชุนุฏุฏุฉ**: ูุฏุนู ุฃู ุนุฏุฏ ูู ููุงุฆู ุงูุฃุณุนุงุฑ
3. **ุงููุชุบูุฑุงุช ุงููุซูุฑุฉ**: ุฅุฐุง ูุงู ุนุฏุฏ ุงููุชุบูุฑุงุช ูุจูุฑ (ูุซูุงู 50)ุ ูุฏ ุชุญุชุงุฌ ุงูุตูุญุฉ scroll
4. **ุงูุชูุงูู**: ุงููุธุงู ูุชูุงูู 100% ูุน ุงูููุฏ ุงููุฏูู

---

## โ ุงูุฎูุงุตุฉ

ุชู ุจูุฌุงุญ ุฅุถุงูุฉ **ูุธุงู ุงูุฃุณุนุงุฑ ุงููุงูู** ุฅูู wizard ุฅุถุงูุฉ ุงูููุงุฏ:

โ **ููููุงุฏ ุงูุนุงุฏูุฉ**: ุฌุฏูู ุฃุณุนุงุฑ ุจุณูุท
โ **ูููุชุบูุฑุงุช**: ุฌุฏุงูู ูููุตูุฉ ููู ูุงุฆูุฉ ุณุนุฑ ูุน ูู ุงููุชุบูุฑุงุช
โ **ุชุจุฏูู ุชููุงุฆู**: ุญุณุจ ุงุฎุชูุงุฑ "ูู ูุชุบูุฑุงุช"
โ **ุชูููุฏ ุฏููุงูููู**: ุฌุฏุงูู ุงูุฃุณุนุงุฑ ุชูููููุฏ ุชููุงุฆูุงู

**ุงููุชูุฌุฉ**: ุงูุขู ูููู ุฅุถุงูุฉ ุงููุงุฏุฉ **ูุน ุงูุฃุณุนุงุฑ** ูู ููุณ ุงูููุชุ ุจุฏูุงู ูู ุงูุญุงุฌุฉ ูุชุนุฏูู ุงููุงุฏุฉ ูุงุญูุงู!

**ุงูุญุงูุฉ**: โ **ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูููุฑู**

---

**ุชู ุงูุชูุซูู ุจูุงุณุทุฉ**: Claude Code
**ุงูุชุงุฑูุฎ**: 2025-11-19
