<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <title>Test Conversions</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="p-4">
    <h3>اختبار إضافة التحويلات</h3>
    
    <div class="table-responsive">
        <table class="table table-sm table-bordered" id="conversionsTable">
            <thead>
                <tr>
                    <th>الوحدة من</th>
                    <th>الوحدة إلى</th>
                    <th>معامل التحويل</th>
                    <th>الإجراء</th>
                </tr>
            </thead>
            <tbody id="conversionsBody">
            </tbody>
        </table>
    </div>
    
    <button type="button" class="btn btn-sm btn-primary" id="btnAddConversion">
        <i class="fas fa-plus"></i> إضافة تحويل
    </button>

    <script>
        // UOM List (from database)
        const uomList = [
            {"id": 1, "name": "قطعة", "symbol": "PC"},
            {"id": 2, "name": "كرتون", "symbol": "CTN"},
            {"id": 3, "name": "دزينة", "symbol": "DZ"},
            {"id": 4, "name": "كيلو", "symbol": "KG"},
            {"id": 5, "name": "جرام", "symbol": "GM"}
        ];

        let conversionIndex = 0;

        function addConversionRow() {
            console.log('addConversionRow called');
            const tbody = document.getElementById('conversionsBody');
            const row = document.createElement('tr');
            row.dataset.index = conversionIndex;

            let uomOptions = '<option value="">اختر الوحدة</option>';
            uomList.forEach(uom => {
                uomOptions += `<option value="${uom.id}">${uom.name} (${uom.symbol})</option>`;
            });

            row.innerHTML = `
                <td>
                    <select name="conversion_from_uom_${conversionIndex}"
                            class="form-select form-select-sm">
                        ${uomOptions}
                    </select>
                </td>
                <td>
                    <select name="conversion_to_uom_${conversionIndex}"
                            class="form-select form-select-sm">
                        ${uomOptions}
                    </select>
                </td>
                <td>
                    <input type="number"
                           name="conversion_factor_${conversionIndex}"
                           class="form-control form-control-sm"
                           placeholder="1.0"
                           step="0.001"
                           min="0.001">
                </td>
                <td>
                    <button type="button" class="btn btn-sm btn-danger btn-remove-conversion">
                        <i class="fas fa-times"></i>
                    </button>
                </td>
            `;

            tbody.appendChild(row);
            conversionIndex++;

            // Add delete handler
            row.querySelector('.btn-remove-conversion').addEventListener('click', function() {
                row.remove();
            });
            
            console.log('Row added, total rows:', tbody.children.length);
        }

        document.getElementById('btnAddConversion').addEventListener('click', function() {
            console.log('Button clicked');
            addConversionRow();
        });
        
        console.log('Script loaded, uomList:', uomList);
    </script>
</body>
</html>
